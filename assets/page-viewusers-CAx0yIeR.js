import{r,j as t,B as N,h as f,p as A,T as c,K as U,A as L,a5 as W,D as B,a as z,b as H,a6 as Y,l as J}from"./vendor-DzAsgXT6.js";const V=o=>{const u=new Date(o),d={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};return u.toLocaleDateString(void 0,d)};function K(){const[o,u]=r.useState([]),[d,p]=r.useState(!0),[C,S]=r.useState(null),[h,T]=r.useState(""),[O,m]=r.useState(!1),[F,x]=r.useState(""),[I,y]=r.useState("info"),v="https://jikuclass.onrender.com",[P,j]=r.useState(!1),[l,k]=r.useState(null),[i,w]=r.useState({}),D=e=>{k(e),w({academy:e.academy,practice:e.practice,inventory:e.inventory,paymentStatus:e.paymentStatus}),j(!0)},b=()=>{j(!1),k(null),w({})},g=e=>{const{name:a,value:s}=e.target;w(n=>({...n,[a]:s}))},R=async()=>{if(l){p(!0);try{const e=await fetch(`${v}/api/users/${l.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...l,...i})});if(!e.ok)throw console.log(JSON.stringify({...l,...i})),new Error(`HTTP error! status: ${e.status}`);const a=await e.json();u(s=>s.map(n=>n.id===a.id?a:n)),x("User updated successfully!"),y("success"),m(!0),b()}catch(e){const a=e instanceof Error?e.message:"An unknown error occurred";S(a),x(`Failed to update user: ${a}`),y("error"),m(!0),console.error("Failed to update user:",e)}finally{p(!1)}}},$=r.useMemo(()=>[{field:"id",headerName:"ID",width:60},{field:"fullName",headerName:"Full Name",width:200},{field:"password",headerName:"Password",width:80},{field:"email",headerName:"Email",width:250},{field:"phone",headerName:"Phone",width:150},{field:"address",headerName:"Address",width:200},{field:"itExperience",headerName:"IT Experience",width:150},{field:"birthYear",headerName:"Birth Year",width:120},{field:"academy",headerName:"Academy",width:90},{field:"practice",headerName:"Practice",width:90},{field:"inventory",headerName:"Inventory",width:90},{field:"paymentStatus",headerName:"Payment Status",width:60},{field:"createdAt",headerName:"Created At",width:180,valueFormatter:e=>V(e.value)},{field:"updatedAt",headerName:"Updated At",width:180},{field:"activities",headerName:"Activities",width:120},{field:"actions",headerName:"Actions",width:120,sortable:!1,renderCell:e=>t.jsx(N,{variant:"contained",color:"primary",size:"small",onClick:()=>D(e.row),className:"rounded-lg shadow-md",children:"Edit"})}],[D]);r.useEffect(()=>{(async()=>{try{const a=await fetch(`${v}/api/users`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const s=await a.json();u(s)}catch(a){const s=a instanceof Error?a.message:"An unknown error occurred";S(s),x(`Failed to fetch users: ${s}`),y("error"),m(!0),console.error("Failed to fetch users:",a)}finally{p(!1)}})()},[]);const G=r.useMemo(()=>{if(!h)return o;const e=h.toLowerCase();return o.filter(a=>{var s,n,M;return a.fullName.toLowerCase().includes(e)||a.email.toLowerCase().includes(e)||a.phone.toLowerCase().includes(e)||a.address.toLowerCase().includes(e)||a.itExperience.toLowerCase().includes(e)||a.birthYear.toLowerCase().includes(e)||((s=a.academy)==null?void 0:s.toLowerCase().includes(e))||((n=a.practice)==null?void 0:n.toLowerCase().includes(e))||((M=a.inventory)==null?void 0:M.toLowerCase().includes(e))||a.paymentStatus.toLowerCase().includes(e)})},[o,h]),E=(e,a)=>{a!=="clickaway"&&m(!1)};return t.jsxs(f,{className:"min-h-screen flex flex-col items-center p-4 bg-gray-100 dark:bg-gray-900",sx:{fontFamily:"Inter, sans-serif"},children:[t.jsxs(f,{className:"w-full max-w-5xl p-8 bg-white dark:bg-gray-800 rounded-xl shadow-lg flex flex-col gap-6",children:[t.jsx(A,{variant:"h4",component:"h1",className:"text-center text-gray-800 dark:text-white font-bold mb-4",children:"User Management"}),t.jsx(c,{label:"Search Users",variant:"outlined",fullWidth:!0,value:h,onChange:e=>T(e.target.value),className:"rounded-lg mb-4",sx:{"& .MuiOutlinedInput-root":{borderRadius:"0.75rem"}}}),d&&!o.length?t.jsxs(f,{className:"flex justify-center items-center h-64",children:[t.jsx(U,{}),t.jsx(A,{className:"ml-4 text-gray-700 dark:text-gray-300",children:"Loading users..."})]}):C?t.jsxs(L,{severity:"error",className:"rounded-lg",children:["Error: ",C]}):t.jsxs(f,{className:"h-[600px] w-full",children:[" ",t.jsx(W,{rows:G,columns:$,pageSizeOptions:[5,10,20],initialState:{pagination:{paginationModel:{pageSize:10}}},checkboxSelection:!0,disableRowSelectionOnClick:!0,className:"rounded-lg shadow-md",sx:{"& .MuiDataGrid-root":{borderRadius:"0.75rem"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"#f3f4f6",color:"#374151",fontWeight:"bold"},"& .MuiDataGrid-cell":{borderColor:"#e5e7eb"},"& .MuiDataGrid-row:nth-of-type(odd)":{backgroundColor:"#f9fafb"},"& .MuiDataGrid-row:hover":{backgroundColor:"#e0f2f7"}}})]})]}),t.jsxs(B,{open:P,onClose:b,children:[t.jsx(z,{className:"text-gray-800 dark:text-white bg-gray-100 dark:bg-gray-700 rounded-t-lg",children:"Edit User"}),t.jsx(H,{className:"bg-white dark:bg-gray-800 p-6 flex flex-col gap-4",children:l&&t.jsxs(t.Fragment,{children:[t.jsx(c,{label:"Academy",name:"academy",value:i.academy||"",onChange:g,fullWidth:!0,variant:"outlined",className:"rounded-lg",sx:{"& .MuiOutlinedInput-root":{borderRadius:"0.75rem"},m:1}}),t.jsx(c,{label:"Practice",name:"practice",value:i.practice||"",onChange:g,fullWidth:!0,variant:"outlined",className:"rounded-lg",sx:{"& .MuiOutlinedInput-root":{borderRadius:"0.75rem"},m:1}}),t.jsx(c,{label:"Inventory",name:"inventory",value:i.inventory||"",onChange:g,fullWidth:!0,variant:"outlined",className:"rounded-lg",sx:{"& .MuiOutlinedInput-root":{borderRadius:"0.75rem"},m:1}}),t.jsx(c,{label:"Payment Status",name:"paymentStatus",value:i.paymentStatus||"",onChange:g,fullWidth:!0,variant:"outlined",className:"rounded-lg",sx:{"& .MuiOutlinedInput-root":{borderRadius:"0.75rem"},m:1}})]})}),t.jsxs(Y,{className:"bg-gray-100 dark:bg-gray-700 rounded-b-lg p-4",children:[t.jsx(N,{onClick:b,color:"secondary",variant:"outlined",className:"rounded-lg",children:"Cancel"}),t.jsx(N,{onClick:R,color:"primary",variant:"contained",className:"rounded-lg",disabled:d,children:d?t.jsx(U,{size:24}):"Save Changes"})]})]}),t.jsx(J,{open:O,autoHideDuration:6e3,onClose:E,children:t.jsx(L,{onClose:E,severity:I,sx:{width:"100%"},children:F})})]})}export{K as V};
