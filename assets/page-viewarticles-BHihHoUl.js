import{r as s,j as a,y as le,g as x,o as k,T as f,F as re,h as ne,i as oe,M as g,J as S,A as $,a3 as ie,D as L,a as W,b as R,a4 as B,B as b,k as de,I as M,a5 as ce,a6 as ue}from"./vendor-BrzHSOkp.js";function he(){const l="https://jikuclass.onrender.com/api/articles",[y,O]=s.useState([]),[r,n]=s.useState(!0),[w,v]=s.useState(null),[z,D]=s.useState(!1),[u,A]=s.useState(null),[d,E]=s.useState({title:"",body:"",type:""}),[Q,T]=s.useState(!1),[o,P]=s.useState(null),[H,F]=s.useState(!1),[J,U]=s.useState(""),[V,_]=s.useState("success"),[m,G]=s.useState(""),[C,q]=s.useState(10),i=s.useCallback(async()=>{n(!0),v(null);try{const e=await fetch(l);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();O(t)}catch(e){console.error("Failed to fetch articles:",e),v(`Failed to load articles: ${e.message}`),c(`Failed to load articles: ${e.message}`,"error")}finally{n(!1)}},[l]);s.useEffect(()=>{i()},[i]);const K=s.useCallback(e=>{A(e),E({title:e.title,body:e.body,type:e.type}),D(!0)},[]),h=s.useCallback(()=>{D(!1),A(null)},[]),j=s.useCallback(e=>{const{name:t,value:N}=e.target;E(te=>({...te,[t]:N}))},[]),X=s.useCallback(async()=>{if(u){n(!0);try{const e={...u,...d},t=await fetch(`${l}/${u.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const N=await t.json();throw new Error(`Failed to update article: ${N.message||t.statusText}`)}c("Article updated successfully!","success"),h(),i()}catch(e){console.error("Failed to update article:",e),c(`Error updating article: ${e.message}`,"error")}finally{n(!1)}}},[u,d,h,i,l]),Y=s.useCallback(e=>{P(e),T(!0)},[]),p=s.useCallback(()=>{T(!1),P(null)},[]),Z=s.useCallback(async()=>{if(o){n(!0);try{const e=await fetch(`${l}/${o.id}`,{method:"DELETE"});if(!e.ok)throw new Error(`Failed to delete article: ${e.statusText}`);c("Article deleted successfully!","success"),p(),i()}catch(e){console.error("Failed to delete article:",e),c(`Error deleting article: ${e.message}`,"error")}finally{n(!1)}}},[o,p,i,l]),c=s.useCallback((e,t)=>{U(e),_(t),F(!0)},[]),I=s.useCallback((e,t)=>{t!=="clickaway"&&F(!1)},[]),ee=s.useMemo(()=>{if(!m)return y;const e=m.toLowerCase();return y.filter(t=>t.title.toLowerCase().includes(e)||t.body.toLowerCase().includes(e)||t.type.toLowerCase().includes(e)||t.postDate.toLowerCase().includes(e))},[y,m]),ae=s.useCallback(e=>{q(Number(e.target.value))},[]),se=[{field:"id",headerName:"ID",width:60},{field:"title",headerName:"Title",flex:1,minWidth:150},{field:"body",headerName:"Body",flex:2,minWidth:200},{field:"type",headerName:"Type",width:100},{field:"postDate",headerName:"Post Date",width:200},{field:"actions",type:"actions",headerName:"Actions",width:150,getActions:e=>[a.jsx(M,{"aria-label":"edit",onClick:()=>K(e.row),color:"primary",children:a.jsx(ce,{})},"edit"),a.jsx(M,{"aria-label":"delete",onClick:()=>Y(e.row),color:"error",children:a.jsx(ue,{})},"delete")]}];return a.jsxs(le,{maxWidth:"lg",className:"py-8 font-inter",children:[a.jsxs(x,{className:"flex flex-col items-center justify-center p-4 bg-white rounded-lg shadow-lg",children:[a.jsx(k,{variant:"h4",component:"h1",className:"mb-6 text-blue-700 font-bold",children:"Article Management"}),a.jsxs(x,{className:"w-full flex flex-col sm:flex-row items-center justify-between mb-4 gap-4",children:[a.jsx(f,{label:"Search Articles",variant:"outlined",value:m,onChange:e=>G(e.target.value),className:"w-full sm:w-1/2 md:w-1/3 rounded-md",InputProps:{className:"rounded-md"}}),a.jsxs(re,{variant:"outlined",className:"w-full sm:w-auto min-w-[120px] rounded-md",children:[a.jsx(ne,{id:"rows-per-page-label",children:"Rows per page"}),a.jsxs(oe,{labelId:"rows-per-page-label",value:C,onChange:ae,label:"Rows per page",className:"rounded-md",children:[a.jsx(g,{value:5,children:"5"}),a.jsx(g,{value:10,children:"10"}),a.jsx(g,{value:20,children:"20"}),a.jsx(g,{value:50,children:"50"})]})]})]}),r&&a.jsxs(x,{className:"flex justify-center items-center h-48",children:[a.jsx(S,{}),a.jsx(k,{variant:"h6",className:"ml-4",children:"Loading Articles..."})]}),w&&a.jsx($,{severity:"error",className:"w-full mb-4 rounded-md",children:w}),!r&&!w&&a.jsx(x,{className:"w-full h-[600px] rounded-lg overflow-hidden",children:a.jsx(ie,{rows:ee,columns:se,getRowId:e=>e.id,initialState:{pagination:{paginationModel:{pageSize:C,page:0}}},disableRowSelectionOnClick:!0,className:"rounded-lg shadow-inner"},C)})]}),a.jsxs(L,{open:z,onClose:h,fullWidth:!0,maxWidth:"sm",children:[a.jsx(W,{className:"bg-blue-500 text-white rounded-t-lg font-inter",children:"Edit Article"}),a.jsxs(R,{className:"p-6",children:[a.jsx(f,{autoFocus:!0,margin:"dense",name:"title",label:"Title",type:"text",fullWidth:!0,variant:"outlined",value:d.title,onChange:j,className:"mb-4 rounded-md",InputProps:{className:"rounded-md"}}),a.jsx(f,{margin:"dense",name:"body",label:"Body",type:"text",fullWidth:!0,multiline:!0,rows:4,variant:"outlined",value:d.body,onChange:j,className:"mb-4 rounded-md",InputProps:{className:"rounded-md"}}),a.jsx(f,{margin:"dense",name:"type",label:"Type",type:"text",fullWidth:!0,variant:"outlined",value:d.type,onChange:j,className:"rounded-md",InputProps:{className:"rounded-md"}})]}),a.jsxs(B,{className:"p-4 border-t border-gray-200",children:[a.jsx(b,{onClick:h,color:"secondary",variant:"outlined",className:"rounded-md",children:"Cancel"}),a.jsx(b,{onClick:X,color:"primary",variant:"contained",className:"rounded-md",disabled:r,children:r?a.jsx(S,{size:24}):"Save Changes"})]})]}),a.jsxs(L,{open:Q,onClose:p,maxWidth:"xs",children:[a.jsx(W,{className:"bg-red-500 text-white rounded-t-lg font-inter",children:"Confirm Delete"}),a.jsx(R,{className:"p-6",children:a.jsxs(k,{children:['Are you sure you want to delete the article "',a.jsx("span",{className:"font-semibold",children:o==null?void 0:o.title}),'"? This action cannot be undone.']})}),a.jsxs(B,{className:"p-4 border-t border-gray-200",children:[a.jsx(b,{onClick:p,color:"secondary",variant:"outlined",className:"rounded-md",children:"Cancel"}),a.jsx(b,{onClick:Z,color:"error",variant:"contained",className:"rounded-md",disabled:r,children:r?a.jsx(S,{size:24}):"Delete"})]})]}),a.jsx(de,{open:H,autoHideDuration:6e3,onClose:I,children:a.jsx($,{onClose:I,severity:V,sx:{width:"100%"},className:"rounded-md",children:J})})]})}export{he as V};
