import{r as t,j as a,h as o,S as Y,T as l,B as i,a4 as Z,K as ee,A as x,a5 as ae,D as w,a as C,b as v,a6 as N,p as te,I as F,a7 as ne,a8 as se}from"./vendor-DzAsgXT6.js";function re(){const[B,L]=t.useState([]),[z,D]=t.useState(!0),[E,S]=t.useState(null),[P,G]=t.useState(""),c="https://jikuclass.onrender.com",[M,T]=t.useState(!1),[n,d]=t.useState(null),[k,u]=t.useState(null),[U,W]=t.useState(!1),[r,m]=t.useState({type:"",amount:0,paymentWay:""}),[A,y]=t.useState(null),[H,I]=t.useState(!1),[g,$]=t.useState(null),[O,h]=t.useState(null),p=async()=>{D(!0),S(null);try{const e=await fetch(`${c}/api/payments`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();L(s)}catch(e){S(`Failed to fetch payments: ${e.message}`),console.error("Error fetching payments:",e)}finally{D(!1)}};t.useEffect(()=>{p()},[]);const R=B.filter(e=>Object.values(e).some(s=>String(s).toLowerCase().includes(P.toLowerCase()))),J=e=>{d(e),T(!0),u(null)},f=()=>{T(!1),d(null),u(null)},_=async()=>{if(n){u(null);try{const e=await fetch(`${c}/api/payments/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:n.type,amount:n.amount,paymentWay:n.paymentWay})});if(!e.ok){const s=await e.json();throw new Error(`Failed to update payment: ${s.message||e.statusText}`)}f(),p()}catch(e){u(`Error updating payment: ${e.message}`),console.error("Error updating payment:",e)}}},K=()=>{m({type:"",amount:0,paymentWay:""}),W(!0),y(null)},j=()=>{W(!1),y(null)},q=async()=>{y(null);try{const e=await fetch(`${c}/api/payments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!e.ok){const s=await e.json();throw new Error(`Failed to add payment: ${s.message||e.statusText}`)}j(),p()}catch(e){y(`Error adding payment: ${e.message}`),console.error("Error adding payment:",e)}},Q=e=>{$(e),I(!0),h(null)},b=()=>{I(!1),$(null),h(null)},V=async()=>{if(g!==null){h(null);try{const e=await fetch(`${c}/api/payments/${g}`,{method:"DELETE"});if(!e.ok){const s=await e.text();throw new Error(`Failed to delete payment: ${s||e.statusText}`)}b(),p()}catch(e){h(`Error deleting payment: ${e.message}`),console.error("Error deleting payment:",e)}}},X=[{field:"id",headerName:"ID",width:60},{field:"type",headerName:"Type",width:90},{field:"amount",headerName:"Amount",type:"number",width:100},{field:"updateDate",headerName:"Update Date",width:100},{field:"paymentWay",headerName:"Payment Way",flex:1,minWidth:300},{field:"actions",headerName:"Actions",width:70,sortable:!1,filterable:!1,renderCell:e=>a.jsxs(o,{children:[a.jsx(F,{color:"primary","aria-label":"edit payment",onClick:()=>J(e.row),children:a.jsx(ne,{})}),a.jsx(F,{color:"error","aria-label":"delete payment",onClick:()=>Q(e.row.id),children:a.jsx(se,{})})]})}];return a.jsxs(o,{className:"p-4 flex flex-col items-center min-h-screen bg-gray-100 font-sans",children:[a.jsxs(Y,{flexDirection:"row",justifyContent:"space-between",className:"w-full max-w-5xl flex justify-between items-center mb-6",children:[a.jsx(l,{label:"Search Payments",variant:"outlined",value:P,onChange:e=>G(e.target.value),className:"bg-white rounded-lg shadow-sm",InputProps:{className:"rounded-lg"},size:"small"}),a.jsx(i,{sx:{justifySelf:"flex-end"},variant:"contained",color:"primary",size:"small",startIcon:a.jsx(Z,{}),className:"bg-blue-600 hover:bg-blue-700 rounded-lg shadow-md",onClick:K,children:"Add New Payment"})]}),a.jsx(o,{className:"w-full max-w-5xl bg-white rounded-lg shadow-lg overflow-hidden",children:z?a.jsxs(o,{className:"flex justify-center items-center h-64",children:[a.jsx(ee,{}),a.jsx("span",{className:"ml-4 text-gray-600",children:"Loading payments..."})]}):E?a.jsx(o,{className:"p-4",children:a.jsx(x,{severity:"error",children:E})}):a.jsx(ae,{rows:R,columns:X,pageSizeOptions:[5,10,20],initialState:{pagination:{paginationModel:{pageSize:10,page:0}}},disableRowSelectionOnClick:!0,autoHeight:!0,className:"rounded-lg",sx:{"& .MuiDataGrid-columnHeaders":{backgroundColor:"#f5f5f5",fontWeight:"bold"},"& .MuiDataGrid-cell":{borderBottom:"1px solid #e0e0e0"},"& .MuiDataGrid-row:hover":{backgroundColor:"#fafafa"}}})}),a.jsxs(w,{open:M,onClose:f,children:[a.jsx(C,{className:"text-xl font-semibold text-gray-800",children:"Edit Payment"}),a.jsxs(v,{className:"p-6",children:[k&&a.jsx(x,{severity:"error",sx:{mb:2},children:k}),n&&a.jsxs(o,{justifyContent:"space-between",className:"flex flex-col gap-4",children:[a.jsx(l,{label:"ID",value:n.id,fullWidth:!0,disabled:!0,variant:"outlined",sx:{m:1}}),a.jsx(l,{label:"Type",value:n.type,onChange:e=>d({...n,type:e.target.value}),fullWidth:!0,variant:"outlined",sx:{m:1}}),a.jsx(l,{label:"Amount",type:"number",value:n.amount,onChange:e=>d({...n,amount:parseFloat(e.target.value)}),fullWidth:!0,variant:"outlined",sx:{m:1}}),a.jsx(l,{label:"Payment Way",value:n.paymentWay,onChange:e=>d({...n,paymentWay:e.target.value}),fullWidth:!0,multiline:!0,rows:3,variant:"outlined",sx:{m:1}})]})]}),a.jsxs(N,{className:"p-4 border-t border-gray-200",children:[a.jsx(i,{onClick:f,color:"secondary",className:"rounded-lg",children:"Cancel"}),a.jsx(i,{onClick:_,variant:"contained",color:"primary",className:"rounded-lg bg-blue-600 hover:bg-blue-700",children:"Save Changes"})]})]}),a.jsxs(w,{open:U,onClose:j,children:[a.jsx(C,{className:"text-xl font-semibold text-gray-800",children:"Add New Payment"}),a.jsxs(v,{className:"p-6",children:[A&&a.jsx(x,{severity:"error",sx:{mb:2},children:A}),a.jsxs(o,{justifyContent:"space-between",className:"flex flex-col gap-4",children:[a.jsx(l,{label:"Type",value:r.type,onChange:e=>m({...r,type:e.target.value}),fullWidth:!0,variant:"outlined",sx:{m:1}}),a.jsx(l,{label:"Amount",type:"number",value:r.amount,onChange:e=>m({...r,amount:parseFloat(e.target.value)}),fullWidth:!0,variant:"outlined",sx:{m:1}}),a.jsx(l,{label:"Payment Way",value:r.paymentWay,onChange:e=>m({...r,paymentWay:e.target.value}),fullWidth:!0,multiline:!0,rows:3,variant:"outlined",sx:{m:1}})]})]}),a.jsxs(N,{className:"p-4 border-t border-gray-200",children:[a.jsx(i,{onClick:j,color:"secondary",className:"rounded-lg",children:"Cancel"}),a.jsx(i,{onClick:q,variant:"contained",color:"primary",className:"rounded-lg bg-blue-600 hover:bg-blue-700",children:"Add Payment"})]})]}),a.jsxs(w,{open:H,onClose:b,children:[a.jsx(C,{className:"text-xl font-semibold text-gray-800",children:"Confirm Deletion"}),a.jsxs(v,{className:"p-6",children:[O&&a.jsx(x,{severity:"error",sx:{mb:2},children:O}),a.jsxs(te,{children:["Are you sure you want to delete payment with ID:"," ",a.jsx("span",{className:"font-bold",children:g}),"? This action cannot be undone."]})]}),a.jsxs(N,{className:"p-4 border-t border-gray-200",children:[a.jsx(i,{onClick:b,color:"secondary",className:"rounded-lg",children:"Cancel"}),a.jsx(i,{onClick:V,variant:"contained",color:"error",className:"rounded-lg bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})}export{re as P};
