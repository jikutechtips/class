import{r as t,u as Sr,j as e,aQ as sa,aR as br,aS as ss,aT as wr,aU as An,aV as as,aW as Es,aX as Mn,aY as ks,aZ as ds,a_ as Cr,a$ as Fn,b0 as vr,ad as ne,b1 as ze,b2 as Er,b3 as pa,b4 as kr,b5 as Tr,b6 as Nr,b7 as $r,m as Te,b8 as at,af as V,b9 as R,ba as Re,aB as G,bb as $e,bc as ye,ay as we,bd as Ce,be as Ne,a7 as W,bf as ve,bg as Ue,bh as Ye,bi as Ie,bj as ge,bk as rt,bl as ot,J as ae,h as Ts,bm as fn,bn as Nt,F as Ns,bo as Ve,bp as us,aw as Ze,bq as Xe,br as un,bs as st,bt as Dr,bu as Pr,bv as bt,bw as wt,bx as Lt,by as Ct,bz as zt,aa as yt,bA as ga,bB as xa,bC as ja,bD as ya,bE as $s,bF as Sa,bG as Ar,bH as Ir,bI as Mr,bJ as Fr,bK as Or,bL as Ot,bM as _r,bN as Ds,bO as Ps,bP as As,bQ as On,bR as Is,bS as _n,bT as rs,bU as os,bV as Rr,bW as Lr,bX as is,bY as ba,bZ as wa,b_ as Ca,as as $t,b$ as Bt,c0 as Ut,c1 as it,c2 as dt,c3 as zr,c4 as Br,c5 as Ur,c6 as Jr,c7 as Hr,c8 as Wr,c9 as aa,ca as _t,cb as Yr,cc as Gr,cd as qr,ce as Vr,cf as Kr,cg as lt,ch as ct,ci as Qr,cj as mn,ck as pn,cl as gn,cm as xn,cn as jn,co as yn,cp as Zr,cq as en,cr as tn,cs as nn,ct as Rt,cu as va,cv as hn,cw as Xr,cx as eo,cy as ra,cz as to,cA as no,cB as so,cC as ao,cD as ro,cE as Ea,cF as ka,cG as In,cH as _e,cI as Ta,cJ as oo,cK as io,ak as lo,cL as co,cM as uo,cN as ho}from"./vendor-Q_I1QV0S.js";import{S as fo,u as he}from"./page-LoginDialog-BocpPv5E.js";import{S as mo}from"./page-entinty-registration-jxKwOWb8.js";import{D as po}from"./page-index-BpKTdVuF.js";import{O as go}from"./page-orders-COljY1Zp.js";import{A as xo}from"./page-add-doctor-P9LcwM1-.js";import{A as ft,a as jo}from"./page-add-client-CrBgJr_R.js";import{N as yo}from"./page-manage-D4gWwO7T.js";import{D as So}from"./page-homep-zKcB4Dd5.js";import"./page-sign-in-side/Content-DhKiev2G.js";import"./page-Header-BRQicIna.js";import"./page-RegisterDialog-DJooQ_Rr.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const S of r.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&l(S)}).observe(document,{childList:!0,subtree:!0});function a(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(o){if(o.ep)return;o.ep=!0;const r=a(o);fetch(o.href,r)}})();const bo={title:"Dental Clinic"},wo=60*60*1e3;function Co(){const[n,s]=t.useState(null),[a,l]=t.useState(!0),o=Sr(),[r,S]=t.useState(null),i=t.useCallback(c=>{s(c),c?localStorage.setItem("session",JSON.stringify(c)):localStorage.removeItem("session")},[]),x=t.useCallback(()=>{if(r&&clearTimeout(r),n){const c=setTimeout(()=>{i(null),o("/sign-in")},wo);S(c)}},[n,o,i]);t.useEffect(()=>{const c=localStorage.getItem("session");if(c)try{const Q=JSON.parse(c);s(Q)}catch(Q){console.error("Error parsing session from localStorage",Q),localStorage.removeItem("session")}l(!1)},[]),t.useEffect(()=>{x()},[x]);const u=t.useCallback(()=>{o("/sign-in")},[o]),h=t.useCallback(()=>{s(null),localStorage.removeItem("session"),o("/sign-in"),r&&clearTimeout(r)},[o,r]),v=t.useMemo(()=>({session:n,setSession:i}),[n,i]),D=t.useMemo(()=>{const c=[{title:"Dashboard",icon:e.jsx(sa,{sx:{color:"green"}}),visible:!0}];if(n&&n.user){if(n.user.title==="manager")return[{title:"Dashboard",icon:e.jsx(sa,{sx:{color:"green"}}),visible:!0},{title:"Dental Clinics",icon:e.jsx(br,{sx:{color:"green"}}),segment:"cliniclist",visible:!0},{title:"System Users",icon:e.jsx(ss,{sx:{color:"green"}}),segment:"systemusers",visible:!0},{title:"Add Services & Products",icon:e.jsx(wr,{sx:{color:"green"}}),segment:"addservices",visible:!0}];if(n.user.title==="Admin")return[{title:"Staff",segment:"staff",icon:e.jsx(ss,{sx:{color:"green"}}),visible:!0,children:[{title:"Add Staff",icon:e.jsx(ss,{sx:{color:"green"}}),segment:"staffregistration",visible:!0},{title:"View Staffs",segment:"staffview",icon:e.jsx(ss,{sx:{color:"green"}})}]},{title:"Pendings Bills",icon:e.jsx(An,{sx:{color:"green"}}),segment:"view-pendings",visible:!0},{title:"Paid Bills",icon:e.jsx(as,{sx:{color:"green"}}),segment:"paidbills",visible:!0},{title:"Make Appointment",icon:e.jsx(An,{sx:{color:"green"}}),segment:"schedule-appointment",visible:!0},{title:"Patients",icon:e.jsx(ks,{sx:{color:"green"}}),segment:"patients",visible:!0,children:[{title:"Add Patient",icon:e.jsx(Es,{sx:{color:"green"}}),segment:"add-patient",visible:!0},{title:"View Patients",icon:e.jsx(Mn,{sx:{color:"green"}}),segment:"view-patient",visible:!0}]},{title:"Appointments",icon:e.jsx(ds,{sx:{color:"green"}}),segment:"viewappointment",visible:!0},{title:"Manage",segment:"manage",visible:!0,children:[{title:"Add Services & Products",segment:"add-services-and-products",visible:!0},{title:"View Services & Products",segment:"view-services-and-products",visible:!0}]}];if(n.user.title==="reception")return[{title:"Make Appointment",icon:e.jsx(An,{sx:{color:"green"}}),segment:"schedule-appointment",visible:!0},{title:"Patients",icon:e.jsx(ks,{sx:{color:"green"}}),segment:"patients",visible:!0,children:[{title:"Add Patient",icon:e.jsx(Es,{sx:{color:"green"}}),segment:"add-patient",visible:!0},{title:"View Patients",icon:e.jsx(Mn,{sx:{color:"green"}}),segment:"view-patient",visible:!0}]}];if(n.user.title==="doctor")return[{title:"Case & Task",icon:e.jsx(vr,{sx:{color:"green"}}),segment:"cases",visible:!0,children:[{title:"Create Task",icon:e.jsx(An,{sx:{color:"green"}}),segment:"doctor-task",visible:!0},{title:"Create Case",icon:e.jsx(Cr,{sx:{color:"green"}}),segment:"create-case",visible:!0},{title:"View Cases",icon:e.jsx(Fn,{sx:{color:"green"}}),segment:"view-cases",visible:!0},{title:"Appointments",icon:e.jsx(ds,{sx:{color:"green"}}),segment:"viewappointment",visible:!0}]},{title:"Patients",icon:e.jsx(ks,{sx:{color:"green"}}),segment:"patients",visible:!0,children:[{title:"Add Patient",icon:e.jsx(Es,{sx:{color:"green"}}),segment:"add-patient",visible:!0},{title:"View Patients",icon:e.jsx(Mn,{sx:{color:"green"}}),segment:"view-patient",visible:!0}]},{title:"Bills",icon:e.jsx(as,{sx:{color:"green"}}),segment:"bills",visible:!0,children:[{title:"Payment",icon:e.jsx(as,{sx:{color:"green"}}),segment:"dview-bills",visible:!0}]}];if(n.user.title==="accountant")return[{title:"Pendings",icon:e.jsx(An,{sx:{color:"green"}}),segment:"view-pendings",visible:!0},{title:"Paid Bills",icon:e.jsx(as,{sx:{color:"green"}}),segment:"paidbills",visible:!0}]}return c},[n]);return a?e.jsx(ne,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(ze,{size:"lg",style:{color:"#676767",width:"80px",height:"80px"}})}):e.jsx(fo.Provider,{value:v,children:e.jsx(Er,{navigation:[{kind:"header",title:"Main items"},...D],branding:bo,session:n,authentication:{signIn:u,signOut:h},children:e.jsx(pa,{})})})}function vo(){const{session:n}=he(),s=kr();if(!n){const a=`/sign-in?callbackUrl=${encodeURIComponent(s.pathname)}`;return e.jsx(Tr,{to:a,replace:!0})}return e.jsx(e.Fragment,{children:e.jsx(Nr,{children:e.jsx($r,{children:e.jsx(pa,{})})})})}function Eo(){return[{status:"technician",value:"technician"},{status:"reception",value:"reception"},{status:"accountant",value:"accountant"},{status:"doctor",value:"doctor"}]}function ko(n){const s="https://dental-clinic-latest.onrender.com",{session:a}=he(),[l,o]=t.useState(""),[r,S]=t.useState(""),[i,x]=t.useState(""),[u,h]=t.useState(""),[v,D]=t.useState(""),[c,Q]=t.useState(""),[Y,L]=t.useState(""),J=Eo(),_=Te().tz("Africa/Nairobi").format("DD/MM/YYYY, h:mm:ss A"),[P,U]=t.useState(!1),[Z,B]=t.useState(""),[K,M]=t.useState(!1),[w,j]=t.useState(!1),m=async()=>{var f;if(r==""&&v==""&&c==""){B("Some of field not filled,  Please fill all field to Continue...");return}j(!0);try{const T=await fetch(`${s}/users`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({fullName:r,address:i,phone_number:u,email:v.toLowerCase(),password:c,title:Y.toLocaleLowerCase(),registration_date:_,entity_name:(f=a==null?void 0:a.user)==null?void 0:f.entity_name})});T.status===201?await T.json():console.error("Failed to create patient:",T.status),o(""),h(" "),L(""),Q(""),S(""),D(""),x("")}catch(T){console.error("Error creating patient:",T)}finally{U(!0),j(!1)}},C=(f,T)=>{T!=="clickaway"&&U(!1)};return e.jsxs(ft,{...n,children:[e.jsx(at,{enableColorScheme:!0}),e.jsx(V,{direction:"column",component:"main",sx:[{justifyContent:"center",height:"calc((1 - var(--template-frame-height, 0)) * 100%)",marginTop:"max(0px - var(--template-frame-height, 0px), 0px)",minHeight:"100%"},f=>({"&::before":{content:'""',display:"block",position:"absolute",zIndex:-1,inset:0,backgroundImage:"radial-gradient(ellipse at 50% 50%, hsl(210, 100%, 97%), hsl(0, 0%, 100%))",backgroundRepeat:"no-repeat",...f.applyStyles("dark",{backgroundImage:"radial-gradient(at 50% 50%, hsla(210, 100%, 16%, 0.5), hsl(220, 30%, 5%))"})}})],children:e.jsx(V,{direction:{xs:"column-reverse",md:"row"},sx:{justifyContent:"center",gap:{xs:6,sm:12},p:2,mx:"auto"},children:e.jsx(V,{direction:{xs:"column-reverse",md:"row"},sx:{justifyContent:"center",gap:{xs:6,sm:12},p:{xs:2,sm:4},m:"auto",mt:0},spacing:2,children:e.jsxs(ne,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:"36ch",marginTop:0}},noValidate:!0,autoComplete:"off",children:[e.jsxs("div",{children:[" ",e.jsx("p",{style:{color:"red",fontSize:"14"},children:Z}),e.jsx(R,{id:"fullname",label:"Full Name",onChange:f=>S(f.target.value),type:"search",value:r,variant:"standard"}),e.jsx(R,{id:"address",label:"Physical Address",helperText:"P.o Box 123, Moshi, Kilimanjaro",type:"search",onChange:f=>x(f.target.value),variant:"standard",value:i}),e.jsx(R,{id:"phone-number",value:u,onChange:f=>h(f.target.value),label:"Phone Number",helperText:"2557xxxxxxxx",type:"search",variant:"standard"}),e.jsx(R,{id:"email",label:"Email Address",value:v,type:"search",onChange:f=>D(f.target.value),variant:"standard"}),e.jsx(R,{id:"password",label:"Password",onChange:f=>Q(f.target.value),type:"search",value:c,variant:"standard"})," ",e.jsx(Re,{options:J.map(f=>f.status),renderInput:f=>e.jsx(R,{...f,label:"Title"}),onChange:(f,T)=>{L(T)},size:"small",sx:{mt:2,width:"30%"}})]}),e.jsx(G,{sx:{textTransform:"none",float:"center"},variant:"contained",onClick:m,children:w?e.jsx(ze,{size:24,sx:{color:"green"}}):"Register"}),e.jsx($e,{open:P,autoHideDuration:1500,onClose:C,children:e.jsx(ye,{onClose:C,severity:"success",variant:"filled",sx:{width:"100%"},children:"Success"})})]})})})})]})}function oa(){const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState(!0),[o,r]=t.useState(),[S,i]=t.useState(!1),[x,u]=t.useState(!0),[h,v]=t.useState(!1),[D,c]=t.useState(0),[Q,Y]=t.useState([]),[L,J]=t.useState(""),[_,P]=t.useState(""),[U,Z]=t.useState(""),[B,K]=t.useState(""),[M,w]=t.useState(""),[j,m]=t.useState(""),[C,f]=t.useState(""),T=(I,F)=>{F!=="clickaway"&&i(!1)},N=()=>{v(!1)},z=t.useCallback((I,F,k,g,$,A)=>()=>{v(!0),r(I),P(F),Z(k),K(g),w($),m(A)},[]),ee=async()=>{try{const I=await fetch(`${n}/users/${o}?fullName=${_}&address=${U}&phone_number=${B}&email=${M}&password=${j}&title=${C}`,{method:"PUT"});if(!I.ok){const F=await I.json();console.error("API Error:",F);return}l(!1),i(!0)}catch(I){console.error("Fetch Error:",I)}l(!0)},se=t.useCallback(I=>()=>{confirm("Are you sure you want to delete this  ?")&&fetch(`${n}/users/${I}`,{method:"DELETE"}).then(F=>{F.ok?Y(k=>k.filter(g=>g.id!==I)):console.error(`Failed to delete case with ID: ${I}`)}).catch(F=>{console.error(`Error deleting case with ID: ${I}`,F)})},[]);t.useEffect(()=>{var I;a&&(u(!0),fetch(`${n}/users/lab/${(I=s==null?void 0:s.user)==null?void 0:I.entity_name}`,{method:"GET"}).then(F=>F.status===200?F.json():null).then(F=>{F!==null&&Y(F),u(!1),l(!1)}))},[a]);const H=[{field:"id",headerName:"ID",width:70},{field:"fullName",headerName:"Full Name",width:130},{field:"address",headerName:"Address",width:130},{field:"phone_number",headerName:"Phone Number",width:130},{field:"email",headerName:"Email Address",width:130},{field:"password",headerName:"Password",width:130},{field:"title",headerName:"Title",width:130},{field:"entity_name",headerName:"Entity Name",width:130},{field:"registration_date",headerName:"Gender",width:130},{field:"actions",type:"actions",headerName:"Actions",width:90,getActions:I=>[e.jsx(ge,{icon:e.jsx(rt,{}),label:"Edit",onClick:z(I.row.id,I.row.fullName,I.row.address,I.row.phone_number,I.row.email,I.row.password),showInMenu:!0},"edit"),e.jsx(ge,{icon:e.jsx(ot,{}),label:"Delete",onClick:se(I.row.id),showInMenu:!0},"delete")]}],E=Q;return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:10}}),e.jsxs("div",{style:{height:400,width:"100%"},children:[x?e.jsx("p",{children:"Loading..."}):e.jsx(we,{rows:E,columns:H,pagination:!0}),e.jsxs("div",{children:[e.jsxs(Ce,{open:h,onClose:N,PaperProps:{component:"form",onSubmit:I=>{I.preventDefault();const F=new FormData(I.currentTarget),g=Object.fromEntries(F.entries()).email;console.log(g),N()}},children:[e.jsx(Ne,{children:e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:26},children:"Edit Info"})}),e.jsx(ve,{children:e.jsx(Ue,{children:e.jsxs(Ye,{children:[e.jsx(R,{id:"fullname",label:"Full Name",onChange:I=>P(I.target.value),type:"search",value:_,variant:"standard"}),e.jsx(R,{id:"address",label:"Physical Address",helperText:"P.o Box 123, Moshi, Kilimanjaro",type:"search",onChange:I=>Z(I.target.value),variant:"standard",value:U}),e.jsx(R,{id:"phone-number",value:B,onChange:I=>K(I.target.value),label:"Phone Number",helperText:"2557xxxxxxxx",type:"search",variant:"standard"}),e.jsx(R,{id:"email",label:"Email Address",value:M,type:"search",onChange:I=>w(I.target.value),variant:"standard"}),e.jsx(R,{id:"password",label:"Password",onChange:I=>m(I.target.value),type:"search",value:j,variant:"standard"})," "]})})}),e.jsxs(Ie,{children:[e.jsx(G,{sx:{textTransform:"none"},variant:"outlined",onClick:N,children:"Cancel"}),e.jsx(G,{onClick:ee,type:"submit",color:"success",variant:"contained",sx:{textTransform:"none"},children:"Edit"})]})]}),e.jsx($e,{open:S,autoHideDuration:1500,onClose:T,children:e.jsx(ye,{onClose:T,severity:"success",variant:"filled",sx:{width:"100%"},children:"Success"})})]})]})]})}function ls(n,s="TZS",a="en-US"){const l=typeof n=="string"?parseFloat(n):n;return isNaN(l)?"Invalid Amount":l.toLocaleString(a,{style:"currency",currency:s})}function ia(){var kt;const n="https://dental-clinic-latest.onrender.com",s="Work to be done",{session:a}=he(),[l,o]=t.useState(!1),[r,S]=t.useState(!1),[i,x]=t.useState(null),[u,h]=t.useState(null),[v,D]=t.useState([]),[c,Q]=t.useState([]),[Y,L]=t.useState([]),[J,_]=t.useState([]),[P,U]=ae.useState(""),[Z,B]=t.useState({}),[K,M]=t.useState(!1),[w,j]=t.useState(""),[m,C]=t.useState(!0),[f,T]=t.useState(null),[N,z]=t.useState(""),[ee,se]=t.useState(),[H,E]=t.useState(""),[I,F]=t.useState(),[k,g]=t.useState(0),[$,A]=t.useState(""),[O,te]=ae.useState([]),[pe,re]=ae.useState([]),[de,je]=t.useState(new Map),[Me,Se]=ae.useState([]),[be,Le]=ae.useState([]),[fe,Ee]=t.useState(!1),[Fe,oe]=t.useState([]),[ce,me]=t.useState(),[De,Pe]=ae.useState([]),[Be,et]=ae.useState([]),[Je,mt]=ae.useState([]),[Ke,ut]=t.useState({}),[ht,Oe]=t.useState({}),[vt,pt]=t.useState({}),[Rn,tt]=t.useState(!1),[gt,ue]=t.useState(null),[Jt,Et]=t.useState(null),[Dt,He]=t.useState(null),[Sn,xt]=ae.useState([]),[Ms,Fs]=ae.useState([]),[Ht,bn]=t.useState(null),[hs,wn]=t.useState(),[Cn,Wt]=t.useState("1");async function Ln(y){try{const b=await fetch(`${n}/api/files/files-byname/${y}`);if(!b.ok){if(b.status===404)return null;throw new Error(`HTTP error! status: ${b.status}`)}return await b.json()}catch(b){return console.error("Error fetching file info:",b),null}}const zn=y=>{var xe;He(null);const b=(xe=y.target.files)==null?void 0:xe[0];ue(b)},Bn=async()=>{if(!gt){He("Please select a file first.");return}Et("Uploading..."),He(null);try{const y=new FormData;y.append("file",gt);const b=await fetch(`${n}/api/files/upload/${H}`,{method:"POST",body:y});if(b.ok){Et(""),gt.name;const xe=await Ln(gt.name);try{const We=await fetch(`${n}/cases/${H}?fileId=${xe==null?void 0:xe.id}&filename=${xe==null?void 0:xe.fileName}`,{method:"PUT"});if(!We.ok){const Ge=await We.json();console.error("API Error:",Ge),alert(`Submission failed: ${Ge.message||"An error occurred"}`);return}tt(!0)}catch(We){console.error("Fetch Error:",We),alert("Submission failed. Please try again.")}tt(!0),ue(null)}else try{const xe=await b.json();Et(`${(xe==null?void 0:xe.message)||b.statusText}`)}catch{Et(`Upload failed: ${b.statusText}`)}}catch(y){Et(`Upload failed: ${y}`)}};t.useEffect(()=>{(async()=>{if(H)try{const b=await fetch(`${n}/switch/${H}`);if(b.ok){const xe=await b.json();Oe(xe.label)}else console.error("Failed to fetch switch states:",b.status)}catch(b){console.error("Error fetching switch states:",b)}})()},[H]),t.useEffect(()=>{(async()=>{if(!H){pt({});return}try{const b=await fetch(`${n}/at-switch/${H}`);if(b.ok){const xe=await b.json();pt(xe.attachmentstate)}else console.error("Failed to fetch switch states: pd not selected",b.status)}catch(b){console.error("Error fetching switch states:",b)}})()},[H]),t.useEffect(()=>{(async()=>{if(!H){ut({});return}try{const b=await fetch(`${n}/spcondition/${H}`);if(b.ok){const xe=await b.json();ut(xe?xe.spcondition:{...Ke})}else console.error("Failed to fetch switch states:",b.status)}catch(b){console.error("Error fetching switch states:",b)}})()},[H]),ae.useEffect(()=>{var y;fetch(`${n}/tpcondition/tp/${(y=a==null?void 0:a.user)==null?void 0:y.entity_name}`,{method:"GET"}).then(b=>b.status===200?b.json():null).then(b=>{b!==null&&et(b)})},[]),ae.useEffect(()=>{var y;fetch(`${n}/enclosed/attachment/${(y=a==null?void 0:a.user)==null?void 0:y.entity_name}`,{method:"GET"}).then(b=>b.status===200?b.json():null).then(b=>{b!==null&&mt(b)})},[]),ae.useEffect(()=>{var y;fetch(`${n}/sinstruction/instruction/${(y=a==null?void 0:a.user)==null?void 0:y.entity_name}`,{method:"GET"}).then(b=>b.status===200?b.json():null).then(b=>{b!==null&&Pe(b)})},[]),ae.useEffect(()=>{var y;fetch(`${n}/prothesis/pro/${(y=a==null?void 0:a.user)==null?void 0:y.entity_name}`,{method:"GET"}).then(b=>b.status===200?b.json():null).then(b=>{b!==null&&re(b)})},[]),ae.useEffect(()=>{var y;fetch(`${n}/tooth-condition/conditions/${(y=a==null?void 0:a.user)==null?void 0:y.entity_name}`,{method:"GET"}).then(b=>b.status===200?b.json():null).then(b=>{b!==null&&oe(b)})},[]),t.useEffect(()=>{var y;fetch(`${n}/products/prod/${(y=a==null?void 0:a.user)==null?void 0:y.entity_name}`,{method:"GET"}).then(b=>b.status===200?b.json():null).then(b=>{if(b!==null){te(b);const xe=new Map;b.forEach(We=>xe.set(We.name,We.price)),je(xe)}})},[(kt=a==null?void 0:a.user)==null?void 0:kt.entity_name]),ae.useEffect(()=>{var y;fetch(`${n}/clients/byfullname/${(y=a==null?void 0:a.user)==null?void 0:y.name}`,{method:"GET"}).then(b=>b.status===200?b.json():null).then(b=>{b!==null&&D(b)})},[]),t.useEffect(()=>{(async()=>{if(i!=null&&i.fullName)try{const b=await fetch(`${n}/patients/patient/${i.fullName}`);if(b.ok){const xe=await b.json();_(xe),U("")}else console.error("Failed to fetch patients:",b.status),_([]),U("")}catch(b){console.error("Error fetching patients:",b),_([]),U("")}else _([]),U("")})()},[i==null?void 0:i.fullName]),t.useEffect(()=>{(async()=>{if(i!=null&&i.fullName){console.log(i.fullName);try{const b=await fetch(`${n}/cases/dc-case/${i==null?void 0:i.fullName}`);if(b.ok){const xe=await b.json();xt(xe)}else console.error("Failed to fetch patients:",b.status),xt([]),U("")}catch(b){console.error("Error fetching patients:",b),xt([]),U("")}}else xt([]),U("")})()},[i==null?void 0:i.fullName]);const Un=Ts({palette:{mode:"light",primary:{main:fn[500]},secondary:{main:fn[500]}}}),Jn=(y,b,xe,We)=>{if(b){const Ge=v.find(kn=>kn.fullName===b);x(Ge||null)}else x(null),h(null),bn(null),E(""),Oe({})},Hn=(y,b,xe,We)=>{if(b){bn(b);const Ge=Sn.find(kn=>kn.caseNumber===b);h(Ge||null),E(Ge==null?void 0:Ge.id)}else h(null),E(""),Ee(!1)},Wn=()=>{M(!0)},Yt=()=>{M(!1)},X=y=>{Ee(y)};t.useEffect(()=>{(async()=>{if(C(!0),T(null),u!=null&&u.id)try{const b=await fetch(`${n}/1/api/button-data/${u==null?void 0:u.id}`);if(!b.ok)throw new Error(`HTTP error! status: ${b.status}`);const xe=await b.json();B(xe.buttonColors),E(u==null?void 0:u.id.toString()),X(!0)}catch(b){console.error("Error fetching data:",b),T("Error Fetching data")}finally{C(!1)}else L([]),B({})})()},[u==null?void 0:u.id]);const ie=y=>{const b=y.currentTarget.textContent;if(b){const xe=Y.includes(b),We=xe?"outlined":"contained";xe?L(Y.filter(Ge=>Ge!==b)):(Qe(),L([...Y,b])),B(Ge=>({...Ge,[b]:We}))}},Qe=()=>{L([])},vn=async()=>{try{const y={selectedItems:Y,buttonColors:Z};console.log(JSON.stringify(y));const b=await fetch(`${n}/1/api/button-data/${u==null?void 0:u.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)});if(!b.ok)throw new Error(`HTTP error! status: ${b.status}`);console.log(Y.length),tt(!0)}catch(y){console.error("Error saving button data:",y)}},Os=Array.from({length:8},(y,b)=>18-b).map(y=>e.jsx(G,{onClick:ie,variant:Z[y]||"outlined",children:y},y)),Yn=Array.from({length:8},(y,b)=>b+21).map(y=>e.jsx(G,{onClick:ie,variant:Z[y]||"outlined",children:y},y)),Gn=Array.from({length:8},(y,b)=>48-b).map(y=>e.jsx(G,{onClick:ie,variant:Z[y]||"outlined",children:y},y)),qn=Array.from({length:8},(y,b)=>b+31).map(y=>e.jsx(G,{onClick:ie,variant:Z[y]||"outlined",children:y},y)),fs=y=>{if(z(y),de.has(y)){const b=de.get(y);g(b),console.log(`The price of ${y} is ${b}`)}else console.log(`Price not found for ${y}`),g(0)},ms=ae.useCallback(y=>()=>{fetch(`${n}/task-info/${y}`,{method:"DELETE"}).then(b=>{if(!b.ok)throw new Error(`HTTP error! status: ${b.status}`);Se(xe=>xe.filter(We=>We.id!==y)),tt(!0)}).catch(b=>{console.error("Error deleting user:",b),tt(!0)}),console.log(y)},[Se,tt]),ke=Nt().tz("Africa/Nairobi").format("DD/MM/YYYY, h:mm:ss A"),En=()=>{const y=k*Y.length;fetch(`${n}/task-info`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({patientId:u==null?void 0:u.id,product:N,teeth:Y.join(","),price:k,prothesis:$,teeth_condition:ce,reg_date:ke,entity_name:i==null?void 0:i.entity_name,total_price:y,doctor:i==null?void 0:i.fullName,caseNumber:u==null?void 0:u.caseNumber,caseId:H,quantity:Y.length})}).then(b=>b.status==201?b.json():null).then(b=>{z(""),g(0),L([]),L([]),Wt("2"),tt(!0)})},Pt=async()=>{if(Cn=="1")if(u!=null&&u.id)try{const y=await fetch(`${n}/task-info/patient/${u==null?void 0:u.id}`);if(y.ok){const b=await y.json();X(!0),Se(b),Wt("")}else console.error("Failed to fetch patients:",y.status),Se([])}catch(y){console.error("Error fetching patients:",y),Se([])}else Se([]);if(u!=null&&u.id)try{const y=await fetch(`${n}/task-info/patient/${u==null?void 0:u.id}`);if(y.ok){const b=await y.json();X(!0),Se(b),Wt("")}else console.error("Failed to fetch patients:",y.status),Se([])}catch(y){console.error("Error fetching patients:",y),Se([])}else Se([])};t.useEffect(()=>{Pt()},[u==null?void 0:u.id,Cn]);const Gt=ae.useMemo(()=>[{field:"teeth",headerName:"Teeth",type:"string"},{field:"prothesis",headerName:"Prothesis",type:"string",width:100},{field:"teeth_condition",headerName:"Teeth Condition",type:"string",width:100},{field:"product",headerName:"Product",type:"string"},{field:"quantity",headerName:"Qty",type:"string",width:70},{field:"price",headerName:"Price",type:"number",valueFormatter:y=>typeof y=="string"||typeof y=="number"?ls(y):typeof y,width:140},{field:"total_price",headerName:"Total Price",type:"number",valueFormatter:y=>typeof y=="string"||typeof y=="number"?ls(y):typeof y,width:140},{field:"actions",headerName:"Actions",type:"actions",width:120,getActions:y=>[e.jsx(ge,{icon:e.jsx(ot,{}),label:"Delete",onClick:ms(y.id),showInMenu:!0})]}],[ms]),qt=y=>b=>{Oe({...ht,[y]:b.target.checked})},Vt=y=>b=>{ut({...Ke,[y]:b.target.checked})},_s=y=>b=>{pt({...vt,[y]:b.target.checked})},Rs=async()=>{const y={attachmentstate:vt};try{const b=await fetch(`${n}/at-switch/${H}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)});b.ok?tt(!0):(console.error("Error saving switch states:",b.status),console.log(JSON.stringify(y)))}catch(b){console.error("Error saving switch states:",b)}},St=async()=>{const y={spcondition:Ke};try{const b=await fetch(`${n}/spcondition/${H}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)});b.ok?tt(!0):(console.error("Error saving switch states:",b.status),console.log(JSON.stringify(y)))}catch(b){console.error("Error saving switch states:",b)}},Vn=async()=>{const y={label:ht};try{const b=await fetch(`${n}/switch/${H}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)});console.log(JSON.stringify(y)+H),b.ok?tt(!0):console.error("Error saving switch states:",b.status)}catch(b){console.error("Error saving switch states:",b)}},Kn=async()=>{if(!l){alert("Accept terms and conditions");return}try{const y=await fetch(`${n}/cases/${H}?isSubmitted=true&status=Pending`,{method:"PUT"});if(!y.ok){const b=await y.json();console.error("API Error:",b),alert(`Submission failed: ${b.message||"An error occurred"}`);return}tt(!0)}catch(y){console.error("Fetch Error:",y),alert("Submission failed. Please try again.")}};return e.jsxs(Ns,{theme:Un,children:[e.jsx(at,{}),e.jsx(ne,{sx:{display:"flex",flexWrap:"wrap","& > :not(style)":{m:1,width:"100%",padding:3,border:"none"}},children:e.jsxs(V,{sx:{border:"none"},children:[e.jsxs(V,{spacing:4,direction:"row",sx:{border:"none",p:2},children:[e.jsxs(ne,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:"200",marginTop:0}},noValidate:!0,autoComplete:"off",children:[e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:24,color:"seagreen",mb:2},children:"DENTIST DETAILS"}),e.jsx(Re,{options:v.map(y=>y.fullName),renderInput:y=>e.jsx(e.Fragment,{children:e.jsx(R,{...y,label:"Select Dentist"})}),onChange:Jn,size:"small",sx:{width:400}}),i&&e.jsxs(ne,{sx:{width:400},component:"form",noValidate:!0,autoComplete:"off",children:[e.jsx(R,{label:"Full Name",value:i.fullName,fullWidth:!0,margin:"normal",InputProps:{readOnly:!0},size:"small"}),e.jsx(R,{label:"Entity",value:i.entity_name,fullWidth:!0,margin:"normal",InputProps:{readOnly:!0},size:"small"}),e.jsx(R,{label:"Title",value:i.title,fullWidth:!0,margin:"normal",InputProps:{readOnly:!0},size:"small"})]})]}),e.jsxs(ne,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:400,marginTop:0}},noValidate:!0,autoComplete:"off",children:[e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:24,color:"seagreen",mb:2},children:"CHOOSE CASE"}),e.jsx(Re,{options:Sn.map(y=>y.caseNumber),renderInput:y=>e.jsx(R,{...y,label:"Select Case"}),onChange:Hn,size:"small",value:Ht,sx:{width:350}}),u&&e.jsxs(ne,{component:"form",noValidate:!0,autoComplete:"off",children:[e.jsx(R,{label:"Full Name",value:u.patient,fullWidth:!0,margin:"normal",InputProps:{readOnly:!0},size:"small"}),e.jsx(R,{label:"Entity",value:u.entity_name,fullWidth:!0,margin:"normal",InputProps:{readOnly:!0},size:"small"}),e.jsx(R,{label:"Patient Shade",value:u.shade,fullWidth:!0,margin:"normal",InputProps:{readOnly:!0},size:"small"})]})]})]}),e.jsx(V,{sx:{border:"none",padding:3},children:e.jsxs(V,{sx:{border:0,paddingLeft:2},children:[" ",e.jsx(ne,{sx:{display:"flex",flexDirection:"column",alignItems:"left","& > *":{m:1}},children:e.jsxs(V,{direction:"column",sx:{paddingLeft:5,border:0},children:[e.jsx(W,{sx:{paddingTop:3,paddingRight:6,border:0,m:0,fontSize:27},children:s})," ",e.jsxs(V,{direction:"column",spacing:1,children:[e.jsx(V,{children:e.jsxs(ne,{children:[e.jsx(Ve,{size:"small","aria-label":"Small button group",children:Os}),e.jsx(Ve,{size:"small","aria-label":"Small button group",children:Yn}),e.jsx(us,{orientation:"horizontal",variant:"middle",flexItem:!0,sx:{width:600},children:e.jsx(Ze,{sx:{backgroundColor:"primary"},label:"",size:"small"})}),e.jsx(Ve,{size:"small","aria-label":"Small button group",children:Gn}),e.jsx(Ve,{size:"small","aria-label":"Small button group",children:qn})]})}),e.jsxs("div",{children:[e.jsxs(G,{onClick:vn,size:"small",sx:{textTransform:"none"},variant:"contained",children:[" ","Saved Selected"]})," ",e.jsxs(G,{onClick:Wn,size:"small",sx:{textTransform:"none"},variant:"contained",children:[" ","Add Product"]}),Y.length===0?e.jsx(Ze,{label:"None"}):Y.map(y=>e.jsx(e.Fragment,{children:e.jsx(Ze,{label:y,onDelete:()=>{L(Y.filter(b=>b!==y)),B(b=>({...b,[y]:"outlined"}))}},y)}))]}),e.jsxs(Ce,{open:K,onClose:Yt,PaperProps:{component:"form",onSubmit:y=>{y.preventDefault();const b=new FormData(y.currentTarget),We=Object.fromEntries(b.entries()).email;console.log(We),Yt()}},children:[e.jsx(Ne,{children:e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:26},children:"Complete Task"})}),e.jsxs(ve,{children:[e.jsx(Ze,{sx:{mb:2,alignItems:"center"},color:"success",label:Y.join(",")}),e.jsx("br",{}),e.jsxs(Ue,{children:[e.jsx(Re,{options:pe.map(y=>y.name),renderInput:y=>e.jsx(R,{...y,label:"Prothesis"}),onChange:(y,b)=>{A(b)},size:"small",sx:{width:350}})," ",e.jsx("br",{}),e.jsx(Re,{options:Fe.map(y=>y.name),renderInput:y=>e.jsx(R,{...y,label:"Select Tooth Condition"}),onChange:(y,b)=>{me(b)},size:"small",sx:{width:350}})," ",e.jsx("br",{}),e.jsx(Re,{options:O.map(y=>y.name),renderInput:y=>e.jsx(R,{...y,label:"Select Product"}),onChange:(y,b)=>{b&&fs(b)},size:"small",sx:{width:350}}),k&&e.jsxs("p",{children:["Price: ",k*Y.length]})," "]})]}),e.jsxs(Ie,{children:[e.jsx(G,{onClick:Yt,children:"Cancel"}),e.jsx(G,{onClick:En,type:"submit",children:"Add Info"})]})]})]})]})})]})}),e.jsx(V,{sx:{border:0,padding:3},children:fe&&e.jsx("div",{style:{height:"auto",width:"80"},children:e.jsx(we,{rows:Me,columns:Gt,initialState:{pagination:{paginationModel:{pageSize:5}}}})})}),e.jsxs(V,{sx:{border:0,padding:3},children:[" ",e.jsxs(V,{sx:{border:0,paddingLeft:2},direction:"row",spacing:14,children:[" ",e.jsxs(Ye,{children:[e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:24},children:"Special Instruction"})," ",De.map(y=>e.jsx(Xe,{control:e.jsx(un,{checked:ht[y.name]||!1,onChange:qt(y.name)}),label:y.name},y.name)),e.jsx(G,{variant:"contained",onClick:Vn,sx:{mt:2,width:30},size:"small",children:"Save"})]}),e.jsx(ne,{children:e.jsxs(Ye,{children:[e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:24},children:"Condition"})," ",Be.map(y=>e.jsx(Xe,{control:e.jsx(un,{checked:Ke[y.name]||!1,onChange:Vt(y.name)}),label:y.name},y.name)),e.jsx(G,{variant:"contained",onClick:St,sx:{mt:2,width:30},size:"small",children:"Save"})]})}),e.jsx(ne,{sx:{display:"flex",flexDirection:"row",flexWrap:"wrap"},children:e.jsxs(Ye,{children:[" ",e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:24},children:"Enclosed"})," ",Je.map(y=>e.jsx(Xe,{control:e.jsx(un,{checked:vt[y.attachment]||!1,onChange:_s(y.attachment)}),label:y.attachment},y.attachment)),e.jsx(G,{variant:"contained",onClick:Rs,sx:{width:30},size:"small",children:"Save"})]})})]})]}),e.jsxs(V,{sx:{border:"none",padding:3},children:[e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:24},children:"Enclosed"})," ",e.jsxs(V,{sx:{border:0,paddingLeft:2},children:[" ",e.jsxs(Ye,{sx:{paddingLeft:5,mt:3},children:[e.jsx(V,{sx:{display:"flex",flexDirection:"row",flexWrap:"wrap"},direction:"row",spacing:14,children:e.jsxs(V,{children:[e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:24},children:"Attach (Optional)"})," ",e.jsx("input",{type:"file",id:"fileInput",onChange:zn,style:{display:"none",marginTop:"4",padding:0}}),e.jsx(G,{variant:"contained",component:"label",htmlFor:"fileInput",children:"Choose File"}),gt&&e.jsxs(W,{variant:"body1",children:["Selected file: ",gt.name]}),Dt&&e.jsx(W,{color:"error",children:Dt}),e.jsx(G,{variant:"contained",onClick:Bn,disabled:!gt,sx:{mt:2},children:"Upload"}),Jt&&e.jsx(W,{sx:{mt:2},children:Jt})]})}),e.jsx(W,{sx:{paddingLeft:2,mt:4,fontWeight:"bold",fontSize:19},children:"Others"}),e.jsx(R,{id:"outlined-basic",label:"Others",variant:"outlined",multiline:!0,rows:4,sx:{width:400,mt:2,mb:2}})]})]})]}),e.jsx(V,{sx:{border:"none",padding:3},children:e.jsxs(V,{sx:{border:0,paddingLeft:2},children:[" ",e.jsxs(Ye,{children:[" ",e.jsx(ne,{sx:{display:"flex",flexDirection:"row",flexWrap:"wrap"},children:e.jsx(Xe,{control:e.jsx(st,{checked:l,onChange:y=>o(y.target.checked),required:!0}),label:e.jsxs(e.Fragment,{children:[" ","I accept the"," ",e.jsx("a",{href:"",children:"terms and conditions"})]})})})]})]})}),e.jsx(V,{sx:{border:"none",padding:3},children:e.jsxs(V,{sx:{border:0,paddingLeft:2},children:[" ",e.jsx(Ye,{children:" "})]})}),e.jsx(ne,{sx:{display:"flex",flexDirection:"row",flexWrap:"wrap"},children:e.jsx(G,{variant:"contained",onClick:Kn,color:"success",children:"Submit Task"})})]})})]})}function To(){const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState(0),[o,r]=t.useState([]),[S,i]=t.useState(!0),[x,u]=t.useState(),[h,v]=t.useState(!1),[D,c]=t.useState(!0),[Q,Y]=t.useState(!1),[L,J]=t.useState(""),[_,P]=t.useState(""),[U,Z]=t.useState(""),[B,K]=t.useState(""),[M,w]=t.useState(""),[j,m]=t.useState(""),[C,f]=t.useState(""),[T,N]=t.useState(""),z=(k,g)=>{g!=="clickaway"&&v(!1)},ee=()=>{Y(!1)},se=t.useCallback((k,g,$,A,O,te)=>()=>{Y(!0),u(k),P(g),Z($),K(A),w(O),m(te)},[]),H=async()=>{try{const k=await fetch(`${n}/clients/${x}?fullName=${_}&address=${U}&phone=${B}&email=${M}&password=${j}&title=${C}`,{method:"PUT"});if(!k.ok){const g=await k.json();console.error("API Error:",g);return}i(!1),v(!0)}catch(k){console.error("Fetch Error:",k)}i(!0)},E=t.useCallback(k=>()=>{confirm("Are you sure you want to delete this  ?")&&fetch(`${n}/clients/${k}`,{method:"DELETE"}).then(g=>{g.ok?r($=>$.filter(A=>A.id!==k)):console.error(`Failed to delete case with ID: ${k}`)}).catch(g=>{console.error(`Error deleting case with ID: ${k}`,g)})},[]);t.useEffect(()=>{var k;S&&(c(!0),fetch(`${n}/clients/lab/${(k=s==null?void 0:s.user)==null?void 0:k.entity_name}`,{method:"GET"}).then(g=>g.status===200?g.json():null).then(g=>{g!==null&&(r(g),c(!1),i(!1))}))},[S]);const I=[{field:"id",headerName:"ID",width:70},{field:"fullName",headerName:"Full Name",width:130},{field:"address",headerName:"Address",width:130},{field:"phone",headerName:"Phone Number",width:130},{field:"email",headerName:"Email Address",width:130},{field:"password",headerName:"Password",width:130},{field:"title",headerName:"Title",width:130},{field:"entity_name",headerName:"Entity Name",width:130},{field:"actions",type:"actions",headerName:"Actions",width:90,getActions:k=>[e.jsx(ge,{icon:e.jsx(rt,{}),label:"Edit",onClick:se(k.row.id,k.row.fullName,k.row.address,k.row.phone,k.row.email,k.row.password),showInMenu:!0},"edit"),e.jsx(ge,{icon:e.jsx(ot,{}),label:"Delete",onClick:E(k.row.id),showInMenu:!0},"delete")]}],F=o;return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:10}}),e.jsxs("div",{style:{height:400,width:"100%"},children:[D?e.jsx("p",{children:"Loading..."}):e.jsx(we,{rows:F,columns:I,pagination:!0}),e.jsxs("div",{children:[e.jsxs(Ce,{open:Q,onClose:ee,PaperProps:{component:"form",onSubmit:k=>{k.preventDefault();const g=new FormData(k.currentTarget),A=Object.fromEntries(g.entries()).email;console.log(A),ee()}},children:[e.jsx(Ne,{children:e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:26},children:"Edit Info"})}),e.jsx(ve,{children:e.jsx(Ue,{children:e.jsxs(Ye,{children:[e.jsx(R,{id:"address",label:"Physical Address",type:"search",onChange:k=>Z(k.target.value),variant:"standard",value:U}),e.jsx(R,{id:"phone-number",value:B,onChange:k=>K(k.target.value),label:"Phone Number",type:"search",variant:"standard"}),e.jsx(R,{id:"email",label:"Email Address",value:M,type:"search",onChange:k=>w(k.target.value),variant:"standard"}),e.jsx(R,{id:"password",label:"Password",onChange:k=>m(k.target.value),type:"search",value:j,variant:"standard"}),e.jsx(R,{id:"domain",label:"Institute/Office",value:T,type:"search",onChange:k=>N(k.target.value),variant:"standard"})]})})}),e.jsxs(Ie,{children:[e.jsx(G,{sx:{textTransform:"none"},variant:"outlined",onClick:ee,children:"Cancel"}),e.jsx(G,{onClick:H,type:"submit",color:"success",variant:"contained",sx:{textTransform:"none"},children:"Edit"})]})]}),e.jsx($e,{open:h,autoHideDuration:1500,onClose:z,children:e.jsx(ye,{onClose:z,severity:"success",variant:"filled",sx:{width:"100%"},children:"Success"})})]})]})]})}function Na(){return[{status:"Female",value:"F"},{status:"Male",value:"M"},{status:"Other",value:"None"}]}function No(){const n=Na(),s=new Map;for(const a of n)s.set(a.status,a.value);return s}const $o=n=>new Date().getFullYear()-n;function Do(n){const s="https://dental-clinic-latest.onrender.com",{session:a}=he(),[l,o]=t.useState(""),r=Na();No();const[S,i]=t.useState(""),[x,u]=t.useState(""),[h,v]=t.useState(""),[D,c]=t.useState(""),[Q,Y]=t.useState(""),[L,J]=t.useState(""),[_,P]=t.useState(""),[U,Z]=t.useState(""),[B,K]=t.useState(""),[M,w]=t.useState(!1),[j,m]=t.useState(""),[C,f]=t.useState(!1),[T,N]=t.useState(!1),z=Te().tz("Africa/Nairobi").format("YYYY-MM-DDTHH:mm:ss"),ee=(E,I)=>{I!=="clickaway"&&w(!1)},se=async()=>{var E;if(l==""){m("Some of field not filled,  Please fill all field to Continue...");return}N(!0);try{const I=$o(parseInt(h)),F=await fetch(`${s}/patients`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({fullName:l,dob:I,phone:D,gender:_,regDate:z,updatedDate:z,clinicName:(E=a==null?void 0:a.user)==null?void 0:E.entity_name,address:B})});F.status===201?await F.json():console.error("Failed to create patient:",F.status),o(""),v(" "),c(""),P(""),K(""),m("")}catch(I){console.error("Error creating patient:",I)}finally{w(!0),N(!1)}},H=E=>{m(""),P(E)};return e.jsxs(ft,{...n,children:[e.jsx(at,{enableColorScheme:!0}),e.jsx(V,{direction:{xs:"column-reverse",md:"row"},sx:{justifyContent:"center",gap:{xs:6,sm:12},p:{xs:1,sm:2},m:"auto",mt:0},spacing:2,children:e.jsxs(ne,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:"36ch",marginTop:0}},noValidate:!0,autoComplete:"off",children:[e.jsxs("div",{children:[e.jsx("p",{style:{color:"red",fontSize:"14"},children:j}),e.jsx(R,{id:"name",label:"Full Name",onChange:E=>o(E.target.value),type:"search",required:!0,value:l,variant:"standard"}),e.jsx(R,{id:"age",label:"Birth year",type:"search",required:!0,helperText:"1980",size:"small",onChange:E=>v(E.target.value),variant:"standard",value:h}),e.jsx(R,{id:"phone",value:D,onChange:E=>c(E.target.value),label:"Phone Number",type:"search",required:!0,size:"small",variant:"standard"}),e.jsx(R,{required:!0,id:"address",label:"Address",helperText:"P.o.Box 123, Songea , Ruvuma",value:B,size:"small",type:"search",onChange:E=>K(E.target.value),variant:"standard"}),e.jsx(Re,{options:r.map(E=>E.status),renderInput:E=>e.jsx(R,{...E,label:"Gender"}),onChange:(E,I)=>{H(I)},size:"small",sx:{width:170,mt:1}})]}),e.jsx(G,{sx:{textTransform:"none",float:"center"},variant:"contained",onClick:se,children:T?e.jsx(ze,{size:24,sx:{color:"white"}}):"Submit"}),e.jsx($e,{open:M,autoHideDuration:1500,onClose:ee,children:e.jsx(ye,{onClose:ee,severity:"success",variant:"filled",sx:{width:"100%"},children:"Success"})})]})})]})}const Po=n=>{const s=new Date(n),a=s.getFullYear(),l=String(s.getMonth()+1).padStart(2,"0"),o=String(s.getDate()).padStart(2,"0"),r=String(s.getHours()).padStart(2,"0"),S=String(s.getMinutes()).padStart(2,"0"),i=s.getTimezoneOffset(),x=Math.abs(Math.floor(i/60)),u=Math.abs(i%60);return`${i>0?"-":"+"}${String(x).padStart(2,"0")}${String(u).padStart(2,"0")}`,`${o}-${l}-${a} ${r}:${S} `};function Ao(){var A;const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState(!1),[o,r]=t.useState(!0),[S,i]=t.useState(""),[x,u]=t.useState(!0),[h,v]=t.useState(),[D,c]=t.useState(!1),[Q,Y]=t.useState(0),[L,J]=t.useState([]),[_,P]=t.useState(""),[U,Z]=t.useState(""),[B,K]=t.useState(""),[M,w]=t.useState(""),[j,m]=t.useState(""),[C,f]=t.useState(""),[T,N]=t.useState(""),[z,ee]=t.useState(""),[se,H]=t.useState([]),E=(O,te)=>{te!=="clickaway"&&l(!1)},I=()=>{c(!1)},F=t.useCallback((O,te,pe,re,de,je,Me)=>()=>{c(!0),v(O),i(te),P(pe),K(re),f(de),N(je),Z(Me)},[]);t.useCallback(O=>()=>{confirm("Are you sure you want to delete this Patient ?")&&fetch(`${n}/patients/${O}`,{method:"DELETE"}).then(te=>{te.ok?(J(pe=>pe.filter(re=>re.id!==O)),H(pe=>pe.filter(re=>re.id!==O))):console.error(`Failed to delete patient with ID: ${O}`)}).catch(te=>{console.error(`Error deleting patient with ID: ${O}`,te)})},[]);const k=t.useCallback(O=>async()=>{try{const te=await fetch(`${n}/patients/${O}?flag=revisit`,{method:"PUT"});if(!te.ok){const pe=await te.json();console.error("API Error:",pe);return}l(!0)}catch(te){console.error("Fetch Error:",te)}},[]),g=async()=>{console.log(T);try{const O=await fetch(`${n}/patients/${h}?fullName=${S}&age=${_}&phone=${B}&gender=${C}&shade=${T}&address=${U}`,{method:"PUT"});if(!O.ok){const te=await O.json();console.error("API Error:",te);return}u(!1),l(!0)}catch(O){console.error("Fetch Error:",O)}u(!0)};t.useEffect(()=>{var O;x&&(r(!0),fetch(`${n}/patients/patient/${(O=s==null?void 0:s.user)==null?void 0:O.entity_name}`,{method:"GET"}).then(te=>te.status===200?te.json():null).then(te=>{te!==null&&(J(te),H(te)),r(!1),u(!1)}))},[x,(A=s==null?void 0:s.user)==null?void 0:A.entity_name,n]),t.useEffect(()=>{const O=z.toLowerCase(),te=L.filter(pe=>Object.values(pe).some(re=>String(re).toLowerCase().includes(O)));H(te)},[z,L]);const $=[{field:"id",headerName:"ID",width:50},{field:"fullName",headerName:"Full Name",width:130},{field:"phone",headerName:"Phone Number",width:130},{field:"regFee",headerName:"R. Fee",width:70},{field:"address",headerName:"Address",width:130},{field:"regDate",headerName:"Registration Date",width:200,valueFormatter:O=>typeof O=="string"?Po(O):typeof O},{field:"gender",headerName:"Gender",width:70},{field:"dob",headerName:"Age",width:80},{field:"actions",type:"actions",headerName:"Actions",width:90,getActions:O=>[e.jsx(ge,{icon:e.jsx(rt,{}),label:"Edit",onClick:F(O.row.id,O.row.fullName,O.row.dob,O.row.phone,O.row.gender,O.row.dob,O.row.address),showInMenu:!0},"edit"),e.jsx(ge,{icon:e.jsx(Dr,{}),label:"Revisiting",onClick:k(O.row.id),showInMenu:!0},"revisit"),e.jsx(ge,{icon:e.jsx(Pr,{}),label:"Patient File",onClick:()=>{window.open(`${n}/patient-pdf/${O.row.fullName}`,"_blank")},showInMenu:!0},"file")]}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10,padding:"0 16px"},children:e.jsx(R,{label:"Search Patients",value:z,onChange:O=>ee(O.target.value),variant:"outlined",size:"small"})}),e.jsxs("div",{style:{height:"auto",width:"100%"},children:[o?e.jsx("p",{children:"Loading..."}):e.jsx(we,{rows:se,columns:$,pagination:!0}),e.jsxs("div",{children:[e.jsxs(Ce,{open:D,onClose:I,PaperProps:{component:"form",onSubmit:O=>{O.preventDefault(),g(),I()}},children:[e.jsx(Ne,{children:e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:26},children:"Edit Info"})}),e.jsx(ve,{children:e.jsx(Ue,{children:e.jsxs(Ye,{children:[e.jsx(R,{id:"name",label:"Full Name",onChange:O=>i(O.target.value),type:"search",value:S,variant:"standard"}),e.jsx(R,{id:"age",label:"Date of Birth",type:"search",onChange:O=>P(O.target.value),variant:"standard",value:_}),e.jsx(R,{id:"address",label:"Address",type:"search",onChange:O=>Z(O.target.value),variant:"standard",value:U}),e.jsx(R,{id:"phone",value:B,onChange:O=>K(O.target.value),label:"Phone Number",type:"search",variant:"standard"}),e.jsx(R,{id:"gender",label:"Gender",value:C,type:"search",onChange:O=>f(O.target.value),variant:"standard"})]})})}),e.jsxs(Ie,{children:[e.jsx(G,{sx:{textTransform:"none"},variant:"outlined",onClick:I,children:"Cancel"}),e.jsx(G,{onClick:g,type:"submit",color:"success",variant:"contained",sx:{textTransform:"none"},children:"Edit"})]})]}),e.jsx($e,{open:a,autoHideDuration:1500,onClose:E,children:e.jsx(ye,{onClose:E,severity:"success",variant:"filled",sx:{width:"100%"},children:"Success"})})]})]})]})}function Io(){var F;const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState(!1),[o,r]=t.useState(!0),[S,i]=t.useState(""),[x,u]=t.useState(!0),[h,v]=t.useState(),[D,c]=t.useState(!1),[Q,Y]=t.useState(0),[L,J]=t.useState([]),[_,P]=t.useState(""),[U,Z]=t.useState(""),[B,K]=t.useState(""),[M,w]=t.useState(""),[j,m]=t.useState(""),[C,f]=t.useState(""),[T,N]=t.useState(""),[z,ee]=t.useState(""),[se,H]=t.useState([]),E=(k,g)=>{g!=="clickaway"&&l(!1)};t.useCallback((k,g,$,A,O,te,pe)=>()=>{c(!0),v(k),i(g),P($),K(A),f(O),N(te),Z(pe)},[]),t.useCallback(k=>()=>{confirm("Are you sure you want to delete this Patient ?")&&fetch(`${n}/patients/${k}`,{method:"DELETE"}).then(g=>{g.ok?(J($=>$.filter(A=>A.id!==k)),H($=>$.filter(A=>A.id!==k))):console.error(`Failed to delete patient with ID: ${k}`)}).catch(g=>{console.error(`Error deleting patient with ID: ${k}`,g)})},[]),t.useCallback(k=>async()=>{try{const g=await fetch(`${n}/patients/${k}?flag=revisit`,{method:"PUT"});if(!g.ok){const $=await g.json();console.error("API Error:",$);return}l(!0)}catch(g){console.error("Fetch Error:",g)}},[]),t.useEffect(()=>{var k;x&&(r(!0),fetch(`${n}/patients/recent-revisited/${(k=s==null?void 0:s.user)==null?void 0:k.entity_name}`,{method:"GET"}).then(g=>g.status===200?g.json():null).then(g=>{g!==null&&(J(g),H(g)),r(!1),u(!1)}))},[x,(F=s==null?void 0:s.user)==null?void 0:F.entity_name,n]),t.useEffect(()=>{const k=z.toLowerCase(),g=L.filter($=>Object.values($).some(A=>String(A).toLowerCase().includes(k)));H(g)},[z,L]);const I=[{field:"id",headerName:"ID",width:50},{field:"fullName",headerName:"Full Name",width:130},{field:"phone",headerName:"Phone Number",width:130},{field:"regFee",headerName:"R. Fee",width:70},{field:"address",headerName:"Address",width:130},{field:"regDate",headerName:"Reg. Date",width:130},{field:"gender",headerName:"Gender",width:70},{field:"dob",headerName:"Date of Birth",width:130}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10,padding:"0 16px"},children:e.jsx(R,{label:"Search Patients",value:z,onChange:k=>ee(k.target.value),variant:"outlined",size:"small"})}),e.jsxs("div",{style:{height:"auto",width:"100%"},children:[o?e.jsx("p",{children:"Loading..."}):e.jsx(we,{rows:se,columns:I,pagination:!0}),e.jsx("div",{children:e.jsx($e,{open:a,autoHideDuration:1500,onClose:E,children:e.jsx(ye,{onClose:E,severity:"success",variant:"filled",sx:{width:"100%"},children:"Success"})})})]})]})}function la(){const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState(!1),[o,r]=t.useState(0),[S,i]=t.useState(!0),[x,u]=t.useState(null);t.useEffect(()=>{(async()=>{var D;i(!0),u(null);try{const c=await fetch(`${n}/patients/recent-revisited-with-fee/count/${(D=s==null?void 0:s.user)==null?void 0:D.entity_name}`);if(!c.ok)throw new Error(`Failed to fetch count: ${c.status}`);const Q=await c.json();r(Q)}catch(c){u(c.message||"An error occurred while fetching data.")}finally{i(!1)}})()},[]);const h=v=>(D,c)=>{l(c?v:!1)};return e.jsxs("div",{children:[e.jsxs(bt,{expanded:a==="panel1",onChange:h("panel1"),children:[e.jsxs(wt,{expandIcon:e.jsx(Lt,{}),"aria-controls":"panel1bh-content",id:"panel1bh-header",children:[e.jsx(W,{component:"span",sx:{width:"33%",flexShrink:0},children:"In Service Patients"}),S?e.jsx(W,{component:"span",sx:{color:"text.secondary"},children:"Loading..."}):x?e.jsx(W,{component:"span",sx:{color:"red"},children:"Error"}):e.jsx(Ze,{label:o,color:"primary"})]}),e.jsx(Ct,{children:e.jsx(Io,{})})]}),e.jsxs(bt,{expanded:a==="panel2",onChange:h("panel2"),children:[e.jsxs(wt,{expandIcon:e.jsx(Lt,{}),"aria-controls":"panel2bh-content",id:"panel2bh-header",children:[e.jsx(W,{component:"span",sx:{width:"33%",flexShrink:0},children:"All Patients"}),"There is a list of all the time visiting Patients"]}),e.jsx(Ct,{children:e.jsx(Ao,{})})]})]})}function $a(n){const s="https://dental-clinic-latest.onrender.com",{session:a}=he(),[l,o]=t.useState(""),[r,S]=t.useState(""),i=Te().tz("Africa/Nairobi").format("DD/MM/YYYY, h:mm:ss A"),x=()=>{fetch(`${s}/products`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:l,price:r,reg_date:i})}).then(u=>u.status==201?u.json():null).then(u=>{o(""),S(" ")})};return e.jsxs(ft,{...n,children:[e.jsx(at,{enableColorScheme:!0}),e.jsxs(ne,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:"36ch",marginTop:0}},noValidate:!0,autoComplete:"off",children:[e.jsxs("div",{children:[e.jsx(R,{id:"name",label:"Treatment Name",onChange:u=>o(u.target.value),type:"search",value:l,variant:"outlined"}),e.jsx(R,{id:"price",label:"Treatment Price",type:"search",onChange:u=>S(u.target.value),variant:"outlined",value:r})]}),e.jsx(G,{sx:{textTransform:"none",float:"center"},variant:"contained",onClick:x,children:"Add Treatment"})]})]})}function Mo(n,s,a){var S;if(!n||n.length===0)return null;const l=(S=n[0])==null?void 0:S.treatments;if(!l)return null;let o;try{o=JSON.parse(l)}catch(i){return console.error("Error parsing treatment string:",i),null}const r=o.findIndex(i=>i.id===s);return r!==-1?(o[r]={...o[r],...a},o):(console.warn(`Treatment with ID ${s} not found.`),null)}const Fo=(n,s)=>{const a=JSON.stringify(n);return new Promise((l,o)=>{fetch(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({treatments:a})}).then(r=>r.ok?r.json():r.json().then(S=>{throw new Error(S.message||`HTTP error! status: ${r.status}`)})).then(r=>{console.log("API Response:",r),l({success:!0,message:"Treatments saved successfully!"})}).catch(r=>{console.error("API Error:",r),o({success:!1,message:r.message||"Failed to save treatments."})})})},Da=()=>{var M,w;const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState([]),[o,r]=t.useState(!0),[S,i]=t.useState(null),[x,u]=t.useState(!1),[h,v]=t.useState(null),[D,c]=t.useState(!1),[Q,Y]=t.useState(""),[L,J]=t.useState(""),_=t.useCallback(async()=>{var j;if((j=s==null?void 0:s.user)!=null&&j.entity_name){r(!0);try{const m=await fetch(`${n}/clinics/cbyname/${s.user.entity_name}`,{method:"GET"});if(!m.ok)throw new Error(`HTTP error! Status: ${m.status}`);const C=[await m.json()];Array.isArray(C)?l(C):(i("Unexpected API response: Expected an array of clinic data."),l([])),i(null)}catch(m){i(m.message),l([])}finally{r(!1)}}},[(M=s==null?void 0:s.user)==null?void 0:M.entity_name,n]);t.useEffect(()=>{_()},[_]);const P=j=>{var T;const m=(T=a[0])==null?void 0:T.treatments;if(!m){i("No treatment data found.");return}let C;try{C=JSON.parse(m)}catch(N){console.error("Error parsing treatment string:",N),i("Invalid treatment data format.");return}const f=C.find(N=>N.id===j);if(!f){i(`Treatment with ID ${j} not found.`);return}v(f),Y(f.name),J(f.price||""),u(!0)},U=async()=>{var m;if(!h)return;const j=Mo(a,h.id,{name:Q,price:L});if(j){try{const C=await Fo(j,`${n}/clinics/name/${(m=s==null?void 0:s.user)==null?void 0:m.entity_name}`);C.success?(console.log(C.message),l(f=>f.map(T=>({...T,treatments:JSON.stringify(j)}))),c(!0)):i(C.message||"Failed to save treatments.")}catch(C){const f=C.message||"An unexpected error occurred. Please try again.";i(f),console.error("Error sending data:",C)}finally{r(!1)}i(null),u(!1)}else i("Failed to update treatment. Check console for details.")},Z=t.useCallback(j=>{var T;const m=(T=a[0])==null?void 0:T.treatments;if(!m){i("No treatment data found.");return}let C;try{C=JSON.parse(m)}catch(N){console.error("Error parsing treatment string:",N),i("Invalid treatment data format.");return}const f=C.filter(N=>N.id!==j);l(N=>N.map(z=>({...z,treatments:JSON.stringify(f)}))),c(!0)},[a]),B=[{field:"id",headerName:"ID",width:70},{field:"name",headerName:"Name",width:150},{field:"price",headerName:"Price",width:100},{field:"actions",type:"actions",headerName:"Actions",width:150,getActions:j=>[e.jsx(ge,{icon:e.jsx(rt,{}),label:"Edit",onClick:()=>P(j.row.id),showInMenu:!0}),e.jsx(ge,{icon:e.jsx(ot,{}),label:"Delete",onClick:()=>Z(j.row.id),showInMenu:!0})]}];let K=[];if(a&&a.length>0&&((w=a[0])!=null&&w.treatments))try{K=JSON.parse(a[0].treatments)}catch(j){console.error("Error parsing treatment data",j),K=[],i("Error parsing treatment data. Please check the data source.")}else K=[];return o?e.jsx(W,{children:"Loading..."}):e.jsxs(ne,{sx:{p:4},children:[S&&e.jsxs(ye,{severity:"error",sx:{mb:2},children:[e.jsx(zt,{children:"Error"}),S]}),e.jsx(ne,{sx:{height:"auto",width:"100%"},children:e.jsx(we,{rows:K,columns:B,initialState:{pagination:{paginationModel:{pageSize:5}}},pageSizeOptions:[5,10,20]})}),e.jsxs(Ce,{open:x,onClose:()=>u(!1),children:[e.jsx(Ne,{children:"Edit Treatment"}),e.jsxs(ve,{children:[e.jsx(Ue,{children:"Edit the treatment details below."}),e.jsx(R,{autoFocus:!0,margin:"dense",id:"name",label:"Name",value:Q,onChange:j=>Y(j.target.value),fullWidth:!0,variant:"standard"}),e.jsx(R,{margin:"dense",id:"price",label:"Price",value:L,onChange:j=>J(j.target.value),fullWidth:!0,variant:"standard"})]}),e.jsxs(Ie,{children:[e.jsx(G,{onClick:()=>u(!1),children:"Cancel"}),e.jsx(G,{onClick:U,children:"Update"})]})]}),e.jsx($e,{open:D,autoHideDuration:6e3,onClose:()=>c(!1),message:"Treatment updated successfully!"})]})};function Oo(n,s,a){var S;if(!n||n.length===0)return null;const l=(S=n[0])==null?void 0:S.toothConditions;if(!l)return null;let o;try{o=JSON.parse(l)}catch(i){return console.error("Error parsing toothConditions string:",i),null}const r=o.findIndex(i=>i.id===s);return r!==-1?(o[r]={...o[r],...a},o):(console.warn(`Tooth condition with ID ${s} not found.`),null)}const _o=(n,s)=>{const a=JSON.stringify(n);return new Promise((l,o)=>{fetch(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({toothConditions:a})}).then(r=>r.ok?r.json():r.json().then(S=>{throw new Error(S.message||`HTTP error! status: ${r.status}`)})).then(r=>{console.log("API Response:",r),l({success:!0,message:"Tooth conditions saved successfully!"})}).catch(r=>{console.error("API Error:",r),o({success:!1,message:r.message||"Failed to save tooth conditions."})})})},Pa=()=>{var B,K;const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState([]),[o,r]=t.useState(!0),[S,i]=t.useState(null),[x,u]=t.useState(!1),[h,v]=t.useState(null),[D,c]=t.useState(!1),[Q,Y]=t.useState(""),L=t.useCallback(async()=>{var M;if((M=s==null?void 0:s.user)!=null&&M.entity_name){r(!0);try{const w=await fetch(`${n}/clinics/cbyname/${s.user.entity_name}`,{method:"GET"});if(!w.ok)throw new Error(`HTTP error! Status: ${w.status}`);const j=[await w.json()];Array.isArray(j)?l(j):(i("Unexpected API response: Expected an array of clinic data."),l([])),i(null)}catch(w){i(w.message),l([])}finally{r(!1)}}},[(B=s==null?void 0:s.user)==null?void 0:B.entity_name,n]);t.useEffect(()=>{L()},[L]);const J=M=>{var C;const w=(C=a[0])==null?void 0:C.toothConditions;if(!w){i("No tooth conditions data found.");return}let j;try{j=JSON.parse(w)}catch(f){console.error("Error parsing toothConditions string:",f),i("Invalid tooth conditions data format.");return}const m=j.find(f=>f.id===M);if(!m){i(`Tooth condition with ID ${M} not found.`);return}v(m),Y(m.name),u(!0)},_=async()=>{var w;if(!h)return;const M=Oo(a,h.id,{name:Q});if(M){try{const j=await _o(M,`${n}/clinics/name/${(w=s==null?void 0:s.user)==null?void 0:w.entity_name}`);j.success?(console.log(j.message),l(m=>m.map(C=>({...C,toothConditions:JSON.stringify(M)}))),c(!0)):i(j.message||"Failed to save tooth conditions.")}catch(j){const m=j.message||"An unexpected error occurred. Please try again.";i(m),console.error("Error sending data:",j)}finally{r(!1)}i(null),u(!1)}else i("Failed to update tooth condition. Check console for details.")},P=t.useCallback(M=>{var C;const w=(C=a[0])==null?void 0:C.toothConditions;if(!w){i("No tooth conditions data found.");return}let j;try{j=JSON.parse(w)}catch(f){console.error("Error parsing toothConditions string:",f),i("Invalid tooth conditions data format.");return}const m=j.filter(f=>f.id!==M);l(f=>f.map(T=>({...T,toothConditions:JSON.stringify(m)}))),c(!0)},[a]),U=[{field:"id",headerName:"ID",width:70},{field:"name",headerName:"Name",width:150},{field:"actions",type:"actions",headerName:"Actions",width:150,getActions:M=>[e.jsx(ge,{icon:e.jsx(rt,{}),label:"Edit",onClick:()=>J(M.row.id),showInMenu:!0}),e.jsx(ge,{icon:e.jsx(ot,{}),label:"Delete",onClick:()=>P(M.row.id),showInMenu:!0})]}];let Z=[];if(a&&a.length>0&&((K=a[0])!=null&&K.toothConditions))try{Z=JSON.parse(a[0].toothConditions)}catch(M){console.error("Error parsing toothConditions data",M),Z=[],i("Error parsing tooth conditions data. Please check the data source.")}else Z=[];return o?e.jsx(W,{children:"Loading..."}):e.jsxs(ne,{sx:{p:4},children:[S&&e.jsxs(ye,{severity:"error",sx:{mb:2},children:[e.jsx(zt,{children:"Error"}),S]}),e.jsx(ne,{sx:{height:"auto",width:"100%"},children:e.jsx(we,{rows:Z,columns:U,initialState:{pagination:{paginationModel:{pageSize:5}}},pageSizeOptions:[5,10,20]})}),e.jsxs(Ce,{open:x,onClose:()=>u(!1),children:[e.jsx(Ne,{children:"Edit Tooth Condition"}),e.jsxs(ve,{children:[e.jsx(Ue,{children:"Edit the tooth condition details below."}),e.jsx(R,{autoFocus:!0,margin:"dense",id:"name",label:"Name",value:Q,onChange:M=>Y(M.target.value),fullWidth:!0,variant:"standard"})]}),e.jsxs(Ie,{children:[e.jsx(G,{onClick:()=>u(!1),children:"Cancel"}),e.jsx(G,{onClick:_,children:"Update"})]})]}),e.jsx($e,{open:D,autoHideDuration:6e3,onClose:()=>c(!1),message:"Tooth condition updated successfully!"})]})};function Aa(n){const s="https://dental-clinic-latest.onrender.com",{session:a}=he(),[l,o]=t.useState(""),[r,S]=t.useState(""),[i,x]=t.useState("");Te().tz("Africa/Nairobi").format("DD/MM/YYYY, h:mm:ss A");const u=()=>{fetch(`${s}/tooth-condition`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:l})}).then(h=>h.status==201?h.json():null).then(h=>{o("")})};return e.jsxs(ft,{...n,children:[e.jsx(at,{enableColorScheme:!0}),e.jsx(V,{direction:"column",component:"main",sx:[{justifyContent:"center",height:"calc((1 - var(--template-frame-height, 0)) * 100%)",marginTop:"max(0px - var(--template-frame-height, 0px), 0px)",minHeight:"100%"},h=>({"&::before":{content:'""',display:"block",position:"absolute",zIndex:-1,inset:0,backgroundImage:"radial-gradient(ellipse at 50% 50%, hsl(210, 100%, 97%), hsl(0, 0%, 100%))",backgroundRepeat:"no-repeat",...h.applyStyles("dark",{backgroundImage:"radial-gradient(at 50% 50%, hsla(210, 100%, 16%, 0.5), hsl(220, 30%, 5%))"})}})],children:e.jsx(V,{direction:{xs:"column-reverse",md:"row"},sx:{justifyContent:"center",gap:{xs:6,sm:12},p:2,mx:"auto"},children:e.jsx(V,{direction:{xs:"column-reverse",md:"row"},sx:{justifyContent:"center",gap:{xs:6,sm:12},p:{xs:2,sm:4},m:"auto",mt:0},spacing:2,children:e.jsxs(ne,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:"36ch",marginTop:0}},noValidate:!0,autoComplete:"off",children:[e.jsx("div",{children:e.jsx(R,{required:!0,id:"name",label:"Possible tooth condition",onChange:h=>o(h.target.value),type:"text",value:l,variant:"standard"})}),e.jsx(G,{sx:{textTransform:"none",float:"center"},variant:"contained",onClick:u,children:"Add Condition"})]})})})})]})}function Ro(n){var h;const s="https://dental-clinic-latest.onrender.com",{session:a}=he(),[l,o]=t.useState(""),[r,S]=t.useState(""),[i,x]=t.useState("");Te().tz("Africa/Nairobi").format("DD/MM/YYYY, h:mm:ss A");const u=()=>{fetch(`${s}/tpcondition`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:l})}).then(v=>v.status==201?v.json():null).then(v=>{o("")})};return e.jsxs(ft,{...n,children:[e.jsx(at,{enableColorScheme:!0}),e.jsx(V,{direction:"column",component:"main",sx:[{justifyContent:"center",height:"calc((1 - var(--template-frame-height, 0)) * 100%)",marginTop:"max(0px - var(--template-frame-height, 0px), 0px)",minHeight:"100%"},v=>({"&::before":{content:'""',display:"block",position:"absolute",zIndex:-1,inset:0,backgroundImage:"radial-gradient(ellipse at 50% 50%, hsl(210, 100%, 97%), hsl(0, 0%, 100%))",backgroundRepeat:"no-repeat",...v.applyStyles("dark",{backgroundImage:"radial-gradient(at 50% 50%, hsla(210, 100%, 16%, 0.5), hsl(220, 30%, 5%))"})}})],children:e.jsx(V,{direction:{xs:"column-reverse",md:"row"},sx:{justifyContent:"center",gap:{xs:6,sm:12},p:2,mx:"auto"},children:e.jsx(V,{direction:{xs:"column-reverse",md:"row"},sx:{justifyContent:"center",gap:{xs:6,sm:12},p:{xs:2,sm:4},m:"auto",mt:0},spacing:2,children:e.jsxs(ne,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:"36ch",marginTop:0}},noValidate:!0,autoComplete:"off",children:[e.jsxs("div",{children:[e.jsx(R,{id:"name",label:"Special Condition",onChange:v=>o(v.target.value),type:"search",value:l,variant:"standard"}),e.jsx(R,{id:"entity_name",label:"Entity Name",type:"search",InputProps:{readOnly:!0},variant:"standard",value:(h=a==null?void 0:a.user)==null?void 0:h.entity_name})]}),e.jsx(G,{sx:{textTransform:"none",float:"center"},variant:"contained",onClick:u,children:"Add"})]})})})})]})}function Lo(){const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState(!1),[o,r]=t.useState(!0),[S,i]=t.useState(""),[x,u]=t.useState(!0),[h,v]=t.useState(),[D,c]=t.useState(!1),[Q,Y]=t.useState(0),[L,J]=t.useState([]),_=(w,j)=>{j!=="clickaway"&&l(!1)},P=()=>{c(!1)},U=t.useCallback((w,j)=>()=>{c(!0),v(w),i(j)},[]),Z=t.useCallback(w=>()=>{confirm("Are you sure you want to delete this Condition ?")&&fetch(`${n}/tpcondition/${w}`,{method:"DELETE"}).then(j=>{j.ok?J(m=>m.filter(C=>C.id!==w)):console.error(`Failed to delete case with ID: ${w}`)}).catch(j=>{console.error(`Error deleting case with ID: ${w}`,j)})},[]),B=async()=>{try{const w=await fetch(`${n}/tpcondition/${h}?name=${S}`,{method:"PUT"});if(!w.ok){const j=await w.json();console.error("API Error:",j);return}u(!1),l(!0)}catch(w){console.error("Fetch Error:",w)}u(!0)};t.useEffect(()=>{var w;x&&(r(!0),fetch(`${n}/tpcondition/tp/${(w=s==null?void 0:s.user)==null?void 0:w.entity_name}`,{method:"GET"}).then(j=>j.status===200?j.json():null).then(j=>{j!==null&&J(j),u(!1),r(!1)}))},[x]);const K=[{field:"id",headerName:"ID",width:70},{field:"name",headerName:"Instruction",width:130},{field:"actions",type:"actions",headerName:"Actions",width:90,getActions:w=>[e.jsx(ge,{icon:e.jsx(rt,{sx:{color:"blue"}}),label:"Edit",onClick:U(w.row.id,w.row.name),showInMenu:!0},"edit"),e.jsx(ge,{icon:e.jsx(ot,{sx:{color:"red"}}),label:"Delete",onClick:Z(w.row.id),showInMenu:!0},"delete")]}],M=L;return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:10}}),e.jsxs("div",{style:{height:400,width:"100%"},children:[o?e.jsx("p",{children:"Loading..."}):e.jsx(we,{rows:M,columns:K,pagination:!0}),e.jsxs("div",{children:[e.jsxs(Ce,{open:D,onClose:P,PaperProps:{component:"form",onSubmit:w=>{w.preventDefault();const j=new FormData(w.currentTarget),C=Object.fromEntries(j.entries()).email;console.log(C),P()}},children:[e.jsx(Ne,{children:e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:26},children:"Edit Info"})}),e.jsx(ve,{children:e.jsx(Ue,{children:e.jsx(R,{id:"name",label:"Prothesis Name",onChange:w=>i(w.target.value),type:"search",value:S,variant:"standard"})})}),e.jsxs(Ie,{children:[e.jsx(G,{sx:{textTransform:"none"},variant:"outlined",onClick:P,children:"Cancel"}),e.jsx(G,{onClick:B,type:"submit",color:"success",variant:"contained",sx:{textTransform:"none"},children:"Update"})]})]}),e.jsx($e,{open:a,autoHideDuration:1500,onClose:_,children:e.jsx(ye,{onClose:_,severity:"success",variant:"filled",sx:{width:"100%"},children:"Success"})})]})]})]})}function zo(n){const s="https://dental-clinic-latest.onrender.com",{session:a}=he(),[l,o]=t.useState(""),[r,S]=t.useState(""),[i,x]=t.useState("");Te().tz("Africa/Nairobi").format("DD/MM/YYYY, h:mm:ss A");const u=()=>{fetch(`${s}/registrationfee`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({regFee:l})}).then(h=>h.status==201?h.json():null).then(h=>{o("")})};return e.jsxs(ft,{...n,children:[e.jsx(at,{enableColorScheme:!0}),e.jsx(V,{children:e.jsxs(ne,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:"36ch",marginTop:0}},noValidate:!0,autoComplete:"off",children:[e.jsx("div",{children:e.jsx(R,{id:"name",label:"Set Registration Fee",onChange:h=>o(h.target.value),type:"search",value:l,variant:"standard"})}),e.jsx(G,{sx:{textTransform:"none",float:"center"},variant:"contained",onClick:u,children:"Save Fee"})]})})]})}function Bo(){const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState(!1),[o,r]=t.useState(!0),[S,i]=t.useState(""),[x,u]=t.useState(!0),[h,v]=t.useState(),[D,c]=t.useState(!1),[Q,Y]=t.useState(0),[L,J]=t.useState([]),_=(w,j)=>{j!=="clickaway"&&l(!1)},P=()=>{c(!1)},U=t.useCallback((w,j)=>()=>{c(!0),v(w),i(j)},[]),Z=t.useCallback(w=>()=>{confirm("Are you sure you want to delete this Prothesis ?")&&fetch(`${n}/registrationfee/${w}`,{method:"DELETE"}).then(j=>{j.ok?J(m=>m.filter(C=>C.id!==w)):console.error(`Failed to delete case with ID: ${w}`)}).catch(j=>{console.error(`Error deleting case with ID: ${w}`,j)})},[]),B=async()=>{try{const w=await fetch(`${n}/registrationfee/${h}?regFee=${S}`,{method:"PUT"});if(!w.ok){const j=await w.json();console.error("API Error:",j);return}u(!1),l(!0)}catch(w){console.error("Fetch Error:",w)}u(!0)};t.useEffect(()=>{var w;x&&(r(!0),fetch(`${n}/registrationfee/regfee/${(w=s==null?void 0:s.user)==null?void 0:w.entity_name}`,{method:"GET"}).then(j=>j.status===200?j.json():null).then(j=>{j!==null&&J(j),u(!1),r(!1)}))},[x]);const K=[{field:"id",headerName:"ID",width:70},{field:"regFee",headerName:"Current Registration Fee",width:200},{field:"actions",type:"actions",headerName:"Actions",width:90,getActions:w=>[e.jsx(ge,{icon:e.jsx(rt,{sx:{color:"blue"}}),label:"Edit",onClick:U(w.row.id,w.row.regFee)},"edit"),e.jsx(ge,{icon:e.jsx(ot,{sx:{color:"red"}}),label:"Delete",onClick:Z(w.row.id),showInMenu:!0},"delete")]}],M=L;return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:10}}),e.jsxs("div",{style:{height:400,width:"100%"},children:[o?e.jsx("p",{children:"Loading..."}):e.jsx(we,{rows:M,columns:K,pagination:!0}),e.jsxs("div",{children:[e.jsxs(Ce,{open:D,onClose:P,PaperProps:{component:"form",onSubmit:w=>{w.preventDefault();const j=new FormData(w.currentTarget),C=Object.fromEntries(j.entries()).email;console.log(C),P()}},children:[e.jsx(Ne,{children:e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:26},children:"Edit Info"})}),e.jsx(ve,{children:e.jsx(Ue,{children:e.jsx(R,{id:"name",label:"New Registration Fee",onChange:w=>i(w.target.value),type:"search",value:S,variant:"standard"})})}),e.jsxs(Ie,{children:[e.jsx(G,{sx:{textTransform:"none"},variant:"outlined",onClick:P,children:"Cancel"}),e.jsx(G,{onClick:B,type:"submit",color:"success",variant:"contained",sx:{textTransform:"none"},children:"Update"})]})]}),e.jsx($e,{open:a,autoHideDuration:1500,onClose:_,children:e.jsx(ye,{onClose:_,severity:"success",variant:"filled",sx:{width:"100%"},children:"Success"})})]})]})]})}function Uo(n){var F,k;const s="https://dental-clinic-latest.onrender.com",{session:a}=he(),[l,o]=t.useState([]),[r,S]=t.useState(""),[i,x]=t.useState(""),[u,h]=t.useState(""),[v,D]=t.useState([]),[c,Q]=t.useState(""),[Y,L]=t.useState(new Date().getMonth()+1),[J,_]=t.useState(new Date().getFullYear()),[P,U]=t.useState(),[Z,B]=t.useState(""),[K,M]=t.useState(!1),[w,j]=t.useState(""),[m,C]=t.useState(null),f=(F=a==null?void 0:a.user)==null?void 0:F.entity_name,T=se(f),N=ee(J),z=Y.toString().padStart(2,"0");function ee(g){return g.toString().slice(-2)}function se(g){return g?g.split(" ").map(O=>O.charAt(0).toUpperCase()).join(""):""}async function H(){var g;try{const $=await fetch(`${s}/cases/monthly/${J}/${Y}/${(g=a==null?void 0:a.user)==null?void 0:g.entity_name}`);if(!$.ok)throw new Error(`HTTP error! status: ${$.status}`);const A=await $.json();h((A+1).toString().padStart(4,"0")),console.log(u)}catch($){console.error("Fetch error:",$)}}t.useEffect(()=>{var g;fetch(`${s}/prothesis/pro/${(g=a==null?void 0:a.user)==null?void 0:g.entity_name}`,{method:"GET"}).then($=>$.status===200?$.json():null).then($=>{$!==null&&(D($),x(""))})},[]),t.useEffect(()=>{r&&fetch(`${s}/patients/${r}`,{method:"GET"}).then(g=>g.status===200?g.json():null).then(g=>{g!==null&&j(g.shade)})},[r]);const E=g=>{x(g),B(""),M(!1),H(),console.log(u)};t.useEffect(()=>{(async()=>{var $,A;if(($=a==null?void 0:a.user)!=null&&$.name)try{const O=await fetch(`${s}/patients/patient/${(A=a==null?void 0:a.user)==null?void 0:A.name}`);if(O.ok){const te=await O.json();o(te)}else console.error("Failed to fetch patients:",O.status),o([])}catch(O){console.error("Error fetching patients:",O),o([])}else o([])})()},[(k=a==null?void 0:a.user)==null?void 0:k.name]),Nt().tz("Africa/Nairobi").format("YYYY-MM-DD HH:mm:ss");const I=()=>{var g,$;if(i.trim()===""){B("This Field is Required"),M(!0);return}fetch(`${s}/cases/add-case`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({doctor:(g=a==null?void 0:a.user)==null?void 0:g.name,patient:r,caseNumber:`${T}/CAS/${N}${z}-${u}`,caseName:i,caseStatus:"0",entity_name:($=a==null?void 0:a.user)==null?void 0:$.entity_name,isSubmitted:!1,status:"Draft",shade:w})}).then(A=>A.status==201?A.json():null).then(A=>{h(""),x(""),S("")})};return e.jsxs(ft,{...n,children:[e.jsx(at,{enableColorScheme:!0}),e.jsx(V,{children:e.jsxs(Ye,{sx:{width:350},children:[e.jsx(Re,{options:l.map(g=>g.fullName),renderInput:g=>e.jsx(R,{...g,label:"Choose Patient"}),onChange:(g,$)=>{S($)},value:r,size:"small",sx:{mb:2}})," ",e.jsx(Re,{options:v.map(g=>g.name),renderInput:g=>e.jsx(R,{...g,label:"Prothesis "}),onChange:(g,$)=>{H(),E($)},size:"small",sx:{mb:2}}),e.jsx(G,{sx:{textTransform:"none",float:"center"},variant:"contained",onClick:I,children:"Add Case"})]})})]})}const Ia=["Draft","Received","Pending","Started","Halfway","Finalizing","Completed"],Jo=yt(Ze)(({theme:n})=>{var s,a,l,o,r,S,i,x,u,h,v,D,c,Q,Y,L,J,_,P,U,Z,B,K,M,w,j,m,C,f,T,N,z,ee,se,H,E,I,F,k,g,$,A,O,te,pe,re,de,je,Me,Se,be,Le,fe,Ee,Fe,oe,ce,me,De,Pe,Be,et,Je,mt,Ke,ut,ht,Oe,vt,pt;return{justifyContent:"left","& .icon":{color:"inherit"},"&.Draft":{color:((l=(a=(s=n==null?void 0:n.vars)==null?void 0:s.palette)==null?void 0:a.default)==null?void 0:l.dark)||((r=(o=n==null?void 0:n.palette)==null?void 0:o.default)==null?void 0:r.dark)||"grey",border:`1px solid ${((x=(i=(S=n==null?void 0:n.vars)==null?void 0:S.palette)==null?void 0:i.default)==null?void 0:x.main)||((h=(u=n==null?void 0:n.palette)==null?void 0:u.default)==null?void 0:h.main)||"lightgrey"}`},"&.Received":{color:((c=(D=(v=n==null?void 0:n.vars)==null?void 0:v.palette)==null?void 0:D.info)==null?void 0:c.dark)||((Y=(Q=n==null?void 0:n.palette)==null?void 0:Q.info)==null?void 0:Y.dark)||"blue",border:`1px solid ${((_=(J=(L=n==null?void 0:n.vars)==null?void 0:L.palette)==null?void 0:J.info)==null?void 0:_.main)||((U=(P=n==null?void 0:n.palette)==null?void 0:P.info)==null?void 0:U.main)||"lightblue"}`},"&.Pending":{color:((K=(B=(Z=n==null?void 0:n.vars)==null?void 0:Z.palette)==null?void 0:B.secondary)==null?void 0:K.dark)||((w=(M=n==null?void 0:n.palette)==null?void 0:M.secondary)==null?void 0:w.dark)||"purple",border:`1px solid ${((C=(m=(j=n==null?void 0:n.vars)==null?void 0:j.palette)==null?void 0:m.secondary)==null?void 0:C.main)||((T=(f=n==null?void 0:n.palette)==null?void 0:f.secondary)==null?void 0:T.main)||"violet"}`},"&.Started":{color:((ee=(z=(N=n==null?void 0:n.vars)==null?void 0:N.palette)==null?void 0:z.primary)==null?void 0:ee.dark)||((H=(se=n==null?void 0:n.palette)==null?void 0:se.primary)==null?void 0:H.dark)||"darkgreen",border:`1px solid ${((F=(I=(E=n==null?void 0:n.vars)==null?void 0:E.palette)==null?void 0:I.primary)==null?void 0:F.main)||((g=(k=n==null?void 0:n.palette)==null?void 0:k.primary)==null?void 0:g.main)||"green"}`},"&.Halfway":{color:((O=(A=($=n==null?void 0:n.vars)==null?void 0:$.palette)==null?void 0:A.primary)==null?void 0:O.main)||((pe=(te=n==null?void 0:n.palette)==null?void 0:te.primary)==null?void 0:pe.main)||"green",border:`1px solid ${((je=(de=(re=n==null?void 0:n.vars)==null?void 0:re.palette)==null?void 0:de.primary)==null?void 0:je.light)||((Se=(Me=n==null?void 0:n.palette)==null?void 0:Me.primary)==null?void 0:Se.light)||"lightgreen"}`},"&.Finalizing":{color:((fe=(Le=(be=n==null?void 0:n.vars)==null?void 0:be.palette)==null?void 0:Le.warning)==null?void 0:fe.dark)||((Fe=(Ee=n==null?void 0:n.palette)==null?void 0:Ee.warning)==null?void 0:Fe.dark)||"orange",border:`1px solid ${((me=(ce=(oe=n==null?void 0:n.vars)==null?void 0:oe.palette)==null?void 0:ce.warning)==null?void 0:me.main)||((Pe=(De=n==null?void 0:n.palette)==null?void 0:De.warning)==null?void 0:Pe.main)||"yellow"}`},"&.Completed":{color:((Je=(et=(Be=n==null?void 0:n.vars)==null?void 0:Be.palette)==null?void 0:et.success)==null?void 0:Je.dark)||((Ke=(mt=n==null?void 0:n.palette)==null?void 0:mt.success)==null?void 0:Ke.dark)||"darkblue",border:`1px solid ${((Oe=(ht=(ut=n==null?void 0:n.vars)==null?void 0:ut.palette)==null?void 0:ht.success)==null?void 0:Oe.main)||((pt=(vt=n==null?void 0:n.palette)==null?void 0:vt.success)==null?void 0:pt.main)||"blue"}`}}}),Ho=t.memo(n=>{const{status:s}=n;let a=null;s==="Draft"?a=e.jsx(rt,{className:"icon"}):s==="Received"?a=e.jsx(ga,{className:"icon"}):s==="Pending"?a=e.jsx(xa,{className:"icon"}):s==="Started"?a=e.jsx(ja,{className:"icon"}):s==="Halfway"?a=e.jsx(ya,{className:"icon"}):s==="Finalizing"?a=e.jsx($s,{className:"icon"}):s==="Completed"&&(a=e.jsx(Sa,{className:"icon"}));let l=s;return s==="Finalizing"&&(l="Finalizing"),e.jsx(Jo,{className:s,icon:a,size:"small",label:l,variant:"outlined"})});function Wo(n){const{id:s,value:a,field:l}=n,o=Ar(),r=Ir(),S=async x=>{await r.current.setEditCellValue({id:s,field:l,value:x.target.value})&&o.editMode===_r.Cell&&r.current.stopCellEditMode({id:s,field:l,cellToFocusAfter:"below"})},i=(x,u)=>{u==="backdropClick"&&r.current.stopCellEditMode({id:s,field:l,ignoreModifications:!0})};return e.jsx(Mr,{value:a,onChange:S,MenuProps:{onClose:i},sx:{height:"100%","& .MuiSelect-select":{display:"flex",alignItems:"center",pl:1}},autoFocus:!0,fullWidth:!0,open:!0,children:Ia.map(x=>{let u=null;x==="Draft"?u=rt:x==="Received"?u=ga:x==="Pending"?u=xa:x==="Started"?u=ja:x==="Halfway"?u=ya:x==="Finalizing"?u=$s:x==="Completed"&&(u=Sa);let h=x;return x==="Finalizing"&&(h="Finalizing"),e.jsxs(Fr,{value:x,children:[e.jsx(Or,{sx:{minWidth:36},children:e.jsx(u,{fontSize:"small"})}),e.jsx(Ot,{primary:h,sx:{overflow:"hidden"}})]},x)})})}function Yo(n){return n.value==null?"":e.jsx(Ho,{status:n.value})}function Go(n){return e.jsx(Wo,{...n})}function qo(n){const s="https://dental-clinic-latest.onrender.com",a="Adult Tooth Chart",{session:l}=he(),[o,r]=t.useState(!1),[S,i]=t.useState(!1),[x,u]=t.useState(null),[h,v]=t.useState(null),[D,c]=t.useState([]),[Q,Y]=t.useState([]),[L,J]=t.useState([]),[_,P]=t.useState([]),[U,Z]=ae.useState(""),[B,K]=t.useState({}),[M,w]=t.useState(!1),[j,m]=t.useState(""),[C,f]=t.useState(!0),[T,N]=t.useState(null),[z,ee]=t.useState(""),[se,H]=t.useState(),[E,I]=t.useState(n.caseId),[F,k]=t.useState(),[g,$]=t.useState(""),[A,O]=t.useState(""),[te,pe]=ae.useState([]),[re,de]=ae.useState([]),[je,Me]=t.useState(new Map),[Se,be]=ae.useState([]),[Le,fe]=ae.useState([]),[Ee,Fe]=t.useState(!1),[oe,ce]=t.useState([]),[me,De]=t.useState(),[Pe,Be]=t.useState({}),[et,Je]=t.useState({}),[mt,Ke]=t.useState({}),[ut,ht]=t.useState(!1),[Oe,vt]=t.useState(null),[pt,Rn]=t.useState(null),[tt,gt]=t.useState(null),[ue,Jt]=ae.useState(null),[Et,Dt]=t.useState(null),[He,Sn]=t.useState(n.caseId),[xt,Ms]=t.useState(""),[Fs,Ht]=t.useState(""),[bn,hs]=ae.useState([]),[wn,Cn]=ae.useState([]),[Wt,Ln]=ae.useState([]);t.useEffect(()=>{(async()=>{if(He)try{const ie=await fetch(`${s}/cases/${He}`);if(ie.ok){const Qe=await ie.json();Jt(Qe),Z("")}else console.error("Failed to fetch patients:",ie.status)}catch(ie){console.error("Error fetching patients:",ie)}})()},[He]),t.useEffect(()=>{(async()=>{if(E)try{const ie=await fetch(`${s}/switch/${E}`);if(ie.ok){const Qe=await ie.json();Je(Qe.label)}else console.error("Failed to fetch switch states:",ie.status)}catch(ie){console.error("Error fetching switch states:",ie)}})()},[E]),t.useEffect(()=>{(async()=>{if(!E){Ke({});return}try{const ie=await fetch(`${s}/at-switch/${E}`);if(ie.ok){const Qe=await ie.json();Ke(Qe.attachmentstate)}else console.error("Failed to fetch switch states: pd not selected",ie.status)}catch(ie){console.error("Error fetching switch states:",ie)}})()},[E]),t.useEffect(()=>{(async()=>{if(!E){Be({});return}try{const ie=await fetch(`${s}/spcondition/${He}`);if(ie.ok){const Qe=await ie.json();Be(Qe?Qe.spcondition:{...Pe})}else console.error("Failed to fetch switch states:",ie.status)}catch(ie){console.error("Error fetching switch states:",ie)}})()},[He]),ae.useEffect(()=>{fetch(`${s}/tpcondition/tp/${ue==null?void 0:ue.entity_name}`,{method:"GET"}).then(X=>X.status===200?X.json():null).then(X=>{X!==null&&Cn(X)})},[ue==null?void 0:ue.entity_name]),ae.useEffect(()=>{fetch(`${s}/enclosed/attachment/${ue==null?void 0:ue.entity_name}`,{method:"GET"}).then(X=>X.status===200?X.json():null).then(X=>{X!==null&&Ln(X)})},[ue==null?void 0:ue.entity_name]),ae.useEffect(()=>{fetch(`${s}/sinstruction/instruction/${ue==null?void 0:ue.entity_name}`,{method:"GET"}).then(X=>X.status===200?X.json():null).then(X=>{X!==null&&hs(X)})},[ue==null?void 0:ue.entity_name]),ae.useEffect(()=>{fetch(`${s}/prothesis/pro/${ue==null?void 0:ue.entity_name}`,{method:"GET"}).then(X=>X.status===200?X.json():null).then(X=>{X!==null&&de(X)})},[ue==null?void 0:ue.entity_name]),ae.useEffect(()=>{fetch(`${s}/tooth-condition`,{method:"GET"}).then(X=>X.status===200?X.json():null).then(X=>{X!==null&&ce(X)})},[]),t.useEffect(()=>{(async()=>{if(xt)try{const ie=await fetch(`${s}/patients/patient/${xt}`);if(ie.ok){const Qe=await ie.json();P(Qe),Z("")}else console.error("Failed to fetch patients:",ie.status),P([]),Z("")}catch(ie){console.error("Error fetching patients:",ie),P([]),Z("")}else P([]),Z("")})()},[xt]);const zn=Ts({palette:{mode:"light",primary:{main:fn[500]},secondary:{main:fn[500]}}});t.useEffect(()=>{(async()=>{if(f(!0),N(null),He)try{const ie=await fetch(`${s}/1/api/button-data/${E}`);if(!ie.ok)throw new Error(`HTTP error! status: ${ie.status}`);const Qe=await ie.json();K(Qe.buttonColors),I(He),Fe(!0)}catch(ie){console.error("Error fetching data:",ie),N("Error Fetching data")}finally{f(!1)}else J([]),K({})})()},[He]);const Bn=Array.from({length:8},(X,ie)=>18-ie).map(X=>e.jsx(G,{variant:B[X]||"outlined",children:X},X)),Un=Array.from({length:8},(X,ie)=>ie+21).map(X=>e.jsx(G,{variant:B[X]||"outlined",children:X},X)),Jn=Array.from({length:8},(X,ie)=>48-ie).map(X=>e.jsx(G,{variant:B[X]||"outlined",children:X},X)),Hn=Array.from({length:8},(X,ie)=>ie+31).map(X=>e.jsx(G,{variant:B[X]||"outlined",children:X},X)),Wn=async()=>{if(He)try{const X=await fetch(`${s}/task-info/patient/${He}`);if(X.ok){const ie=await X.json();be(ie)}else console.error("Failed to fetch patients:",X.status),be([])}catch(X){console.error("Error fetching patients:",X),be([])}else be([])};t.useEffect(()=>{Wn()},[He]);const Yt=ae.useMemo(()=>[{field:"teeth",type:"string"},{field:"prothesis",type:"string"},{field:"teeth_condition",type:"string"},{field:"product",type:"string"},{field:"price",type:"string"},{field:"reg_date",type:"string"}],[]);return e.jsxs(Ns,{theme:zn,children:[e.jsx(at,{}),e.jsx(ne,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexWrap:"wrap",height:"50vh","& > :not(style)":{m:1,width:"80%",padding:3,border:"none"}},children:e.jsxs(V,{sx:{border:"none"},children:[e.jsxs(V,{spacing:1,direction:"column",sx:{border:"none",p:1},children:[e.jsxs(ne,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:"200",marginTop:0}},noValidate:!0,autoComplete:"off",children:[e.jsx(W,{sx:{paddingLeft:0,fontWeight:"bold",fontSize:18},children:"DENTIST DETAILS"}),e.jsx(ne,{sx:{width:600,mb:5},component:"form",noValidate:!0,autoComplete:"off",children:e.jsxs(V,{spacing:2,direction:"row",children:[e.jsx(W,{children:"Doctor Name:"}),e.jsxs(W,{children:[" ",ue==null?void 0:ue.doctor]})," "]})})]}),e.jsxs(V,{direction:"row",children:[e.jsxs(ne,{component:"form",sx:{"& .MuiTextField-root":{m:1,marginTop:0},border:0,width:200},noValidate:!0,autoComplete:"off",children:[e.jsx(W,{sx:{paddingLeft:0,fontWeight:"bold",fontSize:18},children:"PATIENT DETAILS"}),e.jsxs(ne,{component:"form",noValidate:!0,autoComplete:"off",sx:{width:600},children:[e.jsxs(V,{spacing:2,direction:"row",children:[e.jsx(W,{children:"Patient Name:"}),e.jsxs(W,{children:[" ",ue==null?void 0:ue.patient]})," "]}),e.jsxs(V,{spacing:2,direction:"row",children:[e.jsx(W,{children:"Updated On : "}),e.jsxs(W,{children:[" ",ue==null?void 0:ue.upd_date]})," "]}),e.jsxs(V,{spacing:2,direction:"row",children:[e.jsx(W,{children:"Case Number:"}),e.jsxs(W,{children:[" ",ue==null?void 0:ue.caseNumber]})," "]}),e.jsxs(V,{spacing:2,direction:"row",children:[e.jsx(W,{children:"Case Status:"}),e.jsxs(W,{children:[" ",ue==null?void 0:ue.status]})]})]})]}),e.jsxs(W,{sx:{mt:3,width:"100%",fontWeight:"bold",fontSize:68,textAlign:"center",fontFamily:"Times New Roman, serif"},children:["Shade : ","    ",ue==null?void 0:ue.shade]})," "]})]}),e.jsx(V,{sx:{border:"none",padding:1},children:e.jsxs(V,{sx:{border:0,paddingLeft:1},children:[" ",e.jsx(ne,{sx:{display:"flex",flexDirection:"column",alignItems:"left","& > *":{m:1}},children:e.jsxs(V,{direction:"column",sx:{paddingLeft:1,border:0},children:[e.jsx(W,{sx:{paddingTop:1,paddingRight:6,border:0,m:0,fontSize:27},children:a})," ",e.jsxs(V,{direction:"column",spacing:1,children:[e.jsx(V,{children:e.jsxs(ne,{children:[e.jsx(Ve,{size:"small","aria-label":"Small button group",children:Bn}),e.jsx(Ve,{size:"small","aria-label":"Small button group",children:Un}),e.jsx(us,{orientation:"horizontal",variant:"middle",flexItem:!0,sx:{width:600},children:e.jsx(Ze,{sx:{backgroundColor:"info"},label:"",size:"small"})}),e.jsx(Ve,{size:"small","aria-label":"Small button group",children:Jn}),e.jsx(Ve,{size:"small","aria-label":"Small button group",children:Hn})]})}),e.jsx("div",{children:L.length===0?e.jsx(W,{}):L.map(X=>e.jsx(e.Fragment,{children:e.jsx(Ze,{label:X,onDelete:()=>{J(L.filter(ie=>ie!==X)),K(ie=>({...ie,[X]:"outlined"}))}},X)}))})]})]})})]})}),e.jsx(V,{sx:{border:0,padding:3},children:Ee&&e.jsx("div",{style:{height:"auto",width:"80%"},children:e.jsx(we,{rows:Se,columns:Yt,initialState:{pagination:{paginationModel:{pageSize:5}}}})})}),e.jsxs(V,{sx:{border:0,padding:3},children:[" ",e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:24},children:"Special Instruction"})," ",e.jsxs(V,{sx:{border:0,paddingLeft:2},children:[" ",e.jsx(Ye,{children:bn.map(X=>e.jsx(Xe,{control:e.jsx(un,{checked:et[X.name]||!1}),label:X.name},X.name))}),e.jsx(V,{children:e.jsxs(Ye,{sx:{paddingLeft:5,mt:3},children:[" ",e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:19},children:"Conditions"}),e.jsx(ne,{sx:{display:"flex",flexDirection:"row",flexWrap:"wrap"},children:e.jsx(Ye,{children:wn.map(X=>e.jsx(Xe,{control:e.jsx(un,{checked:Pe[X.name]||!1}),label:X.name},X.name))})})]})})]})]}),e.jsxs(V,{sx:{border:"none",padding:3},children:[e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:24},children:"Enclosed"})," ",e.jsxs(V,{sx:{border:0,paddingLeft:2},children:[" ",e.jsxs(Ye,{sx:{paddingLeft:5,mt:3},children:[e.jsx(ne,{sx:{display:"flex",flexDirection:"row",flexWrap:"wrap"},children:e.jsx(Ye,{children:Wt.map(X=>e.jsx(Xe,{control:e.jsx(un,{checked:mt[X.attachment]||!1}),label:X.attachment},X.attachment))})}),e.jsx(W,{sx:{paddingLeft:2,mt:4,fontWeight:"bold",fontSize:19},children:"Others"}),e.jsx(R,{id:"outlined-basic",label:"Others",variant:"outlined",multiline:!0,rows:4,sx:{width:400,mt:2,mb:2}})]})]})]}),e.jsx(V,{sx:{border:"none",padding:3},children:e.jsxs(V,{sx:{border:0,paddingLeft:2},children:[" ",e.jsxs(Ye,{children:[" ",e.jsx(ne,{sx:{display:"flex",flexDirection:"row",flexWrap:"wrap"}})]})]})}),e.jsx(V,{sx:{border:"none",padding:3},children:e.jsxs(V,{sx:{border:0,paddingLeft:2},children:[" ",e.jsxs(Ye,{children:[" ",e.jsx(ne,{sx:{display:"flex",flexDirection:"row",flexWrap:"wrap"}})]})]})})]})})]})}function Vo(){return[{status:"Started",value:"0.25"}]}function Ko(){const n=Vo(),s=new Map;for(const a of n)s.set(a.status,a.value);return s}const Qo=t.forwardRef(function(s,a){return e.jsx(Ds,{direction:"up",ref:a,...s})});function Zo(){const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState([]),[o,r]=t.useState([]),[S,i]=t.useState(!1),[x,u]=t.useState();Ko();const[h,v]=t.useState(!1),D=t.useCallback((_,P)=>()=>{if(P){alert("Cases Submitted You Cant Delete ");return}confirm("Are you sure you want to delete this case?")&&fetch(`${n}/cases/${_}`,{method:"DELETE"}).then(U=>{U.ok?l(Z=>Z.filter(B=>B.id!==_)):console.error(`Failed to delete case with ID: ${_}`)}).catch(U=>{console.error(`Error deleting case with ID: ${_}`,U)})},[]),c=t.useCallback(_=>()=>{i(!0),u(_)},[]),Q=()=>{i(!1)},Y=(_,P)=>{P!=="clickaway"&&v(!1)};t.useEffect(()=>{var _;fetch(`${n}/cases/clinic/${(_=s==null?void 0:s.user)==null?void 0:_.entity_name}`,{method:"GET"}).then(P=>P.status===200?P.json():null).then(P=>{P!==null&&l(P)})},[]);const L=[{field:"patientName",headerName:"Patient Name",width:120,editable:!1},{field:"caseNumber",headerName:"Case Number",width:160,editable:!1},{field:"updatedDate",headerName:"Updated At",width:170,editable:!1},{field:"status",headerName:"Status",renderCell:Yo,renderEditCell:Go,type:"singleSelect",valueOptions:Ia,width:120,editable:!1},{field:"actions",type:"actions",headerName:"Actions",width:90,getActions:_=>[e.jsx(ge,{icon:e.jsx(Fn,{}),label:"attachment",onClick:()=>{}},"delete"),e.jsx(ge,{icon:e.jsx(ot,{}),label:"Delete",onClick:()=>D(_.row.id,_.row.submitted)(),showInMenu:!0},"delete"),e.jsx(ge,{icon:e.jsx(Fn,{}),label:"View Case",onClick:c(_.row.id),showInMenu:!0},"manage")]}],J=a;return e.jsxs("div",{style:{display:"flex"},children:[e.jsx("div",{style:{height:"auto",width:"auto"},children:e.jsx(we,{rows:J,columns:L})}),e.jsxs(Ce,{fullScreen:!0,open:S,onClose:Q,TransitionComponent:Qo,children:[e.jsx(Ps,{sx:{position:"relative"},children:e.jsxs(As,{children:[e.jsx(On,{edge:"start",color:"inherit",onClick:Q,"aria-label":"close",children:e.jsx(Is,{})}),e.jsx(W,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:"Close"})," "]})}),e.jsx(ve,{children:e.jsx(Ue,{children:e.jsx(qo,{caseId:x})})})]}),e.jsx($e,{open:h,autoHideDuration:1500,onClose:Y,children:e.jsx(ye,{onClose:Y,severity:"success",variant:"filled",sx:{width:"100%"},children:"Successfully!"})})]})}function ca(n,s="TZS",a="en-US"){const l=typeof n=="string"?parseFloat(n):n;return isNaN(l)?"Invalid Amount":l.toLocaleString(a,{style:"currency",currency:s})}const Xo=t.forwardRef(function(s,a){return e.jsx(Ds,{direction:"up",ref:a,...s})});function ei(){var Le;const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState([]),[o,r]=t.useState([]),[S,i]=t.useState(!1),[x,u]=t.useState([]),[h,v]=t.useState(),[D,c]=t.useState(),[Q,Y]=t.useState(!1),[L,J]=t.useState(!1),[_,P]=t.useState(new Map),[U,Z]=t.useState(""),[B,K]=t.useState(""),[M,w]=t.useState(""),[j,m]=t.useState(""),[C,f]=t.useState(""),[T,N]=t.useState(""),[z,ee]=t.useState(""),[se,H]=t.useState(""),[E,I]=t.useState(""),[F,k]=t.useState(!0),[g,$]=t.useState(!0),[A,O]=t.useState("Approve"),te=()=>{J(!1)},pe=()=>{Y(!1)},re=()=>{i(!1)},de=()=>{fetch(`${n}/invoice/${U}?doctype=${B}&billend=${M}&billdate=${j}&discount=${C}&additionalcost=${T}&ducnumber=${z}&client=${E}`).then(fe=>{if(!fe.ok)throw new Error(`HTTP error! status: ${fe.status}`);return fe.blob()}).then(fe=>{const Ee=window.URL.createObjectURL(fe),Fe=document.createElement("a");Fe.href=Ee,Fe.setAttribute("download",z),document.body.appendChild(Fe),Fe.click(),Fe.parentNode&&Fe.parentNode.removeChild(Fe),window.URL.revokeObjectURL(Ee)}).catch(fe=>{console.error("Download error:",fe)})};t.useEffect(()=>{var fe;g&&(k(!0),fetch(`${n}/bills/by-client?client=${(fe=s==null?void 0:s.user)==null?void 0:fe.name}`,{method:"GET"}).then(Ee=>Ee.status===200?Ee.json():null).then(Ee=>{Ee!==null&&l(Ee),k(!1),$(!1)}))},[g,(Le=s==null?void 0:s.user)==null?void 0:Le.entity_name]);const je=t.useCallback((fe,Ee,Fe,oe,ce,me,De,Pe,Be)=>async()=>{Ee=="invoice"&&(I(Be),H(fe),m(Fe),w(oe),K(Ee),f(ce),Z(Pe),N(me),ee(De),i(!0)),I(Be),m(Fe),w(oe),K(Ee),f(ce),Z(Pe),N(me),ee(De),i(!0)},[]),Me=t.useCallback(fe=>()=>{confirm("Are you sure you want to delete this Bill ?")&&fetch(`${n}/bills/${fe}`,{method:"DELETE"}).then(Ee=>{Ee.ok?l(Fe=>Fe.filter(oe=>oe.id!==fe)):console.error(`Failed to delete case with ID: ${fe}`)}).catch(Ee=>{console.error(`Error deleting case with ID: ${fe}`,Ee)})},[]),Se=t.useMemo(()=>[{field:"docnumber",headerName:"Bill Number",width:180,type:"string"},{field:"doctype",headerName:"Bill Type",width:100,type:"string"},{field:"bill_date",headerName:"Created At",width:120,type:"string"},{field:"billend",headerName:"Exipires On",width:100,type:"string"},{field:"billamount",headerName:"Bill Amount",width:140,type:"number",valueFormatter:fe=>typeof fe=="string"||typeof fe=="number"?ca(fe):typeof fe},{field:"actions",type:"actions",headerName:"Actions",width:190,getActions:fe=>[e.jsx(ge,{icon:fe.row.doctype=="invoice"?e.jsx($s,{sx:{color:"green"}}):e.jsx(Fn,{sx:{color:"green"}}),label:fe.row.doctype=="invoice"?"View Invoice":"View Receipt",onClick:je(fe.row.id,fe.row.doctype,fe.row.bill_date,fe.row.billend,fe.row.discount,fe.row.additionalcost,fe.row.docnumber,fe.row.caseId,fe.row.client),showInMenu:!0},"approve")]}],[je,Me]),be=a;return e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx("div",{style:{margin:"10px auto",height:"auto",width:"100%"},children:F?e.jsx("p",{children:"Loading..."}):e.jsx(we,{rows:be,columns:Se,pagination:!0})}),e.jsxs(Ce,{fullScreen:!0,open:S,onClose:re,TransitionComponent:Xo,children:[" ",e.jsx(Ps,{sx:{position:"relative"},children:e.jsxs(As,{children:[e.jsx(On,{edge:"start",color:"inherit",onClick:re,"aria-label":"close",children:e.jsx(Is,{})}),e.jsx(W,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:"Close"}),e.jsx(V,{children:B==="invoice"?e.jsxs("div",{children:[" ",e.jsx(G,{sx:{color:"white"},onClick:de,children:"Download"})]}):e.jsxs("div",{children:[" ",e.jsx(G,{sx:{color:"white"},onClick:de,children:"Download"})]})})]})}),e.jsx(ve,{children:e.jsx(Ue,{})})]}),e.jsx($e,{open:Q,autoHideDuration:1500,onClose:pe,children:e.jsx(ye,{onClose:pe,severity:"success",variant:"filled",sx:{width:"100%"},children:"Approve Success"})}),e.jsx($e,{open:L,autoHideDuration:1500,onClose:te,children:e.jsx(ye,{onClose:te,severity:"success",variant:"filled",sx:{width:"100%"},children:A})})]})}const ti=n=>{const s=new Date(n),a=s.getFullYear(),l=String(s.getMonth()+1).padStart(2,"0"),o=String(s.getDate()).padStart(2,"0"),r=String(s.getHours()).padStart(2,"0"),S=String(s.getMinutes()).padStart(2,"0"),i=s.getTimezoneOffset(),x=Math.abs(Math.floor(i/60)),u=Math.abs(i%60);return`${i>0?"-":"+"}${String(x).padStart(2,"0")}${String(u).padStart(2,"0")}`,`${o}-${l}-${a} ${r}:${S} `};function ni(){const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState(!1),[o,r]=t.useState(!0),[S,i]=t.useState(""),[x,u]=t.useState(!0),[h,v]=t.useState(),[D,c]=t.useState(!1),[Q,Y]=t.useState(0),[L,J]=t.useState([]),[_,P]=t.useState(""),[U,Z]=t.useState(""),[B,K]=t.useState(""),[M,w]=t.useState(""),[j,m]=t.useState(""),[C,f]=t.useState(""),[T,N]=t.useState(""),[z,ee]=t.useState(""),[se,H]=t.useState(null),E=Nt().tz("Africa/Nairobi").format("YYYY-MM-DDTHH:mm:ss"),I=($,A)=>{A!=="clickaway"&&l(!1)},F=t.useCallback(($,A)=>async()=>{var O,te;v($),i(A),r(!0),H(null),u(!1);try{const pe=await fetch(`${n}/registrationfee/firstRegFee/${(O=s==null?void 0:s.user)==null?void 0:O.entity_name}`);if(!pe.ok)throw new Error(`Failed to fetch registration fee: ${pe.status}`);const re=await pe.json();ee(re.regFee.toString());try{const de=await fetch(`${n}/patients/${$}?regFee=${re.regFee}`,{method:"PUT"});if(!de.ok){const je=await de.json();console.error("API Error:",je);return}try{const je=await fetch(`${n}/bills`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({doctype:"registration fee",clinicName:(te=s==null?void 0:s.user)==null?void 0:te.entity_name,bill_date:E,billamount:re.regFee,client:A})});if(!je.ok){console.error("Error creating bill:",await je.json());return}}catch(je){console.error("An error occurred:",je)}l(!0)}catch(de){console.error("Fetch Error:",de)}}catch(pe){H(pe.message)}finally{u(!0),r(!1)}},[]);t.useCallback($=>()=>{confirm("Are you sure you want to delete this Condition ?")&&fetch(`${n}/patients/${$}`,{method:"DELETE"}).then(A=>{A.ok?J(O=>O.filter(te=>te.id!==$)):console.error(`Failed to delete case with ID: ${$}`)}).catch(A=>{console.error(`Error deleting case with ID: ${$}`,A)})},[]),t.useEffect(()=>{var $;x&&(r(!0),fetch(`${n}/patients/noRegFeePatients/${($=s==null?void 0:s.user)==null?void 0:$.entity_name}`,{method:"GET"}).then(A=>A.status===200?A.json():null).then(A=>{A!==null&&J(A),r(!1),u(!1)}))},[x]);const k=[{field:"id",headerName:"ID",width:50},{field:"fullName",headerName:"Full Name",width:130},{field:"regFee",headerName:"Registration Fee",width:130},{field:"address",headerName:"Address",width:130},{field:"regDate",headerName:"Registration Date",width:200,valueFormatter:$=>typeof $=="string"?ti($):typeof $},{field:"gender",headerName:"Gender",width:70},{field:"actions",type:"actions",headerName:"Actions",width:90,getActions:$=>[e.jsx(ge,{icon:e.jsx(_n,{sx:{color:"green"}}),label:"Pay",onClick:F($.row.id,$.row.fullName)},"edit")]}],g=L;return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:10}}),e.jsxs("div",{style:{height:"auto",width:"100%"},children:[o?e.jsx("p",{children:"Loading..."}):e.jsx(we,{rows:g,columns:k,pagination:!0}),e.jsx("div",{children:e.jsx($e,{open:a,autoHideDuration:1500,onClose:I,children:e.jsx(ye,{onClose:I,severity:"success",variant:"filled",sx:{width:"100%"},children:"Success"})})})]})]})}function si(){const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState(!1),[o,r]=t.useState(!0),[S,i]=t.useState(""),[x,u]=t.useState(!0),[h,v]=t.useState(),[D,c]=t.useState(!1),[Q,Y]=t.useState(0),[L,J]=t.useState([]),[_,P]=t.useState(""),[U,Z]=t.useState(""),[B,K]=t.useState(""),[M,w]=t.useState(""),[j,m]=t.useState(""),[C,f]=t.useState(""),[T,N]=t.useState(""),[z,ee]=t.useState(""),[se,H]=t.useState(null),E=Nt().tz("Africa/Nairobi").format("YYYY-MM-DDTHH:mm:ss"),I=($,A)=>{A!=="clickaway"&&l(!1)},F=t.useCallback(($,A)=>async()=>{var O,te;v($),i(A),r(!0),H(null),u(!1);try{const pe=await fetch(`${n}/registrationfee/firstRegFee/${(O=s==null?void 0:s.user)==null?void 0:O.entity_name}`);if(!pe.ok)throw new Error(`Failed to fetch registration fee: ${pe.status}`);const re=await pe.json();ee(re.regFee.toString());try{const de=await fetch(`${n}/patients/${$}?updatedDate=${E}&flag=revisited`,{method:"PUT"});if(!de.ok){const je=await de.json();console.error("API Error:",je);return}try{const je=await fetch(`${n}/bills`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({doctype:"registration fee",clinicName:(te=s==null?void 0:s.user)==null?void 0:te.entity_name,bill_date:E,billamount:re.regFee,client:A})});if(!je.ok){console.error("Error creating bill:",await je.json());return}}catch(je){console.error("An error occurred:",je)}l(!0)}catch(de){console.error("Fetch Error:",de)}}catch(pe){H(pe.message)}finally{u(!0),r(!1)}},[]);t.useCallback($=>()=>{confirm("Are you sure you want to delete this Condition ?")&&fetch(`${n}/patients/${$}`,{method:"DELETE"}).then(A=>{A.ok?J(O=>O.filter(te=>te.id!==$)):console.error(`Failed to delete case with ID: ${$}`)}).catch(A=>{console.error(`Error deleting case with ID: ${$}`,A)})},[]),t.useEffect(()=>{var $;x&&(r(!0),fetch(`${n}/patients/revisit/${($=s==null?void 0:s.user)==null?void 0:$.entity_name}`,{method:"GET"}).then(A=>A.status===200?A.json():null).then(A=>{A!==null&&J(A),r(!1),u(!1)}))},[x]);const k=[{field:"id",headerName:"ID",width:50},{field:"fullName",headerName:"Full Name",width:130},{field:"regFee",headerName:"Registration Fee",width:130},{field:"address",headerName:"Address",width:130},{field:"regDate",headerName:"Registration Date",width:130},{field:"gender",headerName:"Gender",width:70},{field:"actions",type:"actions",headerName:"Actions",width:90,getActions:$=>[e.jsx(ge,{icon:e.jsx(_n,{sx:{color:"green"}}),label:"Pay",onClick:F($.row.id,$.row.fullName)},"edit")]}],g=L;return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:10}}),e.jsxs("div",{style:{height:"auto",width:"100%"},children:[o?e.jsx("p",{children:"Loading..."}):e.jsx(we,{rows:g,columns:k,pagination:!0}),e.jsx("div",{children:e.jsx($e,{open:a,autoHideDuration:1500,onClose:I,children:e.jsx(ye,{onClose:I,severity:"success",variant:"filled",sx:{width:"100%"},children:"Success"})})})]})]})}function da(n,s="TZS",a="en-US"){const l=typeof n=="string"?parseFloat(n):n;return isNaN(l)?"Invalid Amount":l.toLocaleString(a,{style:"currency",currency:s})}function ai(){const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState(!1),[o,r]=t.useState(!0),[S,i]=t.useState(""),[x,u]=t.useState(!0),[h,v]=t.useState(),[D,c]=t.useState(!1),[Q,Y]=t.useState(0),[L,J]=t.useState([]),[_,P]=t.useState(""),[U,Z]=t.useState(""),[B,K]=t.useState(""),[M,w]=t.useState(""),[j,m]=t.useState(""),[C,f]=t.useState(""),[T,N]=t.useState(""),[z,ee]=t.useState(""),[se,H]=t.useState(null);Nt().tz("Africa/Nairobi").format("YYYY-MM-DDTHH:mm:ss");const E=(g,$)=>{$!=="clickaway"&&l(!1)},I=t.useCallback((g,$)=>async()=>{v(g),i($),r(!0),H(null),u(!1);try{const A=await fetch(`${n}/bills/invoicecount/${g}?flag=Paid`,{method:"PUT"});if(!A.ok){const O=await A.json();console.error("API Error:",O);return}l(!0)}catch(A){console.error("Fetch Error:",A)}finally{u(!0),r(!1)}},[]);t.useCallback(g=>()=>{confirm("Are you sure you want to delete this Condition ?")&&fetch(`${n}/bills/${g}`,{method:"DELETE"}).then($=>{$.ok?J(A=>A.filter(O=>O.id!==g)):console.error(`Failed to delete case with ID: ${g}`)}).catch($=>{console.error(`Error deleting case with ID: ${g}`,$)})},[]),t.useEffect(()=>{var g;x&&(r(!0),fetch(`${n}/bills/treatment-bills/${(g=s==null?void 0:s.user)==null?void 0:g.entity_name}`,{method:"GET"}).then($=>$.status===200?$.json():null).then($=>{$!==null&&J($),r(!1),u(!1)}))},[x]);const F=[{field:"docnumber",headerName:"Bill No.",width:150},{field:"doctype",headerName:"Description",width:130},{field:"client",headerName:"Patient Name",width:130},{field:"billamount",headerName:"Bill Amount",type:"number",valueFormatter:g=>typeof g=="string"||typeof g=="number"?da(g):typeof g,width:130},{field:"bill_date",headerName:"Bill Date",width:170},{field:"actions",type:"actions",headerName:"Actions",width:90,getActions:g=>[e.jsx(ge,{icon:e.jsx(_n,{sx:{color:"green"}}),label:"Pay",onClick:I(g.row.id,g.row.caseId),showInMenu:!0},"edit")]}],k=L;return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:10}}),e.jsxs("div",{style:{height:"auto",width:"100%"},children:[o?e.jsx("p",{children:"Loading..."}):e.jsx(we,{rows:k,columns:F,pagination:!0}),e.jsx("div",{children:e.jsx($e,{open:a,autoHideDuration:1500,onClose:E,children:e.jsx(ye,{onClose:E,severity:"success",variant:"filled",sx:{width:"100%"},children:"Success"})})})]})]})}function ua(n,s="TZS",a="en-US"){const l=typeof n=="string"?parseFloat(n):n;return isNaN(l)?"Invalid Amount":l.toLocaleString(a,{style:"currency",currency:s})}function ri(){const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState(!1),[o,r]=t.useState(!0),[S,i]=t.useState(""),[x,u]=t.useState(!0),[h,v]=t.useState(),[D,c]=t.useState(!1),[Q,Y]=t.useState(0),[L,J]=t.useState([]),[_,P]=t.useState(""),[U,Z]=t.useState(""),[B,K]=t.useState(""),[M,w]=t.useState(""),[j,m]=t.useState(""),[C,f]=t.useState(""),[T,N]=t.useState(""),[z,ee]=t.useState(""),[se,H]=t.useState(null);Nt().tz("Africa/Nairobi").format("YYYY-MM-DDTHH:mm:ss");const E=(g,$)=>{$!=="clickaway"&&l(!1)},I=t.useCallback((g,$)=>async()=>{v(g),r(!0),H(null),u(!1);try{const A=await fetch(`${n}/bills/invoicecount/${g}?flag=Paid`,{method:"PUT"});if(!A.ok){const O=await A.json();console.error("API Error:",O);return}l(!0)}catch(A){console.error("Fetch Error:",A)}finally{u(!0),r(!1)}},[]);t.useCallback(g=>()=>{confirm("Are you sure you want to delete this Condition ?")&&fetch(`${n}/bills/${g}`,{method:"DELETE"}).then($=>{$.ok?J(A=>A.filter(O=>O.id!==g)):console.error(`Failed to delete case with ID: ${g}`)}).catch($=>{console.error(`Error deleting case with ID: ${g}`,$)})},[]),t.useEffect(()=>{var g;x&&(r(!0),fetch(`${n}/bills/medication-bills/${(g=s==null?void 0:s.user)==null?void 0:g.entity_name}`,{method:"GET"}).then($=>$.status===200?$.json():null).then($=>{$!==null&&J($),r(!1),u(!1)}))},[x]);const F=[{field:"docnumber",headerName:"Bill No.",width:150},{field:"doctype",headerName:"Description",width:130},{field:"client",headerName:"Patient Name",width:130},{field:"billamount",headerName:"Bill Amount",type:"number",valueFormatter:g=>typeof g=="string"||typeof g=="number"?ua(g):typeof g,width:130},{field:"bill_date",headerName:"Bill Date",width:170},{field:"actions",type:"actions",headerName:"Actions",width:90,getActions:g=>[e.jsx(ge,{icon:e.jsx(_n,{sx:{color:"green"}}),label:"Pay",onClick:I(g.row.id,g.row.client),showInMenu:!0},"edit")]}],k=L;return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:10}}),e.jsxs("div",{style:{height:"auto",width:"100%"},children:[o?e.jsx("p",{children:"Loading..."}):e.jsx(we,{rows:k,columns:F,pagination:!0}),e.jsx("div",{children:e.jsx($e,{open:a,autoHideDuration:1500,onClose:E,children:e.jsx(ye,{onClose:E,severity:"success",variant:"filled",sx:{width:"100%"},children:"Success"})})})]})]})}function oi(){const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState(!1),[o,r]=t.useState(0),[S,i]=t.useState(0),[x,u]=t.useState(0),[h,v]=t.useState(0),[D,c]=t.useState(!0),[Q,Y]=t.useState(null);t.useEffect(()=>{(async()=>{var _;c(!0),Y(null);try{const P=await fetch(`${n}/patients/countNoRegFee/${(_=s==null?void 0:s.user)==null?void 0:_.entity_name}`);if(!P.ok)throw new Error(`Failed to fetch count: ${P.status}`);const U=await P.json();r(U)}catch(P){Y(P.message||"An error occurred while fetching data.")}finally{c(!1)}})()},[]),t.useEffect(()=>{(async()=>{var _;c(!0),Y(null);try{const P=await fetch(`${n}/patients/revisit/count/${(_=s==null?void 0:s.user)==null?void 0:_.entity_name}`);if(!P.ok)throw new Error(`Failed to fetch count: ${P.status}`);const U=await P.json();i(U)}catch(P){Y(P.message||"An error occurred while fetching data.")}finally{c(!1)}})()},[]),t.useEffect(()=>{(async()=>{var _;c(!0),Y(null);try{const P=await fetch(`${n}/bills/treatment-bills/count/${(_=s==null?void 0:s.user)==null?void 0:_.entity_name}`);if(!P.ok)throw new Error(`Failed to fetch count: ${P.status}`);const U=await P.json();u(U)}catch(P){Y(P.message||"An error occurred while fetching data.")}finally{c(!1)}})()},[]),t.useEffect(()=>{(async()=>{var _;c(!0),Y(null);try{const P=await fetch(`${n}/bills/medication-bills/count/${(_=s==null?void 0:s.user)==null?void 0:_.entity_name}`);if(!P.ok)throw new Error(`Failed to fetch count: ${P.status}`);const U=await P.json();v(U)}catch(P){Y(P.message||"An error occurred while fetching data.")}finally{c(!1)}})()},[]);const L=J=>(_,P)=>{l(P?J:!1)};return e.jsxs("div",{children:[e.jsxs(bt,{expanded:a==="panel1",onChange:L("panel1"),children:[e.jsxs(wt,{expandIcon:e.jsx(Lt,{}),"aria-controls":"panel1bh-content",id:"panel1bh-header",children:[e.jsx(W,{component:"span",sx:{width:"33%",flexShrink:0},children:"Pending For Registration Fees"}),D?e.jsx(W,{component:"span",sx:{color:"text.secondary"},children:"Loading..."}):Q?e.jsx(W,{component:"span",sx:{color:"red"}}):e.jsx(rs,{badgeContent:o,color:"error",children:e.jsx(os,{sx:{width:40,height:40},color:"action"})})]}),e.jsx(Ct,{children:e.jsx(ni,{})})]}),e.jsxs(bt,{expanded:a==="panel2",onChange:L("panel2"),children:[e.jsxs(wt,{expandIcon:e.jsx(Lt,{}),"aria-controls":"panel2bh-content",id:"panel2bh-header",children:[e.jsx(W,{component:"span",sx:{width:"33%",flexShrink:0},children:"Revisiting Patient"}),e.jsx(W,{component:"span",sx:{color:"text.secondary"},children:D?e.jsx(W,{component:"span",sx:{color:"text.secondary"},children:"Loading..."}):Q?e.jsx(W,{component:"span",sx:{color:"red"}}):e.jsx(rs,{badgeContent:S,color:"error",children:e.jsx(os,{sx:{float:"right",width:40,height:40},color:"action"})})})]}),e.jsx(Ct,{children:e.jsx(si,{})})]}),e.jsxs(bt,{expanded:a==="panel3",onChange:L("panel3"),children:[e.jsxs(wt,{expandIcon:e.jsx(Lt,{}),"aria-controls":"panel3bh-content",id:"panel3bh-header",children:[e.jsx(W,{component:"span",sx:{width:"33%",flexShrink:0},children:"Pending Treatment Bills"}),e.jsx(W,{component:"span",sx:{color:"text.secondary"},children:D?e.jsx(W,{component:"span",sx:{color:"text.secondary"},children:"Loading..."}):Q?e.jsx(W,{component:"span",sx:{color:"red"}}):e.jsx(rs,{badgeContent:x,color:"error",children:e.jsx(os,{sx:{float:"right",width:40,height:40},color:"action"})})})]}),e.jsx(Ct,{children:e.jsx(ai,{})})]}),e.jsxs(bt,{expanded:a==="panel4",onChange:L("panel4"),children:[e.jsxs(wt,{expandIcon:e.jsx(Lt,{}),"aria-controls":"panel4bh-content",id:"panel4bh-header",children:[e.jsx(W,{component:"span",sx:{width:"33%",flexShrink:0},children:"Medication Bills"})," ",e.jsx(W,{component:"span",sx:{color:"text.secondary"},children:D?e.jsx(W,{component:"span",sx:{color:"text.secondary"},children:"Loading..."}):Q?e.jsx(W,{component:"span",sx:{color:"red"}}):e.jsx(rs,{badgeContent:h,color:"error",children:e.jsx(os,{sx:{float:"right",width:40,height:40},color:"action"})})})]}),e.jsx(Ct,{children:e.jsx(ri,{})})]})]})}const ii=Ts({palette:{mode:"light",primary:{main:fn[500]},secondary:{main:fn[500]},success:{main:Lr[500]},error:{main:Rr[500]}}});function li(){var O,te,pe;const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState(!1),[o,r]=t.useState([]),[S,i]=t.useState(null),[x,u]=t.useState(Te.tz(Te(),"Africa/Nairobi")),[h,v]=t.useState(Te.tz(Te(),"Africa/Nairobi")),[D,c]=t.useState(""),[Q,Y]=t.useState(""),[L,J]=t.useState("appointment"),[_,P]=t.useState("0001"),[U,Z]=t.useState(Te().format("YYYY-MM-DD HH:mm:ss")),[B,K]=t.useState(""),[M,w]=t.useState(!1),[j,m]=t.useState(""),[C,f]=t.useState("success"),T=h?h.month()+1:Te.tz(Te(),"Africa/Nairobi").month()+1,N=h?h.year():Te.tz(Te(),"Africa/Nairobi").year(),z=E(N),ee=T.toString().padStart(2,"0"),H=`${Q?I(Q):""}/SERV/${z}${ee}-${_}`;function E(re){return re.toString().slice(-2)}function I(re){return re?re.split(" ").map(Me=>Me.charAt(0).toUpperCase()).join(""):""}const F=t.useCallback(async(re,de,je)=>{try{const Me=await fetch(`${n}/appointments/monthly/${re}/${de}/${je}`);if(!Me.ok)throw new Error(`HTTP error! status: ${Me.status}`);const Se=await Me.text();try{const be=JSON.parse(Se);P((be+1).toString().padStart(4,"0"))}catch(be){console.error("Error parsing JSON:",be,"Response text:",Se),m("Error fetching monthly count: Invalid server response."),f("error"),w(!0),P("0001")}}catch(Me){console.error("Error fetching monthly appointment count:",Me),m("Failed to fetch monthly count. Defaulting to 0001."),f("error"),w(!0),P("0001")}},[n]);t.useEffect(()=>{var re;fetch(`${n}/patients/recent-revisited/${(re=s==null?void 0:s.user)==null?void 0:re.entity_name}`,{method:"GET"}).then(de=>de.status===200?de.json():null).then(de=>{de!==null&&r(de)}).catch(de=>{console.error("Error fetching patients:",de),m("Failed to fetch patients."),f("error"),w(!0)})},[(O=s==null?void 0:s.user)==null?void 0:O.entity_name,n]),t.useEffect(()=>{var re;(re=s==null?void 0:s.user)!=null&&re.entity_name&&Y(s.user.entity_name)},[(te=s==null?void 0:s.user)==null?void 0:te.entity_name]),t.useEffect(()=>{var re;Q&&h&&F(N,T,(re=s==null?void 0:s.user)==null?void 0:re.entity_name)},[Q,N,T,(pe=s==null?void 0:s.user)==null?void 0:pe.entity_name,F]),t.useEffect(()=>{const re=setInterval(()=>{const de=Te.tz(Te(),"Africa/Nairobi");Z(de.format("YYYY-MM-DD HH:mm:ss")),u(de),v(de)},1e3);return()=>clearInterval(re)},[]);const k=async()=>{if(!S||!h){m("Tafadhali chagua mgonjwa na tarehe ya miadi."),f("error"),w(!0);return}if(!o.find(de=>de.fullName===S)){m("Mgonjwa aliyechaguliwa hapatikani. Tafadhali chagua mgonjwa sahihi."),f("error"),w(!0);return}try{const de={patientName:S,appointmentDate:x==null?"null":x.tz("Africa/Nairobi").format(),serviceNumber:H,clinicName:Q,status:L},je=await fetch(`${n}/appointments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(de)});if(!je.ok){let Se="Uwasilishaji umeshindwa: ";try{const be=await je.json();Se+=be.message||"Something went Wrong"}catch{const Le=await je.text();Se+=Le||"Something went Wrong",console.error("Response was not JSON:",Le)}m(Se),f("error"),w(!0);return}const Me=await je.text();try{const Se=JSON.parse(Me);console.log("Appointment created:",Se),m("Successfully"),f("success"),w(!0),l(!0),c(H)}catch(Se){console.error("Error parsing response JSON",Se,"Response Text:",Me),m("Error: Invalid response from server"),f("error"),w(!0)}}catch(de){console.error("Fetch Error:",de),m("Please Try Again after 5 Minutes "),f("error"),w(!0)}},g=(re,de)=>{i(de)},$=re=>{u(re),v(re)},A=(re,de)=>{de!=="clickaway"&&w(!1)};return e.jsxs(Ns,{theme:ii,children:[e.jsx(at,{}),e.jsx(is,{sx:{display:"flex",flexWrap:"wrap","& > :not(style)":{m:1,width:"100%",padding:3,border:"none"}},children:e.jsxs(V,{sx:{border:"none"},children:[e.jsxs(V,{spacing:4,direction:{xs:"column",md:"row"},sx:{border:"none",p:2},children:[e.jsxs(is,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:"400",marginTop:0}},noValidate:!0,autoComplete:"off",children:[e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:24,color:"seagreen",mb:2},children:"SELECT PATIENT"}),e.jsx(Re,{options:o.map(re=>re.fullName),onChange:g,renderInput:re=>e.jsx(e.Fragment,{children:e.jsx(R,{...re,label:"Select Patient"})}),sx:{width:400}})]}),e.jsxs(is,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:400,marginTop:0}},noValidate:!0,autoComplete:"off",children:[e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:24,color:"seagreen",mb:2},children:"APPOINTMENT DATE"}),e.jsx(ba,{dateAdapter:wa,children:e.jsx(V,{spacing:2,sx:{minWidth:305},children:e.jsx(Ca,{label:U,value:x,onChange:$})})})]})]}),e.jsxs(is,{sx:{display:"flex",flexDirection:"row",flexWrap:"wrap",paddingLeft:3},children:[e.jsx(G,{variant:"contained",onClick:k,color:"success",disabled:a,children:a?"Submitted":"Submit Appointment"}),a&&e.jsxs(W,{sx:{ml:2,color:"green"},children:["Service Number: ",H]})]})]})}),e.jsx($e,{open:M,autoHideDuration:6e3,onClose:A,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(ye,{onClose:A,severity:C,sx:{width:"100%"},children:j})})]})}const ci=(n,s)=>(console.log(JSON.stringify({medication:JSON.stringify(n)})),new Promise((a,l)=>{fetch(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({medication:JSON.stringify(n)})}).then(o=>o.ok?o.json():o.json().then(r=>{throw new Error(r.message||`HTTP error! status: ${o.status}`)})).then(o=>{console.log("API Response:",o),a({success:!0,message:"Medications saved successfully!"})}).catch(o=>{console.error("API Error:",o),l({success:!1,message:o.message||"Failed to save medications."})})})),di={hidden:{opacity:0,scale:.95},visible:{opacity:1,scale:1,transition:{duration:.2}},exit:{opacity:0,scale:.95,transition:{duration:.1}}},ui=n=>{const{session:s}=he(),a="https://dental-clinic-latest.onrender.com",[l,o]=t.useState(n.open),[r,S]=t.useState([]),[i,x]=t.useState(!0),[u,h]=t.useState(null),v=$t(),[D,c]=t.useState([]),[Q,Y]=t.useState(!1);t.useEffect(()=>{(async()=>{try{const K=`${a}/medications`,M=await fetch(K);if(!M.ok)throw new Error(`HTTP error! Status: ${M.status}`);const w=await M.json();S(w)}catch(K){h(K.message)}finally{x(!1)}})()},[a]);const L=t.useCallback(B=>{c(B)},[]),J=[{field:"id",headerName:"ID",width:50,hideable:!1,renderHeader:()=>e.jsx("span",{style:{fontWeight:"bold"},children:"ID"})},{field:"name",headerName:"Name",width:150,renderHeader:()=>e.jsx("span",{style:{fontWeight:"bold"},children:"Name"})},{field:"dosage",headerName:"Dosage",width:100,renderHeader:()=>e.jsx("span",{style:{fontWeight:"bold"},children:"Dosage"})},{field:"frequency",headerName:"Frequency",width:120,renderHeader:()=>e.jsx("span",{style:{fontWeight:"bold"},children:"Frequency"})},{field:"duration",headerName:"Duration",width:100,renderHeader:()=>e.jsx("span",{style:{fontWeight:"bold"},children:"Duration"})},{field:"remarks",headerName:"Remarks",width:200,flex:1,renderHeader:()=>e.jsx("span",{style:{fontWeight:"bold"},children:"Remarks"})},{field:"price",headerName:"Price",width:100,renderHeader:()=>e.jsx("span",{style:{fontWeight:"bold"},children:"Price"})}],_=async()=>{Y(!0),h(null);try{const B=r.filter(M=>D.includes(M.id));if(B.length===0){h("Please select at least one medication."),Y(!1);return}const K=await ci(B,`${a}/appointments/${n.appointmentId}`);K.success?(o(!1),n.onClose()):h(K.message||"Failed to save medications.")}catch(B){const K=B.message||"An unexpected error occurred. Please try again.";h(K),console.error("Error sending data:",B)}finally{Y(!1),x(!1)}},P=(B,K)=>{K==="backdropClick"||K==="escapeKeyDown"||(o(!1),n.onClose(),h(null),c([]))},U=B=>{o(!1),n.onClose(),h(null),c([])};t.useEffect(()=>{o(n.open)},[n.open]);const Z={rows:r,columns:J,pageSizeOptions:[5,10,20],checkboxSelection:!0,rowSelectionModel:D,onRowSelectionModelChange:L,disableRowSelectionOnClick:!0,isRowSelectable:B=>!0};return e.jsxs(Ce,{open:l,onClose:P,fullWidth:!0,maxWidth:"md",disableEscapeKeyDown:!0,sx:{"& .MuiDialog-paper":{backgroundColor:v.palette.background.paper,borderRadius:v.shape.borderRadius,boxShadow:v.shadows[24],overflow:"hidden"}},children:[e.jsx(Ne,{sx:{padding:v.spacing(3),backgroundColor:v.palette.primary.main,color:v.palette.primary.contrastText,fontWeight:v.typography.fontWeightBold,fontSize:v.typography.h6.fontSize,borderBottom:`1px solid ${v.palette.divider}`},children:"Select Medications"}),e.jsx(Bt,{children:e.jsx(Ut.div,{variants:di,initial:"hidden",animate:"visible",exit:"exit",style:{flex:"1 1 auto",display:"flex",flexDirection:"column"},children:e.jsx(ve,{sx:{padding:v.spacing(3),overflowY:"auto",flexGrow:1,maxHeight:"400px"},children:i?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:e.jsx(ze,{})}):e.jsxs("div",{style:{height:"100%",width:"100%"},children:[e.jsx(we,{...Z,sx:{"& .MuiDataGrid-columnHeaderTitle":{fontWeight:"bold"},"& .MuiDataGrid-row:hover":{backgroundColor:v.palette.action.hover},"& .MuiDataGrid-cell":{borderBottom:`1px solid ${v.palette.divider}`},"& .MuiCheckbox-root":{padding:0},"& .MuiDataGrid-checkboxInput":{borderRadius:0},"& .MuiDataGrid-selectedRow":{backgroundColor:`${v.palette.action.selected} !important`}}}),u&&e.jsx(ye,{severity:"error",sx:{marginTop:v.spacing(2)},children:u})]})})})}),e.jsxs(Ie,{sx:{padding:v.spacing(2),marginTop:v.spacing(2),display:"flex",justifyContent:"flex-end",borderTop:`1px solid ${v.palette.divider}`},children:[e.jsx(G,{onClick:U,color:"inherit",disabled:Q||i,sx:{marginRight:v.spacing(1),"&:hover":{backgroundColor:v.palette.action.hover}},children:"Cancel"}),e.jsx(G,{onClick:_,variant:"contained",color:"primary",disabled:Q||i,sx:{"&:hover":{backgroundColor:v.palette.primary.dark}},children:Q||i?e.jsxs(e.Fragment,{children:[e.jsx(ze,{size:20,style:{marginRight:8,color:"white"}}),"Saving..."]}):"Save"})]})]})},hi=(n,s)=>{const a=s,l=JSON.stringify(n);return new Promise((o,r)=>{fetch(a,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({medication:l})}).then(S=>S.ok?S.json():S.json().then(i=>{throw new Error(i.message||`HTTP error! status: ${S.status}`)})).then(S=>{console.log("API Response:",S),o({success:!0,message:"Medications saved successfully!"})}).catch(S=>{console.error("API Error:",S),r({success:!1,message:S.message||"Failed to save medications."})})})};function fi(n){var H,E;const s="https://dental-clinic-latest.onrender.com",{session:a}=he(),[l,o]=t.useState(!0),[r,S]=t.useState(!0),[i,x]=t.useState([]),[u,h]=t.useState(null),[v,D]=t.useState(null),[c,Q]=t.useState(!1),[Y,L]=t.useState(null),[J,_]=t.useState(!1),[P,U]=t.useState(""),[Z,B]=t.useState(""),[K,M]=t.useState(""),[w,j]=t.useState(""),[m,C]=t.useState(""),[f,T]=t.useState(""),N=t.useCallback(async()=>{var I;if((I=a==null?void 0:a.user)!=null&&I.entity_name){S(!0);try{const F=await fetch(`${s}/appointments/${n.appointmentId}`,{method:"GET"});if(!F.ok)throw new Error(`HTTP error! Status: ${F.status}`);const k=[await F.json()];x(k),Array.isArray(k)?x(k):D("Unexpected API response: Expected an array of clinic data."),D(null)}catch(F){D(F.message),x([])}finally{S(!1)}}},[(H=a==null?void 0:a.user)==null?void 0:H.entity_name,s,a]);t.useEffect(()=>{N()},[N]);const z=t.useCallback(async I=>{var $;const F=($=i[0])==null?void 0:$.medication;if(!F){D("No medication data found.");return}let k;try{k=JSON.parse(F)}catch(A){console.error("Error parsing medication string:",A),D("Invalid medication data format.");return}const g=k.filter(A=>A.id!==I);x(A=>A.map(O=>({...O,medication:JSON.stringify(g)}))),h(g);try{const A=await hi(g,`${s}/appointments/${n.appointmentId}`);A.success?console.log(A.message):D(A.message||"Failed to save medications.")}catch(A){const O=A.message||"An unexpected error occurred. Please try again.";D(O),console.error("Error sending data:",A)}finally{S(!1)}console.log(g)},[i]),ee=[{field:"id",headerName:"ID",width:70},{field:"name",headerName:"Name",width:150},{field:"dosage",headerName:"Dosage",width:100},{field:"frequency",headerName:"Frequency",width:100},{field:"duration",headerName:"Duration",width:100},{field:"remarks",headerName:"Remarks",width:150},{field:"price",headerName:"Price",width:100},{field:"actions",type:"actions",headerName:"Actions",width:150,getActions:I=>[e.jsx(ge,{icon:e.jsx(ot,{}),label:"Delete",onClick:()=>z(I.row.id),showInMenu:!0})]}];let se=[];if(i&&i.length>0&&((E=i[0])!=null&&E.medication))try{se=JSON.parse(i[0].medication)}catch(I){console.error("Error parsing medication data",I),se=[],D("Error parsing medication data. Please check the data source.")}else se=[];return r?e.jsx(W,{children:"Loading..."}):e.jsxs(ne,{sx:{p:4},children:[v&&e.jsxs(ye,{severity:"error",sx:{mb:2},children:[e.jsx(zt,{children:"Error"}),v]}),e.jsx(ne,{sx:{height:"auto",width:"100%"},children:e.jsx(we,{rows:se,columns:ee,initialState:{pagination:{paginationModel:{pageSize:5}}},pageSizeOptions:[5,10,20]})}),e.jsx($e,{open:J,autoHideDuration:6e3,onClose:()=>_(!1),message:"Medication updated successfully!"})]})}const cs=["Patient Information","Patient Treatment History","Files","Diagnosis","Treatment Plan","Medication","Bill"],mi=e.jsx(ct,{fontSize:"small"}),pi=e.jsx(lt,{fontSize:"small"}),gi=yt("div")`
  display: flex; // Use flexbox for layout
  justify-content: right; // Center the content horizontally
  align-items: right; // Center the content vertically
  padding: 20px; // Add some padding around the container
  background-color: #f0f0f0; // Light background color for the container
  border-radius: 8px; // Rounded corners for the container
  margin-top: 10px; // Add space above the container
`,xi=yt(G)`
  /* Remove top margin, already handled by container */
  /* margin-top: 10px; */
  background-color: #4caf50; // Green background color
  color: white; // White text color
  padding: 10px 20px; // Padding inside the button
  border-radius: 5px; // Rounded corners for the button
  border: none; // Remove the default button border
  cursor: pointer; // Show a pointer cursor on hover
  font-size: 16px; // Increase font size
  display: flex; /* Use flexbox for icon alignment */
  align-items: center;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Add shadow */
  transition:
    background-color 0.3s ease,
    transform 0.2s ease; /* Smooth transition */

  &:hover {
    background-color: #45a049; // Darker green on hover
    transform: translateY(-2px); /* Move the button up slightly on hover */
  }

  .MuiSvgIcon-root {
    margin-right: 8px; /* Add space between icon and text */
  }
`,ji=yt("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1});function sn(n,s="TZS",a="en-US"){const l=typeof n=="string"?parseFloat(n):n;return isNaN(l)?"Invalid Amount":l.toLocaleString(a,{style:"currency",currency:s})}const yi=it({complaintsName:dt().required("Complaint name is required")}),Si=({appointmentId:n,initialCaseData:s,onCaseUpdate:a,patientNa:l})=>{var Zs,Xs,ea,ta;const[o,r]=t.useState(0),[S,i]=t.useState({patientName:""}),x="https://dental-clinic-latest.onrender.com",u="Adult Tooth Chart",{session:h}=he(),[v,D]=t.useState({}),[c,Q]=t.useState(""),[Y,L]=t.useState(""),[J,_]=t.useState(""),[P,U]=t.useState(""),[Z,B]=t.useState(""),[K,M]=t.useState(""),[w,j]=t.useState(!1),[m,C]=t.useState([]),[f,T]=t.useState(""),[N,z]=t.useState(""),[ee,se]=t.useState(""),[H,E]=t.useState(""),[I,F]=t.useState(),[k,g]=t.useState(0),[$,A]=t.useState(""),[O,te]=t.useState(""),[pe,re]=t.useState(null),[de,je]=t.useState([]),[Me,Se]=t.useState(),[be,Le]=t.useState("1"),[fe,Ee]=t.useState("1"),[Fe,oe]=t.useState(""),[ce,me]=ae.useState([]),[De,Pe]=t.useState([]),[Be,et]=t.useState(!1),[Je,mt]=t.useState([]),[Ke,ut]=t.useState(),[ht,Oe]=t.useState(!0),[vt,pt]=t.useState(null),[Rn,tt]=t.useState(new Map),[gt,ue]=ae.useState([]),[Jt,Et]=ae.useState([]),[Dt,He]=ae.useState([]),[Sn,xt]=ae.useState([]),[Ms,Fs]=t.useState([]),[Ht,bn]=t.useState(""),[hs,wn]=t.useState(""),[Cn,Wt]=t.useState(""),[Ln,zn]=t.useState(""),[Bn,Un]=t.useState(""),[Jn,Hn]=t.useState(""),[Wn,Yt]=t.useState(""),[X,ie]=t.useState(""),[Qe,vn]=t.useState([]),[Os,Yn]=ae.useState([]),[Gn,qn]=ae.useState([]),[fs,ms]=t.useState([]),[ke,En]=t.useState({complaints:"",hpillness:"",pastdmh:"",dentalexamination:"",investigation:"",diagnoss:"",tplan:"",medication:"",comments:""}),[Pt,Gt]=t.useState({}),[qt,Vt]=t.useState(!1),[_s,Rs]=t.useState(!1),[St,Vn]=t.useState(null),[Kn,kt]=t.useState(null),[y,b]=t.useState(null),[xe,We]=t.useState(0),[Ge,kn]=t.useState(""),[Qn,Ba]=t.useState(""),[Tn,ps]=t.useState([]),[Zn,Ua]=t.useState([]),[Tt,Kt]=t.useState("0001"),[hl,fl]=t.useState(""),[ml,pl]=t.useState(""),[gl,xl]=t.useState(""),[jl,yl]=t.useState(""),[Sl,bl]=t.useState(""),[wl,Cl]=t.useState(""),[Ls,Ja]=t.useState(!0),[Ha,Wa]=ae.useState([]),[vl,Qt]=t.useState(""),[El,Zt]=t.useState("success"),[Ya,Xn]=t.useState(!1),[gs,zs]=t.useState(""),[Bs,xs]=t.useState(""),[Ga,Us]=t.useState(""),[kl,Tl]=ae.useState("Dione"),[Js,qa]=t.useState(""),Va=p=>{qa(p.target.value)};t.useEffect(()=>{(async()=>{if(n)try{const d=await fetch(`${x}/task-info/appointment/${n}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(d.ok){const q=await d.json();ps(q),Nn(Tn)}else console.error("Failed to fetch patients:",d.status)}catch(d){console.error("Error fetching patients:",d)}})(),console.log("on manage",Nn(Tn)),ps([])},[n,x]),t.useEffect(()=>{(async()=>{if(n)try{const d=await fetch(`${x}/medicationdata/appointment/${n}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(d.ok){const q=await d.json();Ua(q),es(Zn),console.log("medication price",es(Zn))}else console.error("Failed to fetch patients:",d.status)}catch(d){console.error("Error fetching patients:",d)}})(),console.log("on manage",Nn(Tn)),ps([])},[n,x]);function Nn(p){return!p||p.length===0?0:p.reduce((d,q)=>{const le=parseFloat(q.totalPrice);return isNaN(le)?d:d+le},0)}function es(p){return!p||p.length===0?0:p.reduce((d,q)=>{const le=parseFloat(q.price);return isNaN(le)?d:d+le},0)}const js=Nt().tz("Africa/Nairobi").format("YYYY-MM-DDThh:mm:ss"),At=new Date().getFullYear(),It=new Date().getMonth()+1,$n=Ka(At),Dn=It.toString().padStart(2,"0"),Pn=(Zs=h==null?void 0:h.user)!=null&&Zs.entity_name?Qa((Xs=h==null?void 0:h.user)==null?void 0:Xs.entity_name):"";function Ka(p){return p.toString().slice(-2)}function Qa(p){return p?p.split(" ").map(le=>le.charAt(0).toUpperCase()).join(""):""}const Xt=async(p,d,q)=>{try{const le=await fetch(`${x}/bills/monthly/${p}/${d}/${q}`);if(!le.ok)throw new Error(`HTTP error! status: ${le.status}`);const Ae=await le.json();Kt((Ae+1).toString().padStart(4,"0")),console.log("Bills Monthly count:",Ae,Tt),Ee("1")}catch(le){console.error("Error fetching monthly appointment count:",le),Kt("0001")}};t.useEffect(()=>{var p;fe&&Xt(At,It,(p=h==null?void 0:h.user)==null?void 0:p.entity_name)},[fe]);async function Za(p){try{const d=await fetch(`${x}/api/files/files-byname/${p}`);if(!d.ok){if(d.status===404)return null;throw new Error(`HTTP error! status: ${d.status}`)}return await d.json()}catch(d){return console.error("Error fetching file info:",d),null}}const Xa=p=>{var q;b(null);const d=(q=p.target.files)==null?void 0:q[0];Vn(d)},er=async()=>{if(!St){b("Please select a file first.");return}kt("Uploading..."),b(null);try{const p=new FormData;p.append("file",St);const d=await fetch(`${x}/api/files/upload/${n}`,{method:"POST",body:p});if(d.ok){kt(""),St.name;const q=await Za(St.name);try{const le=await fetch(`${x}/cases/appointment/${n}?fileId=${q==null?void 0:q.id}&filename=${q==null?void 0:q.fileName}`,{method:"PUT"});if(!le.ok){const Ae=await le.json();console.error("API Error:",Ae),alert(`Submission failed: ${Ae.message||"An error occurred"}`);return}j(!0)}catch(le){console.error("Fetch Error:",le),alert("Submission failed. Please try again.")}j(!0),Vn(null)}else try{const q=await d.json();kt(`${(q==null?void 0:q.message)||d.statusText}`)}catch{kt(`Upload failed: ${d.statusText}`)}}catch(p){kt(`Upload failed: ${p}`)}},Mt=p=>{const{name:d,value:q}=p.target;En(le=>({...le,[d]:q}))};ae.useEffect(()=>{var p;be&&fetch(`${x}/clinics/cbyname/${(p=h==null?void 0:h.user)==null?void 0:p.entity_name}`,{method:"GET"}).then(d=>d.status===200?d.json():null).then(d=>{d!==null&&(He(JSON.parse(d.diagnosis)),console.log("examination diagnosis",JSON.parse(d.diagnosis)))})},[be]),ae.useEffect(()=>{var p;fetch(`${x}/clinics/cbyname/${(p=h==null?void 0:h.user)==null?void 0:p.entity_name}`,{method:"GET"}).then(d=>d.status===200?d.json():null).then(d=>{d!==null&&(xt(JSON.parse(d.examination)),console.log("examination examination",JSON.parse(d.diagnosis)))})},[]),ae.useEffect(()=>{var p;fetch(`${x}/clinics/cbyname/${(p=h==null?void 0:h.user)==null?void 0:p.entity_name}`,{method:"GET"}).then(d=>d.status===200?d.json():null).then(d=>{d!==null&&Et(JSON.parse(d.surface))})},[]),ae.useEffect(()=>{var p;fetch(`$${x}/clinics/cbyname/${(p=h==null?void 0:h.user)==null?void 0:p.entity_name}`,{method:"GET"}).then(d=>d.status===200?d.json():null).then(d=>{d!==null&&mt(d)})},[]),t.useEffect(()=>{var p;fetch(`${x}/clinics/cbyname/${(p=h==null?void 0:h.user)==null?void 0:p.entity_name}`,{method:"GET"}).then(d=>d.status===200?d.json():null).then(d=>{if(d!==null){ue(JSON.parse(d.treatments)),Yn(JSON.parse(d.medication));const q=JSON.parse(d.treatments),le=new Map;q.forEach(Ae=>le.set(Ae.name,Ae.price)),tt(le)}})},[(ea=h==null?void 0:h.user)==null?void 0:ea.entity_name]);const ys=p=>{et(p)},ts=p=>{const d=p.currentTarget.textContent;if(d){const q=m.includes(d),le=q?"outlined":"contained";q?C(m.filter(Ae=>Ae!==d)):(fr(),Pe([]),C([...m,d])),Gt(Ae=>({...Ae,[d]:le}))}},tr=async()=>{try{const p={selectedItems:m,buttonColors:Pt};console.log(JSON.stringify(p));const d=await fetch(`${x}/1/api/button-data/${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);console.log(m.length),j(!0)}catch(p){console.error("Error saving button data:",p)}},nr=()=>{Le("2"),Vt(!0)},sr=p=>{if(E(p),Rn.has(p)){const d=Rn.get(p);g(d),console.log(`The price of ${p} is ${d}`)}else console.log(`Price not found for ${p}`),g(0)},Ss=ae.useCallback(p=>()=>{fetch(`${x}/task-info/${p}`,{method:"DELETE"}).then(d=>{if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);me(q=>q.filter(le=>le.id!==p)),j(!0)}).catch(d=>{console.error("Error deleting user:",d),j(!0)}),console.log(p)},[me,j]),ar=ae.useCallback(p=>()=>{fetch(`${x}/medicationdata/${p}`,{method:"DELETE"}).then(d=>{if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);vn(q=>q.filter(le=>le.id!==p)),j(!0)}).catch(d=>{console.error("Error deleting user:",d),j(!0)}),console.log(p)},[vn,j]),rr=()=>{var p;fetch(`${x}/task-info`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({patientId:n,teeth:m.join(","),regDate:js,clinicName:(p=h==null?void 0:h.user)==null?void 0:p.entity_name,diagnosis:N,examination:f,surface:ee,price:"0",totalPrice:"0",quantity:m.length,patientName:Qn})}).then(d=>d.status==201?d.json():null).then(d=>{E(""),g(0),C([]),C([]),Le("2"),j(!0)})},or=async()=>{try{const p=k*xe,d=await fetch(`${x}/task-info/appointment/${Ge}?price=${k}&totalPrice=${p}&treatment=${H}&patientName=${Qn}`,{method:"PUT"});if(!d.ok){const q=await d.json();console.error("API Error:",q),console.log(`Submission failed: ${q.message||"An error occurred"}`),alert(`Submission failed: ${q.message||"An error occurred"}`);return}Le("2"),j(!0)}catch(p){console.error("Fetch Error:",p),alert("Submission failed. Please try again.")}},ir=()=>{Vt(!0)},lr=async()=>{try{const p=k*xe,d=await fetch(`${x}/task-info/appointment/${Ge}?preDiagnosis=${$}&finalDiagnosis=${O}&patientName=${Qn}`,{method:"PUT"});if(!d.ok){const q=await d.json();console.error("API Error:",q),console.log(`Submission failed: ${q.message||"An error occurred"}`),alert(`Submission failed: ${q.message||"An error occurred"}`);return}Le("2"),j(!0)}catch(p){console.error("Fetch Error:",p),alert("Submission failed. Please try again.")}};ae.useEffect(()=>{var p;be&&(Oe(!0),fetch(`$${x}/clinics/cbyname/${(p=h==null?void 0:h.user)==null?void 0:p.entity_name}`,{method:"GET"}).then(d=>d.status===200?d.json():null).then(d=>{d!==null&&Yn(JSON.parse(d.medication)),console.log("step med",d),Oe(!1)}))},[be,(ta=h==null?void 0:h.user)==null?void 0:ta.entity_name]),ae.useEffect(()=>{be&&(Oe(!0),fetch(`${x}/complaints`,{method:"GET"}).then(p=>p.status===200?p.json():null).then(p=>{p!==null&&qn(p),Oe(!1)}))},[be]),ae.useEffect(()=>{be&&(Oe(!0),fetch(`${x}/medicationdata/appointment/${n}`,{method:"GET"}).then(p=>p.status===200?p.json():null).then(p=>{p!==null&&vn(p),Oe(!1)}))},[be]);const cr=async()=>{if(be=="1")if(n)try{const p=await fetch(`${x}/task-info/appointment/${n}`);if(p.ok){const d=await p.json();ys(!0),me(d),Le("")}else console.error("Failed to fetch patients:",p.status),me([])}catch(p){console.error("Error fetching patients:",p),me([])}else me([]);if(n)try{const p=await fetch(`${x}/task-info/appointment/${n}`);if(p.ok){const d=await p.json();ys(!0),me(d),Le("")}else console.error("Failed to fetch patients:",p.status),me([])}catch(p){console.error("Error fetching patients:",p),me([])}else me([])};t.useEffect(()=>{cr()},[n,be]);const Hs=ae.useCallback((p,d,q)=>()=>{Vt(!0),Pe(d),We(q),kn(p)},[]),dr=ae.useMemo(()=>[{field:"teeth",width:100,headerName:"Teeth",type:"string"},{field:"examination",headerName:"Examination",type:"string",width:100},{field:"diagnosis",headerName:"Diagnosis",type:"string",width:100},{field:"surface",headerName:"Surface",type:"string",width:100},{field:"actions",headerName:"Actions",type:"actions",width:120,getActions:p=>[e.jsx(ge,{label:"Delete",onClick:Ss(p.id),showInMenu:!0})]}],[Ss]),ur=ae.useMemo(()=>[{field:"teeth",width:100,headerName:"Teeth",type:"string"},{field:"examination",headerName:"Examination",type:"string",width:100},{field:"diagnosis",headerName:"Diagnosis",type:"string",width:100},{field:"surface",headerName:"Surface",type:"string",width:100},{field:"treatment",headerName:"Treatment",type:"string"},{field:"quantity",headerName:"Qty",type:"string",width:70},{field:"price",headerName:"Price",type:"number",valueFormatter:p=>typeof p=="string"||typeof p=="number"?sn(p):typeof p,width:140},{field:"totalPrice",headerName:"Total Price",type:"number",valueFormatter:p=>typeof p=="string"||typeof p=="number"?sn(p):typeof p,width:140},{field:"actions",headerName:"Actions",type:"actions",width:120,getActions:p=>[e.jsx(ge,{icon:e.jsx(Mn,{}),label:"Treatment",onClick:Hs(p.row.id,p.row.teeth,p.row.quantity),showInMenu:!0})]}],[]);ae.useMemo(()=>[{field:"medicationName",width:160,headerName:"Medication Name",type:"string"},{field:"dosage",headerName:"Dosage",type:"string",width:100},{field:"frequency",headerName:"Frequency",type:"string",width:100},{field:"duration",headerName:"Duration",type:"string",width:100},{field:"remarks",headerName:"Remarks",type:"string"},{field:"price",headerName:"Price",type:"string",width:70},{field:"actions",headerName:"Actions",type:"actions",width:120,getActions:p=>[e.jsx(ge,{icon:e.jsx(zr,{}),label:"Delete",onClick:ar(p.row.id),showInMenu:!0})]}],[]);const hr=ae.useMemo(()=>[{field:"teeth",width:100,headerName:"Teeth",type:"string"},{field:"preDiagnosis",headerName:"Preliminary Diagnosis",type:"string",width:100},{field:"finalDiagnosis",headerName:"Final Diagnosis",type:"string",width:100},{field:"actions",headerName:"Actions",type:"actions",width:120,getActions:p=>[e.jsx(ge,{icon:e.jsx(Mn,{}),label:"Select Diagnosis",onClick:Hs(p.row.id,p.row.teeth,p.row.quantity),showInMenu:!0})]}],[Ss]);t.useEffect(()=>{(async()=>{if(Oe(!0),pt(null),n)try{const d=await fetch(`${x}/1/api/button-data/${n}`);if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);const q=await d.json();Gt(q.buttonColors),Q(n.toString()),ys(!0)}catch(d){console.error("Error fetching data:",d),pt("Error Fetching data")}finally{Oe(!1)}else C([]),Gt({})})()},[n]);const jt=()=>{Le("9"),Vt(!1),Pe([])},fr=()=>{C([])},Ws=Array.from({length:8},(p,d)=>18-d).map(p=>e.jsx(G,{onClick:ts,variant:Pt[p]||"outlined",children:p},p)),Ys=Array.from({length:8},(p,d)=>d+21).map(p=>e.jsx(G,{onClick:ts,variant:Pt[p]||"outlined",children:p},p)),Gs=Array.from({length:8},(p,d)=>48-d).map(p=>e.jsx(G,{onClick:ts,variant:Pt[p]||"outlined",children:p},p)),qs=Array.from({length:8},(p,d)=>d+31).map(p=>e.jsx(G,{onClick:ts,variant:Pt[p]||"outlined",children:p},p));t.useEffect(()=>{(async()=>{if(n){Oe(!0);try{const d=await fetch(`${x}/appointments/${n}`);if(!d.ok){const Ae=await d.json();throw new Error(`Failed to fetch appointment data: ${d.status} - ${Ae.message||"Unknown error"}`)}const q=await d.json();Ba(q.patientName),i(q);let le;if(Array.isArray(s)&&s.length>0?le=s[0]:s&&!Array.isArray(s)&&(le=s),le){const Ae=JSON.parse(le.patientHistory);try{const nt=JSON.parse(le.patientHistory);En({complaints:nt.patientHistory.complaints||"",hpillness:nt.patientHistory.hpillness||"",pastdmh:nt.patientHistory.pastdmh||"",dentalexamination:nt.patientHistory.dentalexamination||"",investigation:nt.patientHistory.investigation||"",diagnoss:nt.patientHistory.diagnoss||"",tplan:nt.patientHistory.tplan||"",medication:nt.patientHistory.medication||"",comments:nt.patientHistory.comments||""})}catch(nt){console.log(fs,le.patientHistory),console.error("Error parsing examination data:",nt)}}}catch(d){console.error("Error fetching data:",d)}finally{Oe(!1)}}})()},[n,x,s,En,L,_,i,Oe]);const mr=[{field:"doctype",headerName:"Bill Name",width:250},{field:"billamount",headerName:"Bill Amount",type:"number",valueFormatter:p=>typeof p=="string"||typeof p=="number"?sn(p):typeof p,width:250}];ae.useEffect(()=>{Ls&&(Oe(!0),fetch(`${x}/bills/by-appointment-id/${n}`,{method:"GET"}).then(p=>p.status===200?p.json():null).then(p=>{p!==null&&Wa(p),Oe(!1),Ja(!1)}))},[Ls]);const Vs=Ha,pr=t.useMemo(()=>{if(!Ht)return Vs;const p=Ht.toLowerCase();return ce.filter(d=>Object.values(d).some(q=>q!=null&&q.toString().toLowerCase().includes(p)))},[Vs,Ht]),Ks=async()=>{var p,d,q,le,Ae,nt,na;if(o<cs.length-1)r(ns=>ns+1);else if(Js==="Its ready and Complete"){Xt(At,It,(p=h==null?void 0:h.user)==null?void 0:p.entity_name);const ns=`${Pn}/RECEIPT/${$n}${Dn}-${Tt}`;console.log("general",ns);try{Xt(At,It,(d=h==null?void 0:h.user)==null?void 0:d.entity_name);const qe=`${Pn}/RECEIPT/${$n}${Dn}-${Tt}`;if(console.log("general","pname",l,qe),Nn(Tn)>0){const Ft=await fetch(`${x}/bills`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({appointmentId:n,docnumber:qe,billamount:Nn(Tn),doctype:"Treatment Bill",bill_date:js,client:l,clinicName:(q=h==null?void 0:h.user)==null?void 0:q.entity_name})});if(!Ft.ok){const vs=await Ft.json();throw new Error(`Failed to create case: ${Ft.status} - ${vs.message||"Unknown error"}`)}}Kt(""),Xt(At,It,(le=h==null?void 0:h.user)==null?void 0:le.entity_name);const Cs=`${Pn}/RECEIPT/${$n}${Dn}-${Tt}`;console.log("general",Tt,Cs),console.log("patientFullName",l),Kt(""),Qt("Case created successfully"),Zt("success"),j(!0)}catch(qe){Qt(`Error creating case: ${qe.message}`),Zt("error"),j(!0),console.error("Error creating case:",qe)}finally{wn(""),Oe(!1)}try{Xt(At,It,(Ae=h==null?void 0:h.user)==null?void 0:Ae.entity_name);const qe=`${Pn}/RECEIPT/${$n}${Dn}-${(parseInt(Tt)+1).toString().padStart(4,"0")}`;if(console.log("general",qe),es(Zn)>0){const Ft=await fetch(`${x}/bills`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({appointmentId:n,docnumber:qe,billamount:es(Zn),doctype:"Medication Bill",client:Qn,bill_date:js,clinicName:(nt=h==null?void 0:h.user)==null?void 0:nt.entity_name})});if(!Ft.ok){const vs=await Ft.json();throw new Error(`Failed to create case: ${Ft.status} - ${vs.message||"Unknown error"}`)}}Kt(""),Xt(At,It,(na=h==null?void 0:h.user)==null?void 0:na.entity_name);const Cs=`${Pn}/RECEIPT/${$n}${Dn}-${Tt}`;console.log("general",Tt,Cs),Kt(""),Qt("Case created successfully"),Zt("success"),j(!0)}catch(qe){Qt(`Error creating case: ${qe.message}`),Zt("error"),j(!0),console.error("Error creating case:",qe)}finally{wn(""),Oe(!1)}const bs=`${x}/appointments/${n}`,ws=await fetch(bs,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({flag:"completed"})});if(ws.ok){const qe=await ws.json();console.log("Appointment updated",qe)}else{const qe=await ws.text();console.error("Failed to update Schedule Date status:",qe),Qt(`Failed to update Schedule Date status: ${qe}`),Zt("error")}const yr={patientHistory:{complaints:ke.complaints,hpillness:ke.hpillness,pastdmh:ke.pastdmh,dentalexamination:ke.dentalexamination,investigation:ke.investigation,diagnoss:ke.diagnoss,tplan:ke.tplan,medication:ke.medication,comments:ke.comments}};a(yr)}else{const bs={patientHistory:{complaints:Ga,hpillness:ke.hpillness,pastdmh:ke.pastdmh,dentalexamination:ke.dentalexamination,investigation:ke.investigation,diagnoss:ke.diagnoss,tplan:ke.tplan,medication:ke.medication,comments:ke.comments}};a(bs)}},gr=()=>r(p=>p-1),Qs=t.useCallback(async p=>{const d={complaintsName:p,id:""};qn(le=>[...le,d]),Xn(!1),Us(p),zs(""),xs(p);const q=await fetch(`${x}/complaints`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({complaintsName:d==null?void 0:d.complaintsName})});if(q.ok){const le=await q.json();console.log("Inserted new Complaint",le),console.log(JSON.stringify({complaintName:d==null?void 0:d.complaintsName}))}else{const le=await q.text();console.error("Failed to Add new Complaint:",le),Qt(`Failed to update Schedule Date status: ${le}`),Zt("error")}},[]),xr=(p,d)=>{const le=d.map(Ae=>Ae.complaintsName).join(", ");Us(le),console.log(le),d&&xs(d.complaintsName)},jr=p=>{switch(p){case 0:return e.jsx(ne,{component:"form",sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gridTemplateRows:"auto auto",gap:2,"& .MuiTextField-root":{marginTop:1}},noValidate:!0,autoComplete:"off",children:Object.entries(S).filter(([d])=>d!=="id").map(([d,q])=>e.jsx(R,{label:d,value:String(q),InputProps:{readOnly:!0},margin:"normal",size:"small"},d))});case 1:return e.jsxs(e.Fragment,{children:[e.jsx(e.Fragment,{children:e.jsx(V,{sx:{border:"none",padding:3},children:e.jsxs(V,{sx:{border:0,paddingLeft:2},children:[" ",e.jsx(ne,{sx:{display:"flex",flexDirection:"column",alignItems:"left","& > *":{m:1}},children:e.jsxs(V,{direction:"column",sx:{paddingLeft:5,border:0},children:[e.jsx(W,{sx:{paddingTop:3,paddingRight:6,border:0,m:0,fontSize:27},children:"Dental Examination"})," ",e.jsxs(V,{direction:"column",spacing:1,children:[e.jsx(V,{children:e.jsxs(ne,{children:[e.jsx(Ve,{size:"small","aria-label":"Small button group",children:Ws}),e.jsx(Ve,{size:"small","aria-label":"Small button group",children:Ys}),e.jsx(us,{orientation:"horizontal",variant:"middle",flexItem:!0,sx:{width:600},children:e.jsx(Ze,{sx:{backgroundColor:"primary"},label:"",size:"small"})}),e.jsx(Ve,{size:"small","aria-label":"Small button group",children:Gs}),e.jsx(Ve,{size:"small","aria-label":"Small button group",children:qs})]})}),e.jsxs("div",{children:[e.jsxs(G,{onClick:tr,size:"small",sx:{textTransform:"none"},variant:"contained",children:[" ","Save Examination"]})," ",e.jsxs(G,{onClick:nr,size:"small",sx:{textTransform:"none"},variant:"contained",children:[" ","Add Examination Data"]}),m.length===0?e.jsx(Ze,{label:"None"}):m.map(d=>e.jsx(e.Fragment,{children:e.jsx(Ze,{label:d,onDelete:()=>{C(m.filter(q=>q!==d)),Gt(q=>({...q,[d]:"outlined"}))}},d)}))]}),e.jsx(V,{sx:{border:0,padding:0},children:Be&&e.jsx("div",{style:{height:"auto",width:700},children:e.jsx(we,{rows:ce,columns:dr,initialState:{pagination:{paginationModel:{pageSize:5}}}})})}),e.jsxs(Ce,{open:qt,onClose:jt,PaperProps:{component:"form",onSubmit:d=>{d.preventDefault();const q=new FormData(d.currentTarget),Ae=Object.fromEntries(q.entries()).email;console.log(Ae),jt()}},children:[e.jsx(Ne,{children:e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:26},children:"Examination Details"})}),e.jsxs(ve,{children:[e.jsx(Ze,{sx:{mb:2,alignItems:"center"},color:"success",label:m.join(",")}),e.jsx("br",{}),e.jsxs(Ue,{children:[e.jsx(Re,{options:Sn.map(d=>d.name),renderInput:d=>e.jsx(R,{...d,label:"Examination"}),onChange:(d,q)=>{T(q)},size:"small",sx:{width:350}})," ",e.jsx("br",{}),e.jsx(Re,{options:Dt.map(d=>d.name),renderInput:d=>e.jsx(R,{...d,label:"Diagnosis"}),onChange:(d,q)=>{z(q)},size:"small",sx:{width:350}})," ",e.jsx("br",{}),e.jsx(Re,{options:Jt.map(d=>d.name),renderInput:d=>e.jsx(R,{...d,label:"Surface"}),onChange:(d,q)=>{se(q)},size:"small",sx:{width:350}})]})]}),e.jsxs(Ie,{children:[e.jsx(G,{onClick:jt,children:"Cancel"}),e.jsx(G,{onClick:rr,type:"submit",children:"Save Detail"})]})]})]})]})})]})})}),e.jsx("br",{}),e.jsxs(ne,{component:"form",sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gridTemplateRows:"auto auto",gap:2,"& .MuiTextField-root":{marginTop:1}},noValidate:!0,autoComplete:"off",children:[e.jsx(Re,{id:"complaints",multiple:!0,disableCloseOnSelect:!0,onInputChange:(d,q)=>{xs(q)},size:"small",onChange:xr,options:Gn,getOptionLabel:d=>d.complaintsName,renderOption:(d,q,{selected:le})=>t.createElement("li",{...d,key:q.id},e.jsx(st,{icon:mi,checkedIcon:pi,style:{marginRight:8},checked:le}),q.complaintsName),renderInput:d=>e.jsx(R,{...d,label:`${ke.complaints.length>0?ke.complaints:"Search or Add "} `,variant:"outlined",InputProps:{...d.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[Bs&&!Gn.find(q=>q.complaintsName===Bs)&&e.jsx(G,{size:"small",onClick:()=>Xn(!0),sx:{mr:1},children:"Add New"}),d.InputProps.endAdornment]})}})}),e.jsxs(Ce,{open:Ya,onClose:()=>Xn(!1),children:[e.jsx(Ne,{children:"Add New Complaint"}),e.jsx(ve,{children:e.jsx(Gr,{initialValues:{complaintsName:gs},validationSchema:yi,onSubmit:d=>{Qs(d.complaintsName)},children:({isSubmitting:d})=>e.jsxs(qr,{children:[e.jsx(Vr,{as:R,name:"complaints",label:"Complaint Name",fullWidth:!0,variant:"outlined",margin:"normal",onChange:q=>zs(q.target.value),value:gs}),e.jsx(Kr,{name:"complaints",component:"div"}),e.jsxs(Ie,{children:[e.jsx(G,{onClick:()=>Xn(!1),children:"Cancel"}),e.jsx(G,{onClick:q=>{Qs(gs)},variant:"contained",children:"Add"})]})]})})})]}),e.jsx(R,{id:"hpillness",name:"hpillness",label:"HP Illness",value:ke.hpillness,type:"text",multiline:!0,onChange:Mt,variant:"outlined",margin:"normal",size:"small"}),e.jsx(R,{id:"pastdmh",name:"pastdmh",label:"Past Dental and medical History",value:ke.pastdmh,type:"text",onChange:Mt,variant:"outlined",margin:"normal",multiline:!0,size:"small"}),e.jsx(R,{id:"investigation",name:"investigation",label:"Investigation",value:ke.investigation,type:"text",onChange:Mt,variant:"outlined",margin:"normal",multiline:!0,size:"small"}),e.jsx(R,{id:"diagnoss",name:"diagnoss",label:"Diagnosis",value:ke.diagnoss,type:"search",onChange:Mt,variant:"outlined",margin:"normal",multiline:!0,size:"small"})," ",e.jsx(R,{id:"tplan",name:"tplan",label:"Treatment Plan",value:ke.tplan,type:"search",onChange:Mt,variant:"outlined",margin:"normal",multiline:!0,size:"small"})," ",e.jsx(R,{id:"medication",name:"medication",label:"Medication",value:ke.medication,type:"search",onChange:Mt,variant:"outlined",margin:"normal",multiline:!0,size:"small"})]})]});case 2:return e.jsx(e.Fragment,{children:e.jsxs(V,{sx:{justifyContent:"center",alignItems:"center",width:"100%",mt:6},children:[e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:24,mb:5},children:"Upload File"}),e.jsx(ji,{type:"file",id:"fileInput",onChange:Xa,style:{display:"none",marginTop:"4",padding:0}}),e.jsx(G,{component:"label",role:void 0,variant:"contained",tabIndex:-1,htmlFor:"fileInput",children:"Choose File"}),St&&e.jsxs(W,{variant:"body1",children:["Selected file: ",St.name]}),y&&e.jsx(W,{color:"error",children:y}),e.jsx(G,{variant:"contained",onClick:er,disabled:!St,sx:{mt:2},startIcon:e.jsx(Yr,{}),children:"Upload"}),Kn&&e.jsx(W,{sx:{mt:2},children:Kn})]})});case 3:return e.jsx(e.Fragment,{children:e.jsx(V,{sx:{border:"none",padding:3},children:e.jsxs(V,{sx:{border:0,paddingLeft:2},children:[" ",e.jsx(ne,{sx:{display:"flex",flexDirection:"column",alignItems:"left","& > *":{m:1}},children:e.jsxs(V,{direction:"column",sx:{paddingLeft:5,border:0},children:[e.jsx(W,{sx:{paddingTop:3,paddingRight:6,border:0,m:0,fontSize:27,justifyContent:"center"},children:"Diagnosis"})," ",e.jsxs(V,{direction:"column",spacing:1,children:[e.jsx(V,{sx:{border:0,padding:0},children:Be&&e.jsx("div",{style:{height:"auto",width:700},children:e.jsx(we,{rows:ce,columns:hr,initialState:{pagination:{paginationModel:{pageSize:5}}}})})}),e.jsxs(Ce,{open:qt,onClose:jt,PaperProps:{component:"form",onSubmit:d=>{d.preventDefault();const q=new FormData(d.currentTarget),Ae=Object.fromEntries(q.entries()).email;console.log(Ae),jt()}},children:[e.jsx(Ne,{children:e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:26},children:"Choose Diagnosis"})}),e.jsxs(ve,{children:[e.jsx(Ze,{sx:{mb:2,alignItems:"center"},color:"success",label:m.join(",")}),e.jsx("br",{}),e.jsxs(Ue,{children:[e.jsx(Re,{options:Dt.map(d=>d.name),renderInput:d=>e.jsx(R,{...d,label:"Preliminary Diagnosis"}),onChange:(d,q)=>{A(q)},size:"small",sx:{width:350}})," ",e.jsx("br",{}),e.jsx(Re,{options:Dt.map(d=>d.name),renderInput:d=>e.jsx(R,{...d,label:"Final Diagnosis"}),onChange:(d,q)=>{te(q)},size:"small",sx:{width:350}})," ",e.jsx("br",{})]})]}),e.jsxs(Ie,{children:[e.jsx(G,{onClick:jt,children:"Cancel"}),e.jsx(G,{onClick:lr,type:"submit",children:"Save Diagnosis"})]})]})]})]})})]})})});case 4:return e.jsxs(e.Fragment,{children:[" ",e.jsx(V,{sx:{border:"none",padding:3},children:e.jsxs(V,{sx:{border:0,paddingLeft:2},children:[" ",e.jsx(ne,{sx:{display:"flex",flexDirection:"column",alignItems:"left","& > *":{m:1}},children:e.jsxs(V,{direction:"column",sx:{paddingLeft:5,border:0},children:[e.jsx(W,{sx:{paddingTop:3,paddingRight:6,border:0,m:0,fontSize:27},children:u})," ",e.jsxs(V,{direction:"column",spacing:1,children:[e.jsx(V,{children:e.jsxs(ne,{children:[e.jsx(Ve,{size:"small","aria-label":"Small button group",children:Ws}),e.jsx(Ve,{size:"small","aria-label":"Small button group",children:Ys}),e.jsx(us,{orientation:"horizontal",variant:"middle",flexItem:!0,sx:{width:600},children:e.jsx(Ze,{sx:{backgroundColor:"primary"},label:"",size:"small"})}),e.jsx(Ve,{size:"small","aria-label":"Small button group",children:Gs}),e.jsx(Ve,{size:"small","aria-label":"Small button group",children:qs})]})}),e.jsx(V,{sx:{border:0,padding:0},children:Be&&e.jsx("div",{style:{height:"auto",width:"100%"},children:e.jsx(we,{rows:ce,columns:ur,initialState:{pagination:{paginationModel:{pageSize:5}}}})})}),e.jsxs(Ce,{open:qt,onClose:jt,PaperProps:{component:"form",onSubmit:d=>{d.preventDefault();const q=new FormData(d.currentTarget),Ae=Object.fromEntries(q.entries()).email;console.log(Ae),jt()}},children:[e.jsx(Ne,{children:e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:26},children:"Suitable Treatment"})}),e.jsxs(ve,{children:[e.jsx(Ze,{sx:{mb:2,alignItems:"center"},color:"success",label:De}),e.jsx("br",{}),e.jsxs(Ue,{children:[e.jsx("br",{}),e.jsx(Re,{options:gt.map(d=>d.name),renderInput:d=>e.jsx(R,{...d,label:"Select Treatment"}),onChange:(d,q)=>{q&&sr(q)},size:"small",sx:{width:350}})]})]}),e.jsxs(Ie,{children:[e.jsx(G,{onClick:jt,children:"Cancel"}),e.jsx(G,{onClick:or,type:"submit",children:"Save Treatment"})]})]})]})]})})]})})]});case 5:return e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsxs(V,{sx:{display:"flex",justifyContent:"center",padding:1,height:"auto",width:"70%"},children:[e.jsx(gi,{children:e.jsx(xi,{variant:"contained",onClick:ir,startIcon:e.jsx(_t,{}),children:"Add Medication"})}),e.jsx(fi,{appointmentId:n,onClose:()=>Le("9")})]}),e.jsx(ui,{appointmentId:n.toString(),open:qt,onClose:jt})]});case 6:return e.jsxs(V,{spacing:2,sx:{margin:8},children:[e.jsx("div",{style:{height:"auto",width:"70%"},children:ht?e.jsx("p",{children:"Loading..."}):e.jsx(we,{rows:pr,columns:mr,pagination:!0})}),e.jsx(R,{label:"Doctor Comments",value:ke.comments,onChange:Mt,multiline:!0,size:"small",type:"search",name:"comments",sx:{width:"70%"},rows:4},"comm")]});default:return"Unknown step"}};return ht?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px"},children:e.jsx(ze,{})}):e.jsxs("div",{children:[e.jsx(Br,{activeStep:o,children:cs.map((p,d)=>e.jsx(Ur,{children:e.jsx(Jr,{children:p})},d))}),e.jsx("div",{children:o===cs.length?e.jsx(W,{children:"All steps completed"}):e.jsxs("div",{children:[jr(o),e.jsx("div",{}),e.jsxs("div",{style:{marginTop:"20px",width:"70%"},children:[e.jsx(G,{disabled:o===0,onClick:gr,children:"Back"}),o===cs.length-1?e.jsx(Hr,{children:e.jsxs(V,{direction:{xs:"column",md:"row"},children:[e.jsxs(Wr,{row:!0,"aria-labelledby":"demo-row-radio-buttons-group-label",name:"row-radio-buttons-group",value:Js,onChange:Va,children:[e.jsx(Xe,{value:"Just Finish",control:e.jsx(aa,{}),label:"Just Finish"}),e.jsx(Xe,{value:"Its ready and Complete",control:e.jsx(aa,{}),label:"Its ready,  and Complete"})]}),e.jsx(G,{onClick:Ks,variant:"contained",children:"Save"})]})}):e.jsxs(G,{variant:"text",onClick:Ks,disabled:ht,children:[" ","Next"]})]})]})})]})},ha=ae.forwardRef(function(s,a){return e.jsx(Ds,{direction:"up",ref:a,...s})}),bi=n=>Te(n).format("DD-MM-YYYY HH:mm"),fa=()=>{var Fe;const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState(!1),[o,r]=t.useState(""),[S,i]=t.useState("success"),[x,u]=t.useState(!0),[h,v]=t.useState(!0),[D,c]=t.useState([]),[Q,Y]=t.useState(""),[L,J]=t.useState([]),[_,P]=t.useState(""),[U,Z]=t.useState(null),[B,K]=t.useState(!1),[M,w]=ae.useState(!1),[j,m]=ae.useState(!1),[C,f]=t.useState([]),[T,N]=t.useState("0001"),z=new Date().getFullYear(),ee=new Date().getMonth()+1,[se,H]=t.useState(Te.tz(Te(),"Africa/Nairobi")),[E,I]=t.useState(Te.tz(Te(),"Africa/Nairobi")),[F,k]=t.useState(),[g,$]=t.useState(""),A=(oe,ce)=>{ce!=="clickaway"&&l(!1)},O=()=>{w(!1)},te=()=>{K(!1)},pe=t.useCallback(async()=>{var oe;if((oe=s==null?void 0:s.user)!=null&&oe.entity_name){u(!0);try{const ce=await fetch(`${n}/appointments/by-flag/${s.user.entity_name}`,{method:"GET"});if(!ce.ok)throw new Error(`Failed to fetch appointments: ${ce.status}`);const me=await ce.json();c(me),J(me)}catch(ce){r(`Error: ${ce.message}`),i("error"),l(!0),console.error("Error fetching appointments:",ce)}finally{u(!1),v(!1)}}},[(Fe=s==null?void 0:s.user)==null?void 0:Fe.entity_name,n]);t.useEffect(()=>{h&&pe()},[h,pe]),t.useEffect(()=>{const oe=Q.toLowerCase(),ce=D.filter(me=>Object.values(me).some(De=>String(De).toLowerCase().includes(oe)));J(ce)},[Q,D]);const re=async()=>{var oe;if((oe=s==null?void 0:s.user)!=null&&oe.entity_name)try{const ce=await fetch(`${n}/cases/monthly/${z}/${ee}/${s.user.entity_name}`);if(!ce.ok)throw new Error(`HTTP error! status: ${ce.status}`);const me=await ce.json();N((me+1).toString().padStart(4,"0")),console.log("Monthly count:",me)}catch(ce){console.error("Fetch error:",ce),r(`Failed to fetch monthly case count: ${ce.message}`),i("error"),l(!0)}};t.useEffect(()=>{re()},[]);function de(oe){return oe.toString().slice(-2)}function je(oe){return oe?oe.split(" ").map(me=>me.charAt(0).toUpperCase()).join(""):""}const Me=async oe=>{u(!0);try{const ce=new URLSearchParams;oe.patientHistory&&(ce.append("patientName",_),ce.append("hali","appointmentid"),ce.append("patientHistory",JSON.stringify(oe)));const me=`${n}/task-info/appointment/${U}?${ce.toString()}`,De=await fetch(me,{method:"PUT"});if(!De.ok){const Je=await De.text();throw console.error("Server error:",Je),console.log(me),new Error(`Failed to update case: ${De.status} - ${Je}`)}const Pe=await De.json();console.log(_,"patient name",me),r("Case updated successfully"),i("success");const Be=`${n}/appointments/${U}`,et=await fetch(Be,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"examined"})});if(et.ok){const Je=await et.json();console.log("Appointment updated",Je)}else{const Je=await et.text();console.error("Failed to update appointment status:",Je),r(`Failed to update appointment status: ${Je}`),i("error")}l(!0),K(!1),v(!0),re()}catch(ce){r(`Error: ${ce.message}`),i("error"),l(!0),console.error("Error updating case:",ce)}finally{u(!1)}},Se=async(oe,ce)=>{var me;Z(oe),P(ce),u(!0);try{const De=await fetch(`${n}/task-info/appointment/${oe}`);if(De.ok){const Pe=await De.json();f(Pe),console.log("Case data fetched:",Pe),K(!0)}else if(De.status===404){f([]);try{const Pe=(me=s==null?void 0:s.user)==null?void 0:me.entity_name,Be=je(Pe),et=de(z),Je=ee.toString().padStart(2,"0"),mt=`${Be}/CAS/${et}${Je}-${T}`,Ke=await fetch(`${n}/cases`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({appointmentId:oe,caseNumber:mt,patientName:ce,clinicName:Pe})});if(!Ke.ok){const ut=await Ke.json();throw new Error(`Failed to create case: ${Ke.status} - ${ut.message||"Unknown error"}`)}P(""),r("Case created successfully"),i("success"),l(!0),K(!0),v(!0),re()}catch(Pe){r(`Error creating case: ${Pe.message}`),i("error"),l(!0),console.error("Error creating case:",Pe)}finally{u(!1)}}else{const Pe=await De.json();throw new Error(`Failed to fetch case data: ${De.status} - ${Pe.message||"Unknown error"}`)}}catch(De){r(`Error: ${De.message}`),i("error"),l(!0),console.error("Error fetching case data:",De)}finally{u(!1),w(!1)}},be=[{field:"id",headerName:"ID",width:50},{field:"patientName",headerName:"Patient Name",width:150},{field:"appointmentDate",headerName:"Appointment Date",width:200,valueFormatter:oe=>bi(oe)},{field:"serviceNumber",headerName:"Service Number",width:200},{field:"clinicName",headerName:"Clinic Name",width:200},{field:"status",headerName:"Status",width:130},{field:"actions",type:"actions",headerName:"Actions",width:90,getActions:oe=>[e.jsx(ge,{icon:e.jsx(Qr,{}),label:"Examine",onClick:()=>Se(oe.row.id,oe.row.patientName),showInMenu:!0},"examine"),e.jsx(ge,{icon:e.jsx(ds,{sx:{color:"green"}}),label:"Schedule",onClick:()=>{k(oe.row.id),w(!0),$("schedule")},showInMenu:!0},"schedule"),e.jsx(ge,{icon:e.jsx(ds,{sx:{color:"green"}}),label:"Schedule & Examine",onClick:()=>{k(oe.row.id),w(!0),P(oe.row.patientName)},showInMenu:!0},"scheduleExamine")]}],Le=oe=>{I(oe),H(oe)},fe=async()=>{u(!0);try{const oe=`${n}/appointments/${F}`,ce=await fetch(oe,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({scheduleDate:E==null?null:E.format(),status:"scheduled"})});if(ce.ok){const me=await ce.json();console.log("Appointment updated",me)}else{const me=await ce.text();console.error("Failed to update Schedule Date status:",me),r(`Failed to update Schedule Date status: ${me}`),i("error")}w(!1),l(!0),v(!0)}catch(oe){r(`Error: ${oe.message}`),i("error"),l(!0)}finally{u(!1)}},Ee=async()=>{u(!0);try{const oe=`${n}/appointments/${F}`,ce=await fetch(oe,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({scheduleDate:E==null?null:E.format(),status:"examined-and-scheduled"})});if(ce.ok){const me=await ce.json();console.log("Appointment updated",me)}else{const me=await ce.text();console.error("Failed to update Schedule Date status:",me),r(`Failed to update Schedule Date status: ${me}`),i("error")}l(!0),Se(F,_),w(!1),v(!0)}catch(oe){r(`Error: ${oe.message}`),i("error"),l(!0)}finally{u(!1)}};return t.useEffect(()=>{const oe=setInterval(()=>{I(Te.tz(Te(),"Africa/Nairobi"))},1e3);return()=>clearInterval(oe)},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10,padding:"0 16px"},children:e.jsx(R,{label:"Search Appointments",value:Q,onChange:oe=>Y(oe.target.value),variant:"outlined",size:"small"})}),e.jsxs("div",{style:{height:"auto",width:"100%"},children:[x?e.jsx("p",{children:"Loading..."}):e.jsx(we,{rows:L,columns:be,pagination:!0}),e.jsx($e,{open:a,autoHideDuration:3e3,onClose:A,children:e.jsx(ye,{onClose:A,severity:S,variant:"filled",children:o})})]}),e.jsxs(Ce,{open:B,fullScreen:!0,TransitionComponent:ha,onClose:te,children:[" ",e.jsx(Ps,{sx:{position:"relative"},children:e.jsxs(As,{children:[e.jsx(On,{edge:"start",color:"inherit",onClick:te,"aria-label":"close",children:e.jsx(Is,{})}),e.jsx(W,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:"Close"})]})}),e.jsx(Ne,{children:"Examine Appointment"}),e.jsx(ve,{children:x?e.jsx("p",{children:"Loading..."}):U&&e.jsx(Si,{appointmentId:U,initialCaseData:C,onCaseUpdate:Me,patientNa:_})})]}),e.jsxs(Ce,{open:M,TransitionComponent:ha,keepMounted:!0,onClose:te,"aria-describedby":"alert-dialog-slide-description",children:[e.jsx(Ne,{children:"Set Next Schedule"}),e.jsxs(ve,{sx:{height:"auto",width:"auto"},children:[" ",e.jsx(ba,{dateAdapter:wa,children:e.jsx(V,{spacing:2,sx:{minWidth:305,marginTop:3},children:e.jsx(Ca,{label:"Date and Time",value:E,onChange:Le})})})]}),e.jsxs(Ie,{children:[e.jsx(G,{onClick:O,children:"Cancel"}),e.jsx(G,{onClick:g=="schedule"?fe:Ee,children:"Schedule"})]})]})]})};function Ma(n){const s="https://dental-clinic-latest.onrender.com",{session:a}=he(),[l,o]=t.useState(""),[r,S]=t.useState(""),[i,x]=t.useState("");Te().tz("Africa/Nairobi").format("DD/MM/YYYY, h:mm:ss A");const u=()=>{fetch(`${s}/diagnosis`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:l})}).then(h=>h.status==201?h.json():null).then(h=>{o("")})};return e.jsxs(ft,{...n,children:[e.jsx(at,{enableColorScheme:!0}),e.jsx(V,{direction:"column",component:"main",children:e.jsxs(ne,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:"36ch",marginTop:0}},noValidate:!0,autoComplete:"off",children:[e.jsx("div",{children:e.jsx(R,{id:"name",label:"Diagnosis Name",onChange:h=>o(h.target.value),type:"search",value:l,variant:"standard"})}),e.jsx(G,{sx:{textTransform:"none",float:"center"},variant:"contained",onClick:u,children:"Save Diagnosis"})]})})]})}function Fa(n){const s="https://dental-clinic-latest.onrender.com",{session:a}=he(),[l,o]=t.useState(""),[r,S]=t.useState(""),[i,x]=t.useState("");Te().tz("Africa/Nairobi").format("DD/MM/YYYY, h:mm:ss A");const u=()=>{fetch(`${s}/examination`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:l})}).then(h=>h.status==201?h.json():null).then(h=>{o("")})};return e.jsxs(ft,{...n,children:[e.jsx(at,{enableColorScheme:!0}),e.jsx(V,{direction:"column",component:"main",children:e.jsxs(ne,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:"36ch",marginTop:0}},noValidate:!0,autoComplete:"off",children:[e.jsx("div",{children:e.jsx(R,{id:"name",label:"Examination Name",onChange:h=>o(h.target.value),type:"search",value:l,variant:"standard"})}),e.jsx(G,{sx:{textTransform:"none",float:"center"},variant:"contained",onClick:u,children:"Save Examination"})]})})]})}function Oa(n){const s="https://dental-clinic-latest.onrender.com",{session:a}=he(),[l,o]=t.useState(""),[r,S]=t.useState(""),[i,x]=t.useState("");Te().tz("Africa/Nairobi").format("DD/MM/YYYY, h:mm:ss A");const u=()=>{fetch(`${s}/surfaces`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:l})}).then(h=>h.status==201?h.json():null).then(h=>{o("")})};return e.jsxs(ft,{...n,children:[e.jsx(at,{enableColorScheme:!0}),e.jsx(V,{direction:"column",component:"main",children:e.jsxs(ne,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:"36ch",marginTop:0}},noValidate:!0,autoComplete:"off",children:[e.jsx("div",{children:e.jsx(R,{id:"name",label:"Surface Name",onChange:h=>o(h.target.value),type:"search",value:l,variant:"standard"})}),e.jsx(G,{sx:{textTransform:"none",float:"center"},variant:"contained",onClick:u,children:"Save Surface"})]})})]})}function wi(n,s,a){var S;if(!n||n.length===0)return null;const l=(S=n[0])==null?void 0:S.diagnosis;if(!l)return null;let o;try{o=JSON.parse(l)}catch(i){return console.error("Error parsing diagnosis string:",i),null}const r=o.findIndex(i=>i.id===s);return r!==-1?(o[r]={...o[r],...a},o):(console.warn(`Diagnosis with ID ${s} not found.`),null)}const Ci=(n,s)=>{const a=JSON.stringify(n);return new Promise((l,o)=>{fetch(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({diagnosis:a})}).then(r=>r.ok?r.json():r.json().then(S=>{throw new Error(S.message||`HTTP error! status: ${r.status}`)})).then(r=>{console.log("API Response:",r),l({success:!0,message:"Diagnoses saved successfully!"})}).catch(r=>{console.error("API Error:",r),o({success:!1,message:r.message||"Failed to save diagnoses."})})})},_a=()=>{var B,K;const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState([]),[o,r]=t.useState(!0),[S,i]=t.useState(null),[x,u]=t.useState(!1),[h,v]=t.useState(null),[D,c]=t.useState(!1),[Q,Y]=t.useState(""),L=t.useCallback(async()=>{var M;if((M=s==null?void 0:s.user)!=null&&M.entity_name){r(!0);try{const w=await fetch(`${n}/clinics/cbyname/${s.user.entity_name}`,{method:"GET"});if(!w.ok)throw new Error(`HTTP error! Status: ${w.status}`);const j=[await w.json()];Array.isArray(j)?l(j):(i("Unexpected API response: Expected an array of clinic data."),l([])),i(null)}catch(w){i(w.message),l([])}finally{r(!1)}}},[(B=s==null?void 0:s.user)==null?void 0:B.entity_name,n]);t.useEffect(()=>{L()},[L]);const J=M=>{var C;const w=(C=a[0])==null?void 0:C.diagnosis;if(!w){i("No diagnosis data found.");return}let j;try{j=JSON.parse(w)}catch(f){console.error("Error parsing diagnosis string:",f),i("Invalid diagnosis data format.");return}const m=j.find(f=>f.id===M);if(!m){i(`Diagnosis with ID ${M} not found.`);return}v(m),Y(m.name),u(!0)},_=async()=>{var w;if(!h)return;const M=wi(a,h.id,{name:Q});if(M){try{const j=await Ci(M,`${n}/clinics/name/${(w=s==null?void 0:s.user)==null?void 0:w.entity_name}`);j.success?(console.log(j.message),l(m=>m.map(C=>({...C,diagnosis:JSON.stringify(M)}))),c(!0)):i(j.message||"Failed to save diagnoses.")}catch(j){const m=j.message||"An unexpected error occurred. Please try again.";i(m),console.error("Error sending data:",j)}finally{r(!1)}i(null),u(!1)}else i("Failed to update diagnosis. Check console for details.")},P=t.useCallback(M=>{var C;const w=(C=a[0])==null?void 0:C.diagnosis;if(!w){i("No diagnosis data found.");return}let j;try{j=JSON.parse(w)}catch(f){console.error("Error parsing diagnosis string:",f),i("Invalid diagnosis data format.");return}const m=j.filter(f=>f.id!==M);l(f=>f.map(T=>({...T,diagnosis:JSON.stringify(m)}))),c(!0)},[a]),U=[{field:"id",headerName:"ID",width:70},{field:"name",headerName:"Name",width:150},{field:"actions",type:"actions",headerName:"Actions",width:150,getActions:M=>[e.jsx(ge,{icon:e.jsx(rt,{}),label:"Edit",onClick:()=>J(M.row.id),showInMenu:!0}),e.jsx(ge,{icon:e.jsx(ot,{}),label:"Delete",onClick:()=>P(M.row.id),showInMenu:!0})]}];let Z=[];if(a&&a.length>0&&((K=a[0])!=null&&K.diagnosis))try{Z=JSON.parse(a[0].diagnosis)}catch(M){console.error("Error parsing diagnosis data",M),Z=[],i("Error parsing diagnosis data. Please check the data source.")}else Z=[];return o?e.jsx(W,{children:"Loading..."}):e.jsxs(ne,{sx:{p:4},children:[S&&e.jsxs(ye,{severity:"error",sx:{mb:2},children:[e.jsx(zt,{children:"Error"}),S]}),e.jsx(ne,{sx:{height:"auto",width:"100%"},children:e.jsx(we,{rows:Z,columns:U,initialState:{pagination:{paginationModel:{pageSize:5}}},pageSizeOptions:[5,10,20]})}),e.jsxs(Ce,{open:x,onClose:()=>u(!1),children:[e.jsx(Ne,{children:"Edit Diagnosis"}),e.jsxs(ve,{children:[e.jsx(Ue,{children:"Edit the diagnosis details below."}),e.jsx(R,{autoFocus:!0,margin:"dense",id:"name",label:"Name",value:Q,onChange:M=>Y(M.target.value),fullWidth:!0,variant:"standard"})]}),e.jsxs(Ie,{children:[e.jsx(G,{onClick:()=>u(!1),children:"Cancel"}),e.jsx(G,{onClick:_,children:"Update"})]})]}),e.jsx($e,{open:D,autoHideDuration:6e3,onClose:()=>c(!1),message:"Diagnosis updated successfully!"})]})};function vi(n,s,a){var S;if(!n||n.length===0)return null;const l=(S=n[0])==null?void 0:S.examination;if(!l)return null;let o;try{o=JSON.parse(l)}catch(i){return console.error("Error parsing examination string:",i),null}const r=o.findIndex(i=>i.id===s);return r!==-1?(o[r]={...o[r],...a},o):(console.warn(`Examination with ID ${s} not found.`),null)}const Ei=(n,s)=>{const a=JSON.stringify(n);return new Promise((l,o)=>{fetch(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({examination:a})}).then(r=>r.ok?r.json():r.json().then(S=>{throw new Error(S.message||`HTTP error! status: ${r.status}`)})).then(r=>{console.log("API Response:",r),l({success:!0,message:"Examinations saved successfully!"})}).catch(r=>{console.error("API Error:",r),o({success:!1,message:r.message||"Failed to save examinations."})})})},Ra=()=>{var B,K;const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState([]),[o,r]=t.useState(!0),[S,i]=t.useState(null),[x,u]=t.useState(!1),[h,v]=t.useState(null),[D,c]=t.useState(!1),[Q,Y]=t.useState(""),L=t.useCallback(async()=>{var M;if((M=s==null?void 0:s.user)!=null&&M.entity_name){r(!0);try{const w=await fetch(`${n}/clinics/cbyname/${s.user.entity_name}`,{method:"GET"});if(!w.ok)throw new Error(`HTTP error! Status: ${w.status}`);const j=[await w.json()];Array.isArray(j)?l(j):(i("Unexpected API response: Expected an array of clinic data."),l([])),i(null)}catch(w){i(w.message),l([])}finally{r(!1)}}},[(B=s==null?void 0:s.user)==null?void 0:B.entity_name,n]);t.useEffect(()=>{L()},[L]);const J=M=>{var C;const w=(C=a[0])==null?void 0:C.examination;if(!w){i("No examination data found.");return}let j;try{j=JSON.parse(w)}catch(f){console.error("Error parsing examination string:",f),i("Invalid examination data format.");return}const m=j.find(f=>f.id===M);if(!m){i(`Examination with ID ${M} not found.`);return}v(m),Y(m.name),u(!0)},_=async()=>{var w;if(!h)return;const M=vi(a,h.id,{name:Q});if(M){try{const j=await Ei(M,`${n}/clinics/name/${(w=s==null?void 0:s.user)==null?void 0:w.entity_name}`);j.success?(console.log(j.message),l(m=>m.map(C=>({...C,examination:JSON.stringify(M)}))),c(!0)):i(j.message||"Failed to save examinations.")}catch(j){const m=j.message||"An unexpected error occurred. Please try again.";i(m),console.error("Error sending data:",j)}finally{r(!1)}i(null),u(!1)}else i("Failed to update examination. Check console for details.")},P=t.useCallback(M=>{var C;const w=(C=a[0])==null?void 0:C.examination;if(!w){i("No examination data found.");return}let j;try{j=JSON.parse(w)}catch(f){console.error("Error parsing examination string:",f),i("Invalid examination data format.");return}const m=j.filter(f=>f.id!==M);l(f=>f.map(T=>({...T,examination:JSON.stringify(m)}))),c(!0)},[a]),U=[{field:"id",headerName:"ID",width:70},{field:"name",headerName:"Name",width:150},{field:"actions",type:"actions",headerName:"Actions",width:150,getActions:M=>[e.jsx(ge,{icon:e.jsx(rt,{}),label:"Edit",onClick:()=>J(M.row.id),showInMenu:!0}),e.jsx(ge,{icon:e.jsx(ot,{}),label:"Delete",onClick:()=>P(M.row.id),showInMenu:!0})]}];let Z=[];if(a&&a.length>0&&((K=a[0])!=null&&K.examination))try{Z=JSON.parse(a[0].examination)}catch(M){console.error("Error parsing examination data",M),Z=[],i("Error parsing examination data. Please check the data source.")}else Z=[];return o?e.jsx(W,{children:"Loading..."}):e.jsxs(ne,{sx:{p:4},children:[S&&e.jsxs(ye,{severity:"error",sx:{mb:2},children:[e.jsx(zt,{children:"Error"}),S]}),e.jsx(ne,{sx:{height:"auto",width:"100%"},children:e.jsx(we,{rows:Z,columns:U,initialState:{pagination:{paginationModel:{pageSize:5}}},pageSizeOptions:[5,10,20]})}),e.jsxs(Ce,{open:x,onClose:()=>u(!1),children:[e.jsx(Ne,{children:"Edit Examination"}),e.jsxs(ve,{children:[e.jsx(Ue,{children:"Edit the examination details below."}),e.jsx(R,{autoFocus:!0,margin:"dense",id:"name",label:"Name",value:Q,onChange:M=>Y(M.target.value),fullWidth:!0,variant:"standard"})]}),e.jsxs(Ie,{children:[e.jsx(G,{onClick:()=>u(!1),children:"Cancel"}),e.jsx(G,{onClick:_,children:"Update"})]})]}),e.jsx($e,{open:D,autoHideDuration:6e3,onClose:()=>c(!1),message:"Examination updated successfully!"})]})};function ki(n,s,a){var S;if(!n||n.length===0)return null;const l=(S=n[0])==null?void 0:S.surface;if(!l)return null;let o;try{o=JSON.parse(l)}catch(i){return console.error("Error parsing surface string:",i),null}const r=o.findIndex(i=>i.id===s);return r!==-1?(o[r]={...o[r],...a},o):(console.warn(`Medication with ID ${s} not found.`),null)}const Ti=(n,s)=>{const a=JSON.stringify(n);return new Promise((l,o)=>{fetch(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({surface:a})}).then(r=>r.ok?r.json():r.json().then(S=>{throw new Error(S.message||`HTTP error! status: ${r.status}`)})).then(r=>{console.log("API Response:",r),l({success:!0,message:"Surfaces saved successfully!"})}).catch(r=>{console.error("API Error:",r),o({success:!1,message:r.message||"Failed to save surfaces."})})})},La=()=>{var z,ee;const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState([]),[o,r]=t.useState(!0),[S,i]=t.useState(null),[x,u]=t.useState(!1),[h,v]=t.useState(null),[D,c]=t.useState(!1),[Q,Y]=t.useState(""),[L,J]=t.useState(""),[_,P]=t.useState(""),[U,Z]=t.useState(""),[B,K]=t.useState(""),[M,w]=t.useState(""),j=t.useCallback(async()=>{var se;if((se=s==null?void 0:s.user)!=null&&se.entity_name){r(!0);try{const H=await fetch(`${n}/clinics/cbyname/${s.user.entity_name}`,{method:"GET"});if(!H.ok)throw new Error(`HTTP error! Status: ${H.status}`);const E=[await H.json()];Array.isArray(E)?l(E):(i("Unexpected API response: Expected an array of clinic data."),l([])),i(null)}catch(H){i(H.message),l([])}finally{r(!1)}}},[(z=s==null?void 0:s.user)==null?void 0:z.entity_name,n]);t.useEffect(()=>{j()},[j]);const m=se=>{var F;const H=(F=a[0])==null?void 0:F.surface;if(!H){i("No surface data found.");return}let E;try{E=JSON.parse(H)}catch(k){console.error("Error parsing surface string:",k),i("Invalid surface data format.");return}const I=E.find(k=>k.id===se);if(!I){i(`Medication with ID ${se} not found.`);return}v(I),Y(I.name),J(I.dosage||""),P(I.frequency||""),Z(I.duration||""),K(I.remarks||""),w(I.price||""),u(!0)},C=async()=>{var H;if(!h)return;const se=ki(a,h.id,{name:Q,dosage:L,frequency:_,duration:U,remarks:B,price:M});if(se){try{const E=await Ti(se,`${n}/clinics/name/${(H=s==null?void 0:s.user)==null?void 0:H.entity_name}`);E.success?(console.log(E.message),l(I=>I.map(F=>({...F,surface:JSON.stringify(se)}))),c(!0)):i(E.message||"Failed to save surfaces.")}catch(E){const I=E.message||"An unexpected error occurred. Please try again.";i(I),console.error("Error sending data:",E)}finally{r(!1)}i(null),u(!1)}else i("Failed to update surface. Check console for details.")},f=t.useCallback(se=>{var F;const H=(F=a[0])==null?void 0:F.surface;if(!H){i("No surface data found.");return}let E;try{E=JSON.parse(H)}catch(k){console.error("Error parsing surface string:",k),i("Invalid surface data format.");return}const I=E.filter(k=>k.id!==se);l(k=>k.map(g=>({...g,surface:JSON.stringify(I)}))),c(!0)},[a]),T=[{field:"id",headerName:"ID",width:70},{field:"name",headerName:"Name",width:150},{field:"actions",type:"actions",headerName:"Actions",width:150,getActions:se=>[e.jsx(ge,{icon:e.jsx(rt,{}),label:"Edit",onClick:()=>m(se.row.id),showInMenu:!0}),e.jsx(ge,{icon:e.jsx(ot,{}),label:"Delete",onClick:()=>f(se.row.id),showInMenu:!0})]}];let N=[];if(a&&a.length>0&&((ee=a[0])!=null&&ee.surface))try{N=JSON.parse(a[0].surface)}catch(se){console.error("Error parsing surface data",se),N=[],i("Error parsing surface data. Please check the data source.")}else N=[];return o?e.jsx(W,{children:"Loading..."}):e.jsxs(ne,{sx:{p:4},children:[S&&e.jsxs(ye,{severity:"error",sx:{mb:2},children:[e.jsx(zt,{children:"Error"}),S]}),e.jsx(ne,{sx:{height:"auto",width:"100%"},children:e.jsx(we,{rows:N,columns:T,initialState:{pagination:{paginationModel:{pageSize:5}}},pageSizeOptions:[5,10,20]})}),e.jsxs(Ce,{open:x,onClose:()=>u(!1),children:[e.jsx(Ne,{children:"Edit Surface"})," ",e.jsxs(ve,{children:[e.jsx(Ue,{children:"Edit the surface details below. "}),e.jsx(R,{autoFocus:!0,margin:"dense",id:"name",label:"Name",value:Q,onChange:se=>Y(se.target.value),fullWidth:!0,variant:"standard"})]}),e.jsxs(Ie,{children:[e.jsx(G,{onClick:()=>u(!1),children:"Cancel"}),e.jsx(G,{onClick:C,children:"Update"})]})]}),e.jsx($e,{open:D,autoHideDuration:6e3,onClose:()=>c(!1),message:"Surface updated successfully!"})]})};function za(n){const s="https://dental-clinic-latest.onrender.com",{session:a}=he(),[l,o]=t.useState(""),[r,S]=t.useState(""),[i,x]=t.useState(""),[u,h]=t.useState(""),[v,D]=t.useState(""),[c,Q]=t.useState(""),[Y,L]=t.useState("");Te().tz("Africa/Nairobi").format("DD/MM/YYYY, h:mm:ss A");const[J,_]=t.useState(!1),[P,U]=t.useState(""),[Z,B]=t.useState(!1),[K,M]=t.useState(!1),[w,j]=t.useState(""),[m,C]=t.useState(""),[f,T]=t.useState(""),[N,z]=t.useState(""),[ee,se]=t.useState(""),[H,E]=t.useState(""),I=async()=>{if(w==""&&m==""&&f==""){U("Some of field not filled,  Please fill all field to Continue...");return}M(!0);try{const k=await fetch(`${s}/medications`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:w,dosage:m,frequency:f,duration:N,remarks:ee,price:H})});k.status===201?await k.json():console.error("Failed to create medication:",k.status),C(""),z(" "),T(""),j(""),E(""),se("")}catch(k){console.error("Error creating medication:",k)}finally{_(!0),M(!1)}},F=(k,g)=>{g!=="clickaway"&&_(!1)};return e.jsxs(ft,{...n,children:[e.jsx(at,{enableColorScheme:!0}),e.jsx(V,{direction:"column",component:"main",sx:[{justifyContent:"center",height:"calc((1 - var(--template-frame-height, 0)) * 100%)",marginTop:"max(0px - var(--template-frame-height, 0px), 0px)",minHeight:"100%"},k=>({"&::before":{content:'""',display:"block",position:"absolute",zIndex:-1,inset:0,backgroundImage:"radial-gradient(ellipse at 50% 50%, hsl(210, 100%, 97%), hsl(0, 0%, 100%))",backgroundRepeat:"no-repeat",...k.applyStyles("dark",{backgroundImage:"radial-gradient(at 50% 50%, hsla(210, 100%, 16%, 0.5), hsl(220, 30%, 5%))"})}})],children:e.jsx(V,{direction:{xs:"column-reverse",md:"row"},sx:{justifyContent:"center",gap:{xs:6,sm:12},p:2,mx:"auto"},children:e.jsx(V,{direction:{xs:"column-reverse",md:"row"},sx:{justifyContent:"center",gap:{xs:6,sm:12},p:{xs:2,sm:4},m:"auto",mt:0},spacing:2,children:e.jsxs(ne,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:"36ch",marginTop:0}},noValidate:!0,autoComplete:"off",children:[e.jsxs("div",{children:[" ",e.jsx("p",{style:{color:"red",fontSize:"14"},children:P}),e.jsx(R,{id:"name",label:"Medication Name",onChange:k=>j(k.target.value),type:"search",value:w,helperText:"Hydrocortisone",variant:"outlined"}),e.jsx(R,{id:"dosage",label:"Dosage",type:"search",onChange:k=>C(k.target.value),variant:"outlined",helperText:"500mg",value:m}),e.jsx(R,{id:"frequency",value:f,onChange:k=>T(k.target.value),label:"Frequency",helperText:"6	",type:"search",variant:"outlined"}),e.jsx(R,{id:"duration",label:"Duration",value:N,type:"search",helperText:"fill (Hrs) number eg 4 ",onChange:k=>z(k.target.value),variant:"outlined"}),e.jsx(R,{id:"remarks",label:"Remarks",onChange:k=>se(k.target.value),type:"search",value:ee,helperText:"FDC/PO",variant:"outlined"})," ",e.jsx(R,{id:"price",label:"Price",onChange:k=>E(k.target.value),type:"search",value:H,variant:"outlined"})," "]}),e.jsx(G,{sx:{textTransform:"none",float:"center"},variant:"contained",onClick:I,children:K?e.jsx(ze,{size:24,sx:{color:"green"}}):"Save Medication"}),e.jsx($e,{open:J,autoHideDuration:1500,onClose:F,children:e.jsx(ye,{onClose:F,severity:"success",variant:"filled",sx:{width:"100%"},children:"Success"})})]})})})})]})}function Ni(){var H;const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState(!1),[o,r]=t.useState(!0),[S,i]=t.useState(""),[x,u]=t.useState(!0),[h,v]=t.useState(),[D,c]=t.useState(!1),[Q,Y]=t.useState([]),[L,J]=t.useState(""),[_,P]=t.useState(""),[U,Z]=t.useState(""),[B,K]=t.useState(""),[M,w]=t.useState(""),[j,m]=t.useState(""),C=(E,I)=>{I!=="clickaway"&&l(!1)},f=()=>{c(!1)},T=t.useCallback((E,I,F,k,g,$,A)=>()=>{c(!0),v(E),i(I),P(F),Z(k),K(g),w($),m(A)},[]),N=t.useCallback(E=>()=>{confirm("Are you sure you want to delete this Prothesis ?")&&fetch(`${n}/medications/${E}`,{method:"DELETE"}).then(I=>{I.ok?Y(F=>F.filter(k=>k.id!==E)):console.error(`Failed to delete case with ID: ${E}`)}).catch(I=>{console.error(`Error deleting case with ID: ${E}`,I)})},[]),z=async()=>{try{const E={name:S,dosage:_,frequency:U,remarks:M,price:j,duration:B},I=await fetch(`${n}/medications/${h}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)});if(!I.ok){const F=await I.json();console.error("API Error:",F);return}u(!1),l(!0)}catch(E){console.error("Fetch Error:",E)}u(!0)};t.useEffect(()=>{var E;x&&(r(!0),fetch(`${n}/clinics/cbyname/${(E=s==null?void 0:s.user)==null?void 0:E.entity_name}`,{method:"GET"}).then(I=>I.status===200?I.json():null).then(I=>{if(I!==null&&(I!=null&&I.medication))try{const F=JSON.parse(I.medication);Array.isArray(F)?(Y(F),console.log(JSON.parse(I.medication))):(console.error("Medication data is not an array:",F),Y([])),console.log("API Response:",F)}catch(F){console.error("Error parsing medication data:",F),Y([])}else Y([]);u(!1),r(!1)}))},[x,(H=s==null?void 0:s.user)==null?void 0:H.entity_name,n]);const ee=[{field:"id",headerName:"ID",width:70},{field:"name",headerName:"Medication Name",width:170},{field:"dosage",headerName:"Dosage",width:130},{field:"frequency",headerName:"Frequency",width:130},{field:"duration",headerName:"Duration",width:130},{field:"remarks",headerName:"Remarks",width:130},{field:"price",headerName:"Price",width:130},{field:"actions",type:"actions",headerName:"Actions",width:90,getActions:E=>[e.jsx(ge,{icon:e.jsx(rt,{sx:{color:"blue"}}),label:"Edit",onClick:T(E.row.id,E.row.name,E.row.dosage,E.row.frequency,E.row.duration,E.row.remarks,E.row.price),showInMenu:!0},`edit-${E.row.id}`),e.jsx(ge,{icon:e.jsx(ot,{sx:{color:"red"}}),label:"Delete",onClick:N(E.row.id),showInMenu:!0},`delete-${E.row.id}`)]}],se=Q;return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:10}}),e.jsxs("div",{style:{height:"auto",width:"100%"},children:[o?e.jsx("p",{children:"Loading..."}):e.jsx(we,{rows:se,columns:ee,pagination:!0,getRowId:E=>E.id}),e.jsxs("div",{children:[e.jsxs(Ce,{open:D,onClose:f,PaperProps:{component:"form",onSubmit:E=>{E.preventDefault();const I=new FormData(E.currentTarget),k=Object.fromEntries(I.entries()).email;console.log(k),f()}},children:[e.jsx(Ne,{children:e.jsx(W,{sx:{paddingLeft:2,fontWeight:"bold",fontSize:26},children:"Edit Info"})}),e.jsx(ve,{children:e.jsxs(Ue,{children:[e.jsx("br",{}),e.jsx(R,{id:"name",label:"Medication Name",onChange:E=>i(E.target.value),type:"search",value:S,sx:{margin:2},size:"small",helperText:"Hydrocortisone",variant:"outlined"}),e.jsx(R,{id:"dosage",label:"Dosage",type:"search",onChange:E=>P(E.target.value),variant:"outlined",helperText:"500mg",size:"small",sx:{margin:2},value:_}),e.jsx("br",{}),e.jsx(R,{id:"frequency",value:U,onChange:E=>Z(E.target.value),label:"Frequency",sx:{margin:2},helperText:"6 ",size:"small",type:"search",variant:"outlined"}),e.jsx(R,{id:"duration",label:"Duration",value:B,type:"search",size:"small",sx:{margin:2},helperText:"fill (Hrs) number eg 4 ",onChange:E=>K(E.target.value),variant:"outlined"})," ",e.jsx("br",{}),e.jsx(R,{id:"remarks",label:"Remarks",onChange:E=>w(E.target.value),type:"search",size:"small",sx:{margin:2},value:M,helperText:"FDC/PO",variant:"outlined"})," ",e.jsx(R,{id:"price",label:"Price",onChange:E=>m(E.target.value),type:"search",value:j,sx:{margin:2},size:"small",variant:"outlined"})," "]})}),e.jsxs(Ie,{children:[e.jsx(G,{sx:{textTransform:"none"},variant:"outlined",onClick:f,children:"Cancel"}),e.jsx(G,{onClick:z,type:"submit",color:"success",variant:"contained",sx:{textTransform:"none"},children:"Update"})]})]}),e.jsx($e,{open:a,autoHideDuration:1500,onClose:C,children:e.jsx(ye,{onClose:C,severity:"success",variant:"filled",sx:{width:"100%"},children:"Success"})})]})]})]})}function ma(n,s="TZS",a="en-US"){const l=typeof n=="string"?parseFloat(n):n;return isNaN(l)?"Invalid Amount":l.toLocaleString(a,{style:"currency",currency:s})}function $i(){const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState(!1),[o,r]=t.useState(!0),[S,i]=t.useState(""),[x,u]=t.useState(!0),[h,v]=t.useState([]),[D,c]=t.useState(),[Q,Y]=t.useState(!1),[L,J]=t.useState(0),[_,P]=t.useState(""),[U,Z]=t.useState(""),[B,K]=t.useState(""),[M,w]=t.useState(""),[j,m]=t.useState(""),[C,f]=t.useState(""),[T,N]=t.useState(""),[z,ee]=t.useState(""),[se,H]=t.useState(null),[E,I]=t.useState("");Nt().tz("Africa/Nairobi").format("YYYY-MM-DDTHH:mm:ss");const F=(A,O)=>{O!=="clickaway"&&l(!1)};t.useCallback((A,O)=>async()=>{c(A),i(O),r(!0),H(null),u(!1);try{const te=await fetch(`${n}/bills/invoicecount/${A}?flag=Paid`,{method:"PUT"});if(!te.ok){const pe=await te.json();console.error("API Error:",pe);return}window.open(`${n}/invoice/${A}`,"_blank"),l(!0)}catch(te){console.error("Fetch Error:",te)}finally{u(!0),r(!1)}},[]),t.useCallback(A=>()=>{confirm("Are you sure you want to delete this Condition ?")&&fetch(`${n}/bills/${A}`,{method:"DELETE"}).then(O=>{O.ok?v(te=>te.filter(pe=>pe.id!==A)):console.error(`Failed to delete case with ID: ${A}`)}).catch(O=>{console.error(`Error deleting case with ID: ${A}`,O)})},[]),t.useEffect(()=>{var A;x&&(r(!0),fetch(`${n}/bills/paid-bills/${(A=s==null?void 0:s.user)==null?void 0:A.entity_name}`,{method:"GET"}).then(O=>O.status===200?O.json():null).then(O=>{O!==null&&v(O),r(!1),u(!1)}))},[x]);const k=[{field:"docnumber",headerName:"Bill No.",width:150},{field:"doctype",headerName:"Description",width:130},{field:"client",headerName:"Patient Name",width:130},{field:"billamount",headerName:"Bill Amount",type:"number",valueFormatter:A=>typeof A=="string"||typeof A=="number"?ma(A):typeof A,width:130},{field:"flag",headerName:"Status",width:70},{field:"bill_date",headerName:"Bill Date",width:170},{field:"actions",type:"actions",headerName:"Actions",width:90,getActions:A=>[e.jsx(ge,{icon:e.jsx(_n,{sx:{color:"green"}}),label:"View Receipt",onClick:()=>{window.open(`${n}/invoice/${A.row.caseId}`,"_blank")},showInMenu:!0},"edit")]}],g=h,$=t.useMemo(()=>{if(!E)return g;const A=E.toLowerCase();return g.filter(O=>Object.values(O).some(te=>te!=null&&te.toString().toLowerCase().includes(A)))},[g,E]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10},children:e.jsx(R,{label:"Search",value:E,onChange:A=>I(A.target.value),placeholder:"Search...",style:{width:300},size:"small"})}),e.jsxs("div",{style:{alignContent:"center",height:"auto",width:"100%"},children:[o?e.jsx("p",{children:"Loading..."}):e.jsx(we,{rows:$,columns:k,pagination:!0}),e.jsx("div",{children:e.jsx($e,{open:a,autoHideDuration:1500,onClose:F,children:e.jsx(ye,{onClose:F,severity:"success",variant:"filled",sx:{width:"100%"},children:"Success"})})})]})]})}const Di=(n,s)=>new Promise((a,l)=>{fetch(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({medication:JSON.stringify(n)})}).then(o=>o.ok?o.json():o.json().then(r=>{throw new Error(r.message||`HTTP error! status: ${o.status}`)})).then(o=>{console.log("API Response:",o),a({success:!0,message:"Medications saved successfully!"})}).catch(o=>{console.error("API Error:",o),l({success:!1,message:o.message||"Failed to save medications."})})}),Pi=it().shape({selectedMedications:mn().of(it().shape({id:pn().required(),name:dt().required(),dosage:dt().required(),frequency:dt().required(),duration:dt().required(),remarks:dt().required(),price:dt().required()})).min(1,"At least one medication must be selected").required("Medications are required").test("unique-medications","Each medication can only be selected once",n=>{if(!n)return!0;const s=new Set;for(const a of n){if(s.has(a.id))return!1;s.add(a.id)}return!0})}),Ai={hidden:{opacity:0,scale:.8},visible:{opacity:1,scale:1,transition:{duration:.3,ease:"easeInOut"}},exit:{opacity:0,scale:.8,transition:{duration:.2}}},Ii=n=>{const{session:s}=he(),a="https://dental-clinic-latest.onrender.com",[l,o]=t.useState(n.open),[r,S]=t.useState([]),[i,x]=t.useState(!0),[u,h]=t.useState(!1),[v,D]=t.useState(null),c=$t();t.useEffect(()=>{(async()=>{try{const C=`${a}/medications`,f=await fetch(C);if(!f.ok)throw new Error(`HTTP error! Status: ${f.status}`);const T=await f.json();S(T)}catch(C){D(C.message)}finally{x(!1)}})()},[a]);const{control:Q,handleSubmit:Y,formState:{errors:L,isSubmitting:J},watch:_,setValue:P,clearErrors:U,setError:Z}=gn({resolver:yn(Pi),defaultValues:{selectedMedications:[]}}),B=_("selectedMedications"),K=t.useCallback(m=>{m?P("selectedMedications",r):P("selectedMedications",[]),h(m),U("selectedMedications"),D(null)},[r,P,U]);t.useEffect(()=>{B&&r.length>0?h(B.length===r.length):h(!1)},[B,r.length]);const M=async m=>{var C;x(!0),D(null);try{const f=await Di(m.selectedMedications,`${a}/clinics/name/${(C=s==null?void 0:s.user)==null?void 0:C.entity_name}`);f.success?(console.log(f.message),o(!1),n.onClose()):D(f.message||"Failed to save medications.")}catch(f){const T=f.message||"An unexpected error occurred. Please try again.";D(T),console.error("Error sending data:",f)}finally{x(!1)}},w=(m,C)=>{C==="backdropClick"||C==="escapeKeyDown"||(o(!1),n.onClose(),D(null))},j=m=>{o(!1),n.onClose(),D(null)};return t.useEffect(()=>{o(n.open)},[n.open]),e.jsxs(Ce,{open:l,onClose:w,fullWidth:!0,maxWidth:"md",disableEscapeKeyDown:!0,sx:{"& .MuiDialog-paper":{backgroundColor:c.palette.background.paper,borderRadius:c.shape.borderRadius,boxShadow:c.shadows[24],overflow:"hidden"}},children:[e.jsx(Ne,{sx:{padding:c.spacing(3),backgroundColor:c.palette.primary.main,color:c.palette.primary.contrastText,fontWeight:c.typography.fontWeightBold,fontSize:c.typography.h6.fontSize,borderBottom:`1px solid ${c.palette.divider}`},children:"Select Medications"}),e.jsx(Bt,{children:e.jsx(Ut.div,{variants:Ai,initial:"hidden",animate:"visible",exit:"exit",style:{flex:"1 1 auto",display:"flex",flexDirection:"column"},children:e.jsx(ve,{sx:{padding:c.spacing(3),overflowY:"auto",flexGrow:1,maxHeight:"400px"},children:i?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:e.jsx(ze,{})}):e.jsxs("form",{onSubmit:Y(M),style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx(Xe,{control:e.jsx(st,{checked:u,onChange:m=>K(m.target.checked),icon:e.jsx(ct,{fontSize:"small"}),checkedIcon:e.jsx(lt,{fontSize:"small"}),color:"primary"}),label:"Select All",sx:{marginBottom:c.spacing(2),"& .MuiTypography-root":{fontWeight:c.typography.fontWeightMedium,fontSize:c.typography.body1.fontSize}}}),e.jsx(xn,{name:"selectedMedications",control:Q,render:({field:{onChange:m,value:C}})=>{var f;return e.jsxs(e.Fragment,{children:[e.jsx(Re,{multiple:!0,options:r,getOptionLabel:T=>T.name,renderOption:(T,N,{selected:z})=>t.createElement("li",{...T,key:N.id},e.jsx(st,{checked:z,icon:e.jsx(ct,{fontSize:"small"}),checkedIcon:e.jsx(lt,{fontSize:"small"}),style:{marginRight:8},color:"primary"}),N.name," - ",N.dosage),value:C,onChange:(T,N)=>{const z=N?N.filter((ee,se,H)=>H.findIndex(E=>E.id===ee.id)===se):[];N&&z.length!==N.length?(Z("selectedMedications",{type:"manual",message:"Duplicate medications selected."},{shouldFocus:!1}),D("Duplicate medications selected.")):(m(z),U("selectedMedications"),D(null))},renderInput:T=>{var N,z;return e.jsx(R,{...T,label:"Search Medications",placeholder:"Type to search...",error:!!L.selectedMedications,helperText:((z=(N=L.selectedMedications)==null?void 0:N.message)==null?void 0:z.toString())||v||void 0,sx:{marginBottom:c.spacing(2),width:"70%"}})},sx:{flexGrow:1},disableCloseOnSelect:!0,filterOptions:(T,{inputValue:N})=>T.filter(ee=>ee.name.toLowerCase().includes(N.toLowerCase()))}),L.selectedMedications&&!v&&e.jsx(jn,{error:!0,children:(f=L.selectedMedications.message)==null?void 0:f.toString()})]})}}),v&&e.jsx(ye,{severity:"error",sx:{marginBottom:c.spacing(2)},children:v}),e.jsxs(Ie,{sx:{padding:c.spacing(2),marginTop:c.spacing(2),display:"flex",justifyContent:"flex-end",borderTop:`1px solid ${c.palette.divider}`},children:[e.jsx(G,{onClick:j,color:"inherit",disabled:J,sx:{marginRight:c.spacing(1),"&:hover":{backgroundColor:c.palette.action.hover}},children:"Cancel"}),e.jsx(G,{type:"submit",variant:"contained",color:"primary",disabled:J||i,sx:{"&:hover":{backgroundColor:c.palette.primary.dark}},children:J||i?e.jsxs(e.Fragment,{children:[e.jsx(ze,{size:20,style:{marginRight:8,color:"white"}}),"Saving..."]}):"Save"})]})]})})})})]})},Mi=(n,s)=>new Promise((a,l)=>{fetch(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({treatments:JSON.stringify(n)})}).then(o=>o.ok?o.json():o.json().then(r=>{throw new Error(r.message||`HTTP error! status: ${o.status}`)})).then(o=>{console.log("API Response:",o),a({success:!0,message:"Treatments saved successfully!"})}).catch(o=>{console.error("API Error:",o),l({success:!1,message:o.message||"Failed to save Treatments."})})}),Fi=it().shape({selectedMedications:mn().of(it().shape({id:pn().required(),name:dt().required()})).min(1,"At least one Treatments must be selected").required("Treatments are required").test("unique-medications","Each Treatments can only be selected once",n=>{if(!n)return!0;const s=new Set;for(const a of n){if(s.has(a.id))return!1;s.add(a.id)}return!0})}),Oi={hidden:{opacity:0,scale:.8},visible:{opacity:1,scale:1,transition:{duration:.3,ease:"easeInOut"}},exit:{opacity:0,scale:.8,transition:{duration:.2}}},_i=n=>{const{session:s}=he(),a="https://dental-clinic-latest.onrender.com",[l,o]=t.useState(n.open),[r,S]=t.useState([]),[i,x]=t.useState(!0),[u,h]=t.useState(!1),[v,D]=t.useState(null),c=$t();t.useEffect(()=>{(async()=>{try{const C=`${a}/products`,f=await fetch(C);if(!f.ok)throw new Error(`HTTP error! Status: ${f.status}`);const T=await f.json();S(T)}catch(C){D(C.message)}finally{x(!1)}})()},[a]);const{control:Q,handleSubmit:Y,formState:{errors:L,isSubmitting:J},watch:_,setValue:P,clearErrors:U,setError:Z}=gn({resolver:yn(Fi),defaultValues:{selectedMedications:[]}}),B=_("selectedMedications"),K=t.useCallback(m=>{m?P("selectedMedications",r):P("selectedMedications",[]),h(m),U("selectedMedications"),D(null)},[r,P,U]);t.useEffect(()=>{B&&r.length>0?h(B.length===r.length):h(!1)},[B,r.length]);const M=async m=>{var C;x(!0),D(null);try{const f=await Mi(m.selectedMedications,`${a}/clinics/name/${(C=s==null?void 0:s.user)==null?void 0:C.entity_name}`);f.success?(console.log(f.message),o(!1),n.onClose()):D(f.message||"Failed to save Treatments.")}catch(f){const T=f.message||"An unexpected error occurred. Please try again.";D(T),console.error("Error sending data:",f)}finally{x(!1)}},w=(m,C)=>{C==="backdropClick"||C==="escapeKeyDown"||(o(!1),n.onClose(),D(null))},j=m=>{o(!1),n.onClose(),D(null)};return t.useEffect(()=>{o(n.open)},[n.open]),e.jsxs(Ce,{open:l,onClose:w,fullWidth:!0,maxWidth:"md",disableEscapeKeyDown:!0,sx:{"& .MuiDialog-paper":{backgroundColor:c.palette.background.paper,borderRadius:c.shape.borderRadius,boxShadow:c.shadows[24],overflow:"hidden"}},children:[e.jsx(Ne,{sx:{padding:c.spacing(3),backgroundColor:c.palette.primary.main,color:c.palette.primary.contrastText,fontWeight:c.typography.fontWeightBold,fontSize:c.typography.h6.fontSize,borderBottom:`1px solid ${c.palette.divider}`},children:"Select Common Treatments"}),e.jsx(Bt,{children:e.jsx(Ut.div,{variants:Oi,initial:"hidden",animate:"visible",exit:"exit",style:{flex:"1 1 auto",display:"flex",flexDirection:"column"},children:e.jsx(ve,{sx:{padding:c.spacing(3),overflowY:"auto",flexGrow:1,maxHeight:"400px"},children:i?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:e.jsx(ze,{})}):e.jsxs("form",{onSubmit:Y(M),style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx(Xe,{control:e.jsx(st,{checked:u,onChange:m=>K(m.target.checked),icon:e.jsx(ct,{fontSize:"small"}),checkedIcon:e.jsx(lt,{fontSize:"small"}),color:"primary"}),label:"Select All",sx:{marginBottom:c.spacing(2),"& .MuiTypography-root":{fontWeight:c.typography.fontWeightMedium,fontSize:c.typography.body1.fontSize}}}),e.jsx(xn,{name:"selectedMedications",control:Q,render:({field:{onChange:m,value:C}})=>{var f;return e.jsxs(e.Fragment,{children:[e.jsx(Re,{multiple:!0,options:r,getOptionLabel:T=>T.name,renderOption:(T,N,{selected:z})=>t.createElement("li",{...T,key:N.id},e.jsx(st,{checked:z,icon:e.jsx(ct,{fontSize:"small"}),checkedIcon:e.jsx(lt,{fontSize:"small"}),style:{marginRight:8},color:"primary"}),N.name," - ",N.dosage),value:C,onChange:(T,N)=>{const z=N?N.filter((ee,se,H)=>H.findIndex(E=>E.id===ee.id)===se):[];N&&z.length!==N.length?(Z("selectedMedications",{type:"manual",message:"Duplicate Treatments selected."},{shouldFocus:!1}),D("Duplicate Treatments selected.")):(m(z),U("selectedMedications"),D(null))},renderInput:T=>{var N,z;return e.jsx(R,{...T,label:"Search Medications",placeholder:"Type to search...",error:!!L.selectedMedications,helperText:((z=(N=L.selectedMedications)==null?void 0:N.message)==null?void 0:z.toString())||v||void 0,sx:{marginBottom:c.spacing(2),width:"70%"}})},sx:{flexGrow:1},disableCloseOnSelect:!0,filterOptions:(T,{inputValue:N})=>T.filter(ee=>ee.name.toLowerCase().includes(N.toLowerCase()))}),L.selectedMedications&&!v&&e.jsx(jn,{error:!0,children:(f=L.selectedMedications.message)==null?void 0:f.toString()})]})}}),v&&e.jsx(ye,{severity:"error",sx:{marginBottom:c.spacing(2)},children:v}),e.jsxs(Ie,{sx:{padding:c.spacing(2),marginTop:c.spacing(2),display:"flex",justifyContent:"flex-end",borderTop:`1px solid ${c.palette.divider}`},children:[e.jsx(G,{onClick:j,color:"inherit",disabled:J,sx:{marginRight:c.spacing(1),"&:hover":{backgroundColor:c.palette.action.hover}},children:"Cancel"}),e.jsx(G,{type:"submit",variant:"contained",color:"primary",disabled:J||i,sx:{"&:hover":{backgroundColor:c.palette.primary.dark}},children:J||i?e.jsxs(e.Fragment,{children:[e.jsx(ze,{size:20,style:{marginRight:8,color:"white"}}),"Saving..."]}):"Save"})]})]})})})})]})},Ri=(n,s)=>new Promise((a,l)=>{fetch(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({diagnosis:JSON.stringify(n)})}).then(o=>o.ok?o.json():o.json().then(r=>{throw new Error(r.message||`HTTP error! status: ${o.status}`)})).then(o=>{console.log("API Response:",o),a({success:!0,message:"Diagnosis saved successfully!"})}).catch(o=>{console.error("API Error:",o),l({success:!1,message:o.message||"Failed to save diagnosis."})})}),Li=it().shape({selectedMedications:mn().of(it().shape({id:pn().required(),name:dt().required()})).min(1,"At least one diagnosis must be selected").required("Diagnosis are required").test("unique-medications","Each diagnosis can only be selected once",n=>{if(!n)return!0;const s=new Set;for(const a of n){if(s.has(a.id))return!1;s.add(a.id)}return!0})}),zi={hidden:{opacity:0,scale:.8},visible:{opacity:1,scale:1,transition:{duration:.3,ease:"easeInOut"}},exit:{opacity:0,scale:.8,transition:{duration:.2}}},Bi=n=>{const{session:s}=he(),a="https://dental-clinic-latest.onrender.com",[l,o]=t.useState(n.open),[r,S]=t.useState([]),[i,x]=t.useState(!0),[u,h]=t.useState(!1),[v,D]=t.useState(null),c=$t();t.useEffect(()=>{(async()=>{try{const C=`${a}/diagnosis`,f=await fetch(C);if(!f.ok)throw new Error(`HTTP error! Status: ${f.status}`);const T=await f.json();S(T)}catch(C){D(C.message)}finally{x(!1)}})()},[a]);const{control:Q,handleSubmit:Y,formState:{errors:L,isSubmitting:J},watch:_,setValue:P,clearErrors:U,setError:Z}=gn({resolver:yn(Li),defaultValues:{selectedMedications:[]}}),B=_("selectedMedications"),K=t.useCallback(m=>{m?P("selectedMedications",r):P("selectedMedications",[]),h(m),U("selectedMedications"),D(null)},[r,P,U]);t.useEffect(()=>{B&&r.length>0?h(B.length===r.length):h(!1)},[B,r.length]);const M=async m=>{var C;x(!0),D(null);try{const f=await Ri(m.selectedMedications,`${a}/clinics/name/${(C=s==null?void 0:s.user)==null?void 0:C.entity_name}`);f.success?(console.log(f.message),o(!1),n.onClose()):D(f.message||"Failed to save medications.")}catch(f){const T=f.message||"An unexpected error occurred. Please try again.";D(T),console.error("Error sending data:",f)}finally{x(!1)}},w=(m,C)=>{C==="backdropClick"||C==="escapeKeyDown"||(o(!1),n.onClose(),D(null))},j=m=>{o(!1),n.onClose(),D(null)};return t.useEffect(()=>{o(n.open)},[n.open]),e.jsxs(Ce,{open:l,onClose:w,fullWidth:!0,maxWidth:"md",disableEscapeKeyDown:!0,sx:{"& .MuiDialog-paper":{backgroundColor:c.palette.background.paper,borderRadius:c.shape.borderRadius,boxShadow:c.shadows[24],overflow:"hidden"}},children:[e.jsx(Ne,{sx:{padding:c.spacing(3),backgroundColor:c.palette.primary.main,color:c.palette.primary.contrastText,fontWeight:c.typography.fontWeightBold,fontSize:c.typography.h6.fontSize,borderBottom:`1px solid ${c.palette.divider}`},children:"Select Common Diagnosis"}),e.jsx(Bt,{children:e.jsx(Ut.div,{variants:zi,initial:"hidden",animate:"visible",exit:"exit",style:{flex:"1 1 auto",display:"flex",flexDirection:"column"},children:e.jsx(ve,{sx:{padding:c.spacing(3),overflowY:"auto",flexGrow:1,maxHeight:"400px"},children:i?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:e.jsx(ze,{})}):e.jsxs("form",{onSubmit:Y(M),style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx(Xe,{control:e.jsx(st,{checked:u,onChange:m=>K(m.target.checked),icon:e.jsx(ct,{fontSize:"small"}),checkedIcon:e.jsx(lt,{fontSize:"small"}),color:"primary"}),label:"Select All",sx:{marginBottom:c.spacing(2),"& .MuiTypography-root":{fontWeight:c.typography.fontWeightMedium,fontSize:c.typography.body1.fontSize}}}),e.jsx(xn,{name:"selectedMedications",control:Q,render:({field:{onChange:m,value:C}})=>{var f;return e.jsxs(e.Fragment,{children:[e.jsx(Re,{multiple:!0,options:r,getOptionLabel:T=>T.name,renderOption:(T,N,{selected:z})=>t.createElement("li",{...T,key:N.id},e.jsx(st,{checked:z,icon:e.jsx(ct,{fontSize:"small"}),checkedIcon:e.jsx(lt,{fontSize:"small"}),style:{marginRight:8},color:"primary"}),N.name," - ",N.dosage),value:C,onChange:(T,N)=>{const z=N?N.filter((ee,se,H)=>H.findIndex(E=>E.id===ee.id)===se):[];N&&z.length!==N.length?(Z("selectedMedications",{type:"manual",message:"Duplicate medications selected."},{shouldFocus:!1}),D("Duplicate medications selected.")):(m(z),U("selectedMedications"),D(null))},renderInput:T=>{var N,z;return e.jsx(R,{...T,label:"Search Medications",placeholder:"Type to search...",error:!!L.selectedMedications,helperText:((z=(N=L.selectedMedications)==null?void 0:N.message)==null?void 0:z.toString())||v||void 0,sx:{marginBottom:c.spacing(2),width:"70%"}})},sx:{flexGrow:1},disableCloseOnSelect:!0,filterOptions:(T,{inputValue:N})=>T.filter(ee=>ee.name.toLowerCase().includes(N.toLowerCase()))}),L.selectedMedications&&!v&&e.jsx(jn,{error:!0,children:(f=L.selectedMedications.message)==null?void 0:f.toString()})]})}}),v&&e.jsx(ye,{severity:"error",sx:{marginBottom:c.spacing(2)},children:v}),e.jsxs(Ie,{sx:{padding:c.spacing(2),marginTop:c.spacing(2),display:"flex",justifyContent:"flex-end",borderTop:`1px solid ${c.palette.divider}`},children:[e.jsx(G,{onClick:j,color:"inherit",disabled:J,sx:{marginRight:c.spacing(1),"&:hover":{backgroundColor:c.palette.action.hover}},children:"Cancel"}),e.jsx(G,{type:"submit",variant:"contained",color:"primary",disabled:J||i,sx:{"&:hover":{backgroundColor:c.palette.primary.dark}},children:J||i?e.jsxs(e.Fragment,{children:[e.jsx(ze,{size:20,style:{marginRight:8,color:"white"}}),"Saving..."]}):"Save"})]})]})})})})]})},Ui=(n,s)=>new Promise((a,l)=>{fetch(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({examination:JSON.stringify(n)})}).then(o=>o.ok?o.json():o.json().then(r=>{throw new Error(r.message||`HTTP error! status: ${o.status}`)})).then(o=>{console.log("API Response:",o),a({success:!0,message:"Examination saved successfully!"})}).catch(o=>{console.error("API Error:",o),l({success:!1,message:o.message||"Failed to save Examinations."})})}),Ji=it().shape({selectedMedications:mn().of(it().shape({id:pn().required(),name:dt().required()})).min(1,"At least one examination must be selected").required("Examinations are required").test("unique-medications","Each examination can only be selected once",n=>{if(!n)return!0;const s=new Set;for(const a of n){if(s.has(a.id))return!1;s.add(a.id)}return!0})}),Hi={hidden:{opacity:0,scale:.8},visible:{opacity:1,scale:1,transition:{duration:.3,ease:"easeInOut"}},exit:{opacity:0,scale:.8,transition:{duration:.2}}},Wi=n=>{const{session:s}=he(),a="https://dental-clinic-latest.onrender.com",[l,o]=t.useState(n.open),[r,S]=t.useState([]),[i,x]=t.useState(!0),[u,h]=t.useState(!1),[v,D]=t.useState(null),c=$t();t.useEffect(()=>{(async()=>{try{const C=`${a}/examination`,f=await fetch(C);if(!f.ok)throw new Error(`HTTP error! Status: ${f.status}`);const T=await f.json();S(T)}catch(C){D(C.message)}finally{x(!1)}})()},[a]);const{control:Q,handleSubmit:Y,formState:{errors:L,isSubmitting:J},watch:_,setValue:P,clearErrors:U,setError:Z}=gn({resolver:yn(Ji),defaultValues:{selectedMedications:[]}}),B=_("selectedMedications"),K=t.useCallback(m=>{m?P("selectedMedications",r):P("selectedMedications",[]),h(m),U("selectedMedications"),D(null)},[r,P,U]);t.useEffect(()=>{B&&r.length>0?h(B.length===r.length):h(!1)},[B,r.length]);const M=async m=>{var C;x(!0),D(null);try{const f=await Ui(m.selectedMedications,`${a}/clinics/name/${(C=s==null?void 0:s.user)==null?void 0:C.entity_name}`);f.success?(console.log(f.message),o(!1),n.onClose()):D(f.message||"Failed to save examinations.")}catch(f){const T=f.message||"An unexpected error occurred. Please try again.";D(T),console.error("Error sending data:",f)}finally{x(!1)}},w=(m,C)=>{C==="backdropClick"||C==="escapeKeyDown"||(o(!1),n.onClose(),D(null))},j=m=>{o(!1),n.onClose(),D(null)};return t.useEffect(()=>{o(n.open)},[n.open]),e.jsxs(Ce,{open:l,onClose:w,fullWidth:!0,maxWidth:"md",disableEscapeKeyDown:!0,sx:{"& .MuiDialog-paper":{backgroundColor:c.palette.background.paper,borderRadius:c.shape.borderRadius,boxShadow:c.shadows[24],overflow:"hidden"}},children:[e.jsx(Ne,{sx:{padding:c.spacing(3),backgroundColor:c.palette.primary.main,color:c.palette.primary.contrastText,fontWeight:c.typography.fontWeightBold,fontSize:c.typography.h6.fontSize,borderBottom:`1px solid ${c.palette.divider}`},children:"Select Common Examinations"}),e.jsx(Bt,{children:e.jsx(Ut.div,{variants:Hi,initial:"hidden",animate:"visible",exit:"exit",style:{flex:"1 1 auto",display:"flex",flexDirection:"column"},children:e.jsx(ve,{sx:{padding:c.spacing(3),overflowY:"auto",flexGrow:1,maxHeight:"400px"},children:i?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:e.jsx(ze,{})}):e.jsxs("form",{onSubmit:Y(M),style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx(Xe,{control:e.jsx(st,{checked:u,onChange:m=>K(m.target.checked),icon:e.jsx(ct,{fontSize:"small"}),checkedIcon:e.jsx(lt,{fontSize:"small"}),color:"primary"}),label:"Select All",sx:{marginBottom:c.spacing(2),"& .MuiTypography-root":{fontWeight:c.typography.fontWeightMedium,fontSize:c.typography.body1.fontSize}}}),e.jsx(xn,{name:"selectedMedications",control:Q,render:({field:{onChange:m,value:C}})=>{var f;return e.jsxs(e.Fragment,{children:[e.jsx(Re,{multiple:!0,options:r,getOptionLabel:T=>T.name,renderOption:(T,N,{selected:z})=>t.createElement("li",{...T,key:N.id},e.jsx(st,{checked:z,icon:e.jsx(ct,{fontSize:"small"}),checkedIcon:e.jsx(lt,{fontSize:"small"}),style:{marginRight:8},color:"primary"}),N.name," - ",N.dosage),value:C,onChange:(T,N)=>{const z=N?N.filter((ee,se,H)=>H.findIndex(E=>E.id===ee.id)===se):[];N&&z.length!==N.length?(Z("selectedMedications",{type:"manual",message:"Duplicate medications selected."},{shouldFocus:!1}),D("Duplicate medications selected.")):(m(z),U("selectedMedications"),D(null))},renderInput:T=>{var N,z;return e.jsx(R,{...T,label:"Search Medications",placeholder:"Type to search...",error:!!L.selectedMedications,helperText:((z=(N=L.selectedMedications)==null?void 0:N.message)==null?void 0:z.toString())||v||void 0,sx:{marginBottom:c.spacing(2),width:"70%"}})},sx:{flexGrow:1},disableCloseOnSelect:!0,filterOptions:(T,{inputValue:N})=>T.filter(ee=>ee.name.toLowerCase().includes(N.toLowerCase()))}),L.selectedMedications&&!v&&e.jsx(jn,{error:!0,children:(f=L.selectedMedications.message)==null?void 0:f.toString()})]})}}),v&&e.jsx(ye,{severity:"error",sx:{marginBottom:c.spacing(2)},children:v}),e.jsxs(Ie,{sx:{padding:c.spacing(2),marginTop:c.spacing(2),display:"flex",justifyContent:"flex-end",borderTop:`1px solid ${c.palette.divider}`},children:[e.jsx(G,{onClick:j,color:"inherit",disabled:J,sx:{marginRight:c.spacing(1),"&:hover":{backgroundColor:c.palette.action.hover}},children:"Cancel"}),e.jsx(G,{type:"submit",variant:"contained",color:"primary",disabled:J||i,sx:{"&:hover":{backgroundColor:c.palette.primary.dark}},children:J||i?e.jsxs(e.Fragment,{children:[e.jsx(ze,{size:20,style:{marginRight:8,color:"white"}}),"Saving..."]}):"Save"})]})]})})})})]})},Yi=(n,s)=>new Promise((a,l)=>{fetch(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({surface:JSON.stringify(n)})}).then(o=>o.ok?o.json():o.json().then(r=>{throw new Error(r.message||`HTTP error! status: ${o.status}`)})).then(o=>{console.log("API Response:",o),a({success:!0,message:"Medications saved successfully!"})}).catch(o=>{console.error("API Error:",o),l({success:!1,message:o.message||"Failed to save medications."})})}),Gi=it().shape({selectedMedications:mn().of(it().shape({id:pn().required(),name:dt().required()})).min(1,"At least one surface must be selected").required("surface are required").test("unique-medications","Each surface can only be selected once",n=>{if(!n)return!0;const s=new Set;for(const a of n){if(s.has(a.id))return!1;s.add(a.id)}return!0})}),qi={hidden:{opacity:0,scale:.8},visible:{opacity:1,scale:1,transition:{duration:.3,ease:"easeInOut"}},exit:{opacity:0,scale:.8,transition:{duration:.2}}},Vi=n=>{const{session:s}=he(),a="https://dental-clinic-latest.onrender.com",[l,o]=t.useState(n.open),[r,S]=t.useState([]),[i,x]=t.useState(!0),[u,h]=t.useState(!1),[v,D]=t.useState(null),c=$t();t.useEffect(()=>{(async()=>{try{const C=`${a}/surfaces`,f=await fetch(C);if(!f.ok)throw new Error(`HTTP error! Status: ${f.status}`);const T=await f.json();S(T)}catch(C){D(C.message)}finally{x(!1)}})()},[a]);const{control:Q,handleSubmit:Y,formState:{errors:L,isSubmitting:J},watch:_,setValue:P,clearErrors:U,setError:Z}=gn({resolver:yn(Gi),defaultValues:{selectedMedications:[]}}),B=_("selectedMedications"),K=t.useCallback(m=>{m?P("selectedMedications",r):P("selectedMedications",[]),h(m),U("selectedMedications"),D(null)},[r,P,U]);t.useEffect(()=>{B&&r.length>0?h(B.length===r.length):h(!1)},[B,r.length]);const M=async m=>{var C;x(!0),D(null);try{const f=await Yi(m.selectedMedications,`${a}/clinics/name/${(C=s==null?void 0:s.user)==null?void 0:C.entity_name}`);f.success?(console.log(f.message),o(!1),n.onClose()):D(f.message||"Failed to save surfaces.")}catch(f){const T=f.message||"An unexpected error occurred. Please try again.";D(T),console.error("Error sending data:",f)}finally{x(!1)}},w=(m,C)=>{C==="backdropClick"||C==="escapeKeyDown"||(o(!1),n.onClose(),D(null))},j=m=>{o(!1),n.onClose(),D(null)};return t.useEffect(()=>{o(n.open)},[n.open]),e.jsxs(Ce,{open:l,onClose:w,fullWidth:!0,maxWidth:"md",disableEscapeKeyDown:!0,sx:{"& .MuiDialog-paper":{backgroundColor:c.palette.background.paper,borderRadius:c.shape.borderRadius,boxShadow:c.shadows[24],overflow:"hidden"}},children:[e.jsx(Ne,{sx:{padding:c.spacing(3),backgroundColor:c.palette.primary.main,color:c.palette.primary.contrastText,fontWeight:c.typography.fontWeightBold,fontSize:c.typography.h6.fontSize,borderBottom:`1px solid ${c.palette.divider}`},children:"Select Common Surface"}),e.jsx(Bt,{children:e.jsx(Ut.div,{variants:qi,initial:"hidden",animate:"visible",exit:"exit",style:{flex:"1 1 auto",display:"flex",flexDirection:"column"},children:e.jsx(ve,{sx:{padding:c.spacing(3),overflowY:"auto",flexGrow:1,maxHeight:"400px"},children:i?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:e.jsx(ze,{})}):e.jsxs("form",{onSubmit:Y(M),style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx(Xe,{control:e.jsx(st,{checked:u,onChange:m=>K(m.target.checked),icon:e.jsx(ct,{fontSize:"small"}),checkedIcon:e.jsx(lt,{fontSize:"small"}),color:"primary"}),label:"Select All",sx:{marginBottom:c.spacing(2),"& .MuiTypography-root":{fontWeight:c.typography.fontWeightMedium,fontSize:c.typography.body1.fontSize}}}),e.jsx(xn,{name:"selectedMedications",control:Q,render:({field:{onChange:m,value:C}})=>{var f;return e.jsxs(e.Fragment,{children:[e.jsx(Re,{multiple:!0,options:r,getOptionLabel:T=>T.name,renderOption:(T,N,{selected:z})=>t.createElement("li",{...T,key:N.id},e.jsx(st,{checked:z,icon:e.jsx(ct,{fontSize:"small"}),checkedIcon:e.jsx(lt,{fontSize:"small"}),style:{marginRight:8},color:"primary"}),N.name," - ",N.dosage),value:C,onChange:(T,N)=>{const z=N?N.filter((ee,se,H)=>H.findIndex(E=>E.id===ee.id)===se):[];N&&z.length!==N.length?(Z("selectedMedications",{type:"manual",message:"Duplicate surfaces selected."},{shouldFocus:!1}),D("Duplicate surfaces selected.")):(m(z),U("selectedMedications"),D(null))},renderInput:T=>{var N,z;return e.jsx(R,{...T,label:"Search Medications",placeholder:"Type to search...",error:!!L.selectedMedications,helperText:((z=(N=L.selectedMedications)==null?void 0:N.message)==null?void 0:z.toString())||v||void 0,sx:{marginBottom:c.spacing(2),width:"70%"}})},sx:{flexGrow:1},disableCloseOnSelect:!0,filterOptions:(T,{inputValue:N})=>T.filter(ee=>ee.name.toLowerCase().includes(N.toLowerCase()))}),L.selectedMedications&&!v&&e.jsx(jn,{error:!0,children:(f=L.selectedMedications.message)==null?void 0:f.toString()})]})}}),v&&e.jsx(ye,{severity:"error",sx:{marginBottom:c.spacing(2)},children:v}),e.jsxs(Ie,{sx:{padding:c.spacing(2),marginTop:c.spacing(2),display:"flex",justifyContent:"flex-end",borderTop:`1px solid ${c.palette.divider}`},children:[e.jsx(G,{onClick:j,color:"inherit",disabled:J,sx:{marginRight:c.spacing(1),"&:hover":{backgroundColor:c.palette.action.hover}},children:"Cancel"}),e.jsx(G,{type:"submit",variant:"contained",color:"primary",disabled:J||i,sx:{"&:hover":{backgroundColor:c.palette.primary.dark}},children:J||i?e.jsxs(e.Fragment,{children:[e.jsx(ze,{size:20,style:{marginRight:8,color:"white"}}),"Saving..."]}):"Save"})]})]})})})})]})},Ki=(n,s)=>new Promise((a,l)=>{fetch(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({toothConditions:JSON.stringify(n)})}).then(o=>o.ok?o.json():o.json().then(r=>{throw new Error(r.message||`HTTP error! status: ${o.status}`)})).then(o=>{console.log("API Response:",o),a({success:!0,message:"ToothCondition saved successfully!"})}).catch(o=>{console.error("API Error:",o),l({success:!1,message:o.message||"Failed to save ToothCondition."})})}),Qi=it().shape({selectedMedications:mn().of(it().shape({id:pn().required(),name:dt().required()})).min(1,"At least one ToothCondition must be selected").required("ToothCondition are required").test("unique-medications","Each ToothCondition can only be selected once",n=>{if(!n)return!0;const s=new Set;for(const a of n){if(s.has(a.id))return!1;s.add(a.id)}return!0})}),Zi={hidden:{opacity:0,scale:.8},visible:{opacity:1,scale:1,transition:{duration:.3,ease:"easeInOut"}},exit:{opacity:0,scale:.8,transition:{duration:.2}}},Xi=n=>{const{session:s}=he(),a="https://dental-clinic-latest.onrender.com",[l,o]=t.useState(n.open),[r,S]=t.useState([]),[i,x]=t.useState(!0),[u,h]=t.useState(!1),[v,D]=t.useState(null),c=$t();t.useEffect(()=>{(async()=>{try{const C=`${a}/tooth-condition`,f=await fetch(C);if(!f.ok)throw new Error(`HTTP error! Status: ${f.status}`);const T=await f.json();S(T)}catch(C){D(C.message)}finally{x(!1)}})()},[a]);const{control:Q,handleSubmit:Y,formState:{errors:L,isSubmitting:J},watch:_,setValue:P,clearErrors:U,setError:Z}=gn({resolver:yn(Qi),defaultValues:{selectedMedications:[]}}),B=_("selectedMedications"),K=t.useCallback(m=>{m?P("selectedMedications",r):P("selectedMedications",[]),h(m),U("selectedMedications"),D(null)},[r,P,U]);t.useEffect(()=>{B&&r.length>0?h(B.length===r.length):h(!1)},[B,r.length]);const M=async m=>{var C;x(!0),D(null);try{const f=await Ki(m.selectedMedications,`${a}/clinics/name/${(C=s==null?void 0:s.user)==null?void 0:C.entity_name}`);f.success?(console.log(f.message),o(!1),n.onClose()):D(f.message||"Failed to save ToothCondition.")}catch(f){const T=f.message||"An unexpected error occurred. Please try again.";D(T),console.error("Error sending data:",f)}finally{x(!1)}},w=(m,C)=>{C==="backdropClick"||C==="escapeKeyDown"||(o(!1),n.onClose(),D(null))},j=m=>{o(!1),n.onClose(),D(null)};return t.useEffect(()=>{o(n.open)},[n.open]),e.jsxs(Ce,{open:l,onClose:w,fullWidth:!0,maxWidth:"md",disableEscapeKeyDown:!0,sx:{"& .MuiDialog-paper":{backgroundColor:c.palette.background.paper,borderRadius:c.shape.borderRadius,boxShadow:c.shadows[24],overflow:"hidden"}},children:[e.jsx(Ne,{sx:{padding:c.spacing(3),backgroundColor:c.palette.primary.main,color:c.palette.primary.contrastText,fontWeight:c.typography.fontWeightBold,fontSize:c.typography.h6.fontSize,borderBottom:`1px solid ${c.palette.divider}`},children:"Select Common Tooth Selection"}),e.jsx(Bt,{children:e.jsx(Ut.div,{variants:Zi,initial:"hidden",animate:"visible",exit:"exit",style:{flex:"1 1 auto",display:"flex",flexDirection:"column"},children:e.jsx(ve,{sx:{padding:c.spacing(3),overflowY:"auto",flexGrow:1,maxHeight:"400px"},children:i?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:e.jsx(ze,{})}):e.jsxs("form",{onSubmit:Y(M),style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx(Xe,{control:e.jsx(st,{checked:u,onChange:m=>K(m.target.checked),icon:e.jsx(ct,{fontSize:"small"}),checkedIcon:e.jsx(lt,{fontSize:"small"}),color:"primary"}),label:"Select All",sx:{marginBottom:c.spacing(2),"& .MuiTypography-root":{fontWeight:c.typography.fontWeightMedium,fontSize:c.typography.body1.fontSize}}}),e.jsx(xn,{name:"selectedMedications",control:Q,render:({field:{onChange:m,value:C}})=>{var f;return e.jsxs(e.Fragment,{children:[e.jsx(Re,{multiple:!0,options:r,getOptionLabel:T=>T.name,renderOption:(T,N,{selected:z})=>t.createElement("li",{...T,key:N.id},e.jsx(st,{checked:z,icon:e.jsx(ct,{fontSize:"small"}),checkedIcon:e.jsx(lt,{fontSize:"small"}),style:{marginRight:8},color:"primary"}),N.name," - ",N.dosage),value:C,onChange:(T,N)=>{const z=N?N.filter((ee,se,H)=>H.findIndex(E=>E.id===ee.id)===se):[];N&&z.length!==N.length?(Z("selectedMedications",{type:"manual",message:"Duplicate ToothCondition selected."},{shouldFocus:!1}),D("Duplicate ToothCondition selected.")):(m(z),U("selectedMedications"),D(null))},renderInput:T=>{var N,z;return e.jsx(R,{...T,label:"Search Medications",placeholder:"Type to search...",error:!!L.selectedMedications,helperText:((z=(N=L.selectedMedications)==null?void 0:N.message)==null?void 0:z.toString())||v||void 0,sx:{marginBottom:c.spacing(2),width:"70%"}})},sx:{flexGrow:1},disableCloseOnSelect:!0,filterOptions:(T,{inputValue:N})=>T.filter(ee=>ee.name.toLowerCase().includes(N.toLowerCase()))}),L.selectedMedications&&!v&&e.jsx(jn,{error:!0,children:(f=L.selectedMedications.message)==null?void 0:f.toString()})]})}}),v&&e.jsx(ye,{severity:"error",sx:{marginBottom:c.spacing(2)},children:v}),e.jsxs(Ie,{sx:{padding:c.spacing(2),marginTop:c.spacing(2),display:"flex",justifyContent:"flex-end",borderTop:`1px solid ${c.palette.divider}`},children:[e.jsx(G,{onClick:j,color:"inherit",disabled:J,sx:{marginRight:c.spacing(1),"&:hover":{backgroundColor:c.palette.action.hover}},children:"Cancel"}),e.jsx(G,{type:"submit",variant:"contained",color:"primary",disabled:J||i,sx:{"&:hover":{backgroundColor:c.palette.primary.dark}},children:J||i?e.jsxs(e.Fragment,{children:[e.jsx(ze,{size:20,style:{marginRight:8,color:"white"}}),"Saving..."]}):"Save"})]})]})})})})]})};function el(){const[n,s]=t.useState(!1),[a,l]=t.useState(!1),[o,r]=t.useState(!1),[S,i]=t.useState(!1),[x,u]=t.useState(!1),[h,v]=t.useState(!1),[D,c]=t.useState(!1);return e.jsxs(V,{children:[e.jsxs(Zr,{dense:!0,sx:{width:"100%",maxWidth:"100%",bgcolor:"background.paper"},children:[e.jsxs(en,{disablePadding:!0,children:[e.jsxs(tn,{onClick:()=>l(!0),children:[e.jsx(nn,{children:e.jsx(Rt,{alt:"Avatar n°1",src:"https://c.mamed.org/images/dentaltreatments.avif"})}),e.jsx(Ot,{id:"checkbox-list-secondary-label-0",primary:"Treatments",secondary:"Choose Common Products or Treatments here e.g .. Routine Cleanings, Fluoride Treatments, Fillings"})]}),e.jsx(G,{onClick:()=>l(!0),children:e.jsx(_t,{})})]},0),e.jsxs(en,{disablePadding:!0,children:[e.jsxs(tn,{onClick:()=>r(!0),children:[e.jsx(nn,{children:e.jsx(Rt,{alt:"Avatar n°2",src:"https://c.mamed.org/images/medication.avif"})}),e.jsx(Ot,{id:"checkbox-list-secondary-label-1",primary:"Medication",secondary:"Choose  Your Clinic Common Medication eg. Gydrocortisone"})]}),e.jsx(G,{onClick:()=>r(!0),children:e.jsx(_t,{})})]},1),e.jsxs(en,{disablePadding:!0,children:[e.jsxs(tn,{onClick:()=>i(!0),children:[e.jsx(nn,{children:e.jsx(Rt,{alt:"Avatar n°3",src:"https://c.mamed.org/images/diagnosis.avif"})}),e.jsx(Ot,{id:"checkbox-list-secondary-label-2",primary:"Diagnosis",secondary:` Choose Dialog e.g ..  B00.2-HERPESVIRAL
GINGIVOSTOMATITIS AND
PHARYNGOTONSILLI
`})]}),e.jsx(G,{onClick:()=>i(!0),children:e.jsx(_t,{})})]},2),e.jsxs(en,{disablePadding:!0,children:[e.jsxs(tn,{onClick:()=>u(!0),children:[e.jsx(nn,{children:e.jsx(Rt,{alt:"Avatar n°4",src:"https://c.mamed.org/images/examination.avif"})}),e.jsx(Ot,{id:"checkbox-list-secondary-label-3",primary:"Examination",secondary:`Add Common Examinations eg.  Hard Truamatization, Plaque accumulation, Missing teeth
`})]}),e.jsx(G,{onClick:()=>u(!0),children:e.jsx(_t,{})})]},3)," ",e.jsxs(en,{disablePadding:!0,children:[e.jsxs(tn,{onClick:()=>v(!0),children:[e.jsx(nn,{children:e.jsx(Rt,{alt:"Avatar n°4",src:"https://c.mamed.org/images/toothcondition.avif"})}),e.jsx(Ot,{id:"checkbox-list-secondary-label-3",primary:"Surface",secondary:"Add Common Tooth Conditions eg.  tooth decay, gum disease"})]}),e.jsx(G,{onClick:()=>v(!0),children:e.jsx(_t,{})})]},4)," ",e.jsxs(en,{disablePadding:!0,children:[e.jsxs(tn,{onClick:()=>c(!0),children:[e.jsx(nn,{children:e.jsx(Rt,{alt:"Avatar n°4",src:"https://c.mamed.org/images/surface.avif"})}),e.jsx(Ot,{id:"checkbox-list-secondary-label-3",primary:"Tooth Condition",secondary:"Add Common Surface eg.  Labial ( LA), Pallatal"})]}),e.jsx(G,{onClick:()=>c(!0),children:e.jsx(_t,{})})]},5)]}),e.jsx(_i,{open:a,onClose:()=>l(!1)}),e.jsx(Ii,{open:o,onClose:()=>r(!1)}),e.jsx(Bi,{open:S,onClose:()=>i(!1)}),e.jsx(Wi,{open:x,onClose:()=>u(!1)}),e.jsx(Vi,{open:h,onClose:()=>v(!1)}),e.jsx(Xi,{open:D,onClose:()=>c(!1)})]})}function tl(n,s,a){var S;if(!n||n.length===0)return null;const l=(S=n[0])==null?void 0:S.medication;if(!l)return null;let o;try{o=JSON.parse(l)}catch(i){return console.error("Error parsing medication string:",i),null}const r=o.findIndex(i=>i.id===s);return r!==-1?(o[r]={...o[r],...a},n.map(i=>({...i,medication:JSON.stringify(o)})),o):(console.warn(`Medication with ID ${s} not found.`),null)}const nl=(n,s)=>{const a=s,l=JSON.stringify(n);return new Promise((o,r)=>{fetch(a,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({medication:l})}).then(S=>S.ok?S.json():S.json().then(i=>{throw new Error(i.message||`HTTP error! status: ${S.status}`)})).then(S=>{console.log("API Response:",S),o({success:!0,message:"Medications saved successfully!"})}).catch(S=>{console.error("API Error:",S),r({success:!1,message:S.message||"Failed to save medications."})})})};function sl(){var E,I;const n="https://dental-clinic-latest.onrender.com",{session:s}=he(),[a,l]=t.useState(!0),[o,r]=t.useState(!0),[S,i]=t.useState([]),[x,u]=t.useState(null),[h,v]=t.useState(null),[D,c]=t.useState(!1),[Q,Y]=t.useState(null),[L,J]=t.useState(!1),[_,P]=t.useState(""),[U,Z]=t.useState(""),[B,K]=t.useState(""),[M,w]=t.useState(""),[j,m]=t.useState(""),[C,f]=t.useState(""),T=t.useCallback(async()=>{var F;if((F=s==null?void 0:s.user)!=null&&F.entity_name){r(!0);try{const k=await fetch(`${n}/clinics/cbyname/${s.user.entity_name}`,{method:"GET"});if(!k.ok)throw new Error(`HTTP error! Status: ${k.status}`);const g=[await k.json()];i(g),Array.isArray(g)?i(g):v("Unexpected API response: Expected an array of clinic data."),v(null)}catch(k){v(k.message),i([])}finally{r(!1)}}},[(E=s==null?void 0:s.user)==null?void 0:E.entity_name,n,s]);t.useEffect(()=>{T()},[T]);const N=F=>{var A;const k=(A=S[0])==null?void 0:A.medication;if(!k){v("No medication data found.");return}let g;try{g=JSON.parse(k)}catch(O){console.error("Error parsing medication string:",O),v("Invalid medication data format.");return}const $=g.find(O=>O.id===F);if(!$){v(`Medication with ID ${F} not found.`);return}Y($),P($.name),Z($.dosage),K($.frequency),w($.duration),m($.remarks),f($.price),c(!0)},z=async()=>{var k;if(!Q)return;const F=tl(S,Q.id,{name:_,dosage:U,frequency:B,duration:M,remarks:j,price:C});if(F){u(F);try{const g=await nl(F,`${n}/clinics/name/${(k=s==null?void 0:s.user)==null?void 0:k.entity_name}`);g.success?console.log(g.message):v(g.message||"Failed to save medications.")}catch(g){const $=g.message||"An unexpected error occurred. Please try again.";v($),console.error("Error sending data:",g)}finally{r(!1)}console.log(F),i(g=>g.map($=>({...$,medication:JSON.stringify(F)}))),v(null),c(!1),J(!0)}else v("Failed to update medication. Check console for details.")},ee=t.useCallback(F=>{var A;const k=(A=S[0])==null?void 0:A.medication;if(!k){v("No medication data found.");return}let g;try{g=JSON.parse(k)}catch(O){console.error("Error parsing medication string:",O),v("Invalid medication data format.");return}const $=g.filter(O=>O.id!==F);i(O=>O.map(te=>({...te,medication:JSON.stringify($)}))),u($)},[S]),se=[{field:"id",headerName:"ID",width:70},{field:"name",headerName:"Name",width:150},{field:"dosage",headerName:"Dosage",width:100},{field:"frequency",headerName:"Frequency",width:100},{field:"duration",headerName:"Duration",width:100},{field:"remarks",headerName:"Remarks",width:150},{field:"price",headerName:"Price",width:100},{field:"actions",type:"actions",headerName:"Actions",width:150,getActions:F=>[e.jsx(ge,{icon:e.jsx(rt,{}),label:"Edit",onClick:()=>N(F.row.id),showInMenu:!0}),e.jsx(ge,{icon:e.jsx(ot,{}),label:"Delete",onClick:()=>ee(F.row.id),showInMenu:!0})]}];let H=[];if(S&&S.length>0&&((I=S[0])!=null&&I.medication))try{H=JSON.parse(S[0].medication)}catch(F){console.error("Error parsing medication data",F),H=[],v("Error parsing medication data. Please check the data source.")}else H=[];return o?e.jsx(W,{children:"Loading..."}):e.jsxs(ne,{sx:{p:4},children:[h&&e.jsxs(ye,{severity:"error",sx:{mb:2},children:[e.jsx(zt,{children:"Error"}),h]}),e.jsx(ne,{sx:{height:"auto",width:"100%"},children:e.jsx(we,{rows:H,columns:se,initialState:{pagination:{paginationModel:{pageSize:5}}},pageSizeOptions:[5,10,20]})}),e.jsxs(Ce,{open:D,onClose:()=>c(!1),children:[e.jsx(Ne,{children:"Edit Medication"}),e.jsxs(ve,{children:[e.jsx(Ue,{children:"Edit the medication details below."}),e.jsx(R,{autoFocus:!0,margin:"dense",id:"name",label:"Name",value:_,onChange:F=>P(F.target.value),fullWidth:!0,variant:"standard"}),e.jsx(R,{margin:"dense",id:"dosage",label:"Dosage",value:U,onChange:F=>Z(F.target.value),fullWidth:!0,variant:"standard"}),e.jsx(R,{margin:"dense",id:"frequency",label:"Frequency",value:B,onChange:F=>K(F.target.value),fullWidth:!0,variant:"standard"}),e.jsx(R,{margin:"dense",id:"duration",label:"Duration",value:M,onChange:F=>w(F.target.value),fullWidth:!0,variant:"standard"}),e.jsx(R,{margin:"dense",id:"remarks",label:"Remarks",value:j,onChange:F=>m(F.target.value),fullWidth:!0,variant:"standard"}),e.jsx(R,{margin:"dense",id:"price",label:"Price",value:C,onChange:F=>f(F.target.value),fullWidth:!0,variant:"standard"})]}),e.jsxs(Ie,{children:[e.jsx(G,{onClick:()=>c(!1),children:"Cancel"}),e.jsx(G,{onClick:z,children:"Update"})]})]}),e.jsx($e,{open:L,autoHideDuration:6e3,onClose:()=>J(!1),message:"Medication updated successfully!"})]})}const an=yt(n=>e.jsx(bt,{disableGutters:!0,elevation:0,square:!0,...n}))(({theme:n})=>({border:`1px solid ${n.palette.divider}`,"&:not(:last-child)":{borderBottom:0},"&::before":{display:"none"}})),rn=yt(n=>e.jsx(wt,{expandIcon:e.jsx(va,{sx:{fontSize:"0.9rem"}}),...n}))(({theme:n})=>({backgroundColor:"rgba(0, 0, 0, .03)",flexDirection:"row-reverse",[`& .${hn.expandIconWrapper}.${hn.expanded}`]:{transform:"rotate(90deg)"},[`& .${hn.content}`]:{marginLeft:n.spacing(1)},...n.applyStyles("dark",{backgroundColor:"rgba(255, 255, 255, .05)"})})),on=yt(Ct)(({theme:n})=>({padding:n.spacing(2),borderTop:"1px solid rgba(0, 0, 0, .125)"}));function al(){const[n,s]=t.useState(""),a=l=>(o,r)=>{s(r?l:!1)};return e.jsxs("div",{children:[e.jsxs(an,{expanded:n==="panel1",onChange:a("panel1"),children:[e.jsx(rn,{"aria-controls":"panel1d-content",id:"panel1d-header",children:e.jsx(W,{component:"span",children:"Treatments"})}),e.jsx(on,{children:e.jsx(Da,{})})]}),e.jsxs(an,{expanded:n==="panel2",onChange:a("panel2"),children:[e.jsx(rn,{"aria-controls":"panel2d-content",id:"panel2d-header",children:e.jsx(W,{component:"span",children:"Medication"})}),e.jsx(on,{children:e.jsx(sl,{})})]}),e.jsxs(an,{expanded:n==="panel3",onChange:a("panel3"),children:[e.jsx(rn,{"aria-controls":"panel3d-content",id:"panel3d-header",children:e.jsx(W,{component:"span",children:"Diagnosis"})}),e.jsx(on,{children:e.jsx(_a,{})})]}),e.jsxs(an,{expanded:n==="panel7",onChange:a("panel7"),children:[e.jsx(rn,{"aria-controls":"panel7d-content",id:"panel7d-header",children:e.jsx(W,{component:"span",children:"Examination"})}),e.jsx(on,{children:e.jsx(Ra,{})})]}),e.jsxs(an,{expanded:n==="panel4",onChange:a("panel4"),children:[e.jsx(rn,{"aria-controls":"panel4d-content",id:"panel4d-header",children:e.jsx(W,{component:"span",children:"Surface"})}),e.jsx(on,{children:e.jsx(La,{})})]}),e.jsxs(an,{expanded:n==="panel5",onChange:a("panel5"),children:[e.jsx(rn,{"aria-controls":"panel5d-content",id:"panel5d-header",children:e.jsx(W,{component:"span",children:"Tooth Conditions"})}),e.jsx(on,{children:e.jsx(Pa,{})})]})," "]})}const rl=({clinic:n})=>{const s=$t();return e.jsxs(ne,{sx:{padding:4},children:[e.jsxs(V,{direction:"row",spacing:3,alignItems:"center",mb:4,children:[e.jsx(Rt,{alt:"Clinic Logo",src:n.clinic_logoUrl||"/static/images/avatar/1.jpg",sx:{height:50,width:50}}),e.jsxs(V,{direction:"column",children:[e.jsx(W,{variant:"h5",sx:{fontWeight:600,color:s.palette.primary.main},children:n.clinicname}),e.jsxs(V,{direction:"row",alignItems:"center",children:[e.jsx(ra,{sx:{fontSize:"inherit",color:s.palette.primary.main}}),e.jsx(W,{variant:"body2",color:"text.secondary",children:n.clinicaddress})]})]})]}),e.jsxs(bt,{children:[e.jsx(wt,{expandIcon:e.jsx(Lt,{style:{color:s.palette.primary.main}}),"aria-controls":"clinic-info-content",id:"clinic-info-header",children:e.jsx(W,{variant:"h6",gutterBottom:!0,color:s.palette.primary.main,children:"Clinic Information"})}),e.jsx(Ct,{children:e.jsxs(V,{direction:"column",spacing:3,children:[e.jsxs(ne,{children:[e.jsxs(V,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(to,{fontSize:"small",sx:{color:s.palette.primary.main}}),e.jsx(W,{variant:"subtitle1",sx:{fontWeight:600,color:s.palette.primary.main},children:"Clinic Name"})]}),e.jsx(R,{id:"clinic-name-input",size:"small",value:n.clinicname,disabled:!0,fullWidth:!0,sx:{marginTop:0,"& .MuiInputBase-root":{backgroundColor:"#f5f5f5",borderRadius:"4px"},"& .MuiInputBase-input.Mui-disabled":{color:"rgba(0, 0, 0, 0.87)"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"#d1d5db"}}})]}),e.jsxs(ne,{children:[e.jsxs(V,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(no,{fontSize:"small",sx:{color:s.palette.primary.main}}),e.jsx(W,{variant:"subtitle1",sx:{fontWeight:600,color:s.palette.primary.main},children:"Email Address"})]}),e.jsx(R,{id:"email-address-input",size:"small",value:n.clinicemail,disabled:!0,fullWidth:!0,sx:{marginTop:0,"& .MuiInputBase-root":{backgroundColor:"#f5f5f5",borderRadius:"4px"},"& .MuiInputBase-input.Mui-disabled":{color:"rgba(0, 0, 0, 0.87)"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"#d1d5db"}}})]}),e.jsxs(ne,{children:[e.jsxs(V,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(so,{fontSize:"small",sx:{color:s.palette.primary.main}}),e.jsx(W,{variant:"subtitle1",sx:{fontWeight:600,color:s.palette.primary.main},children:"Phone Number"})]}),e.jsx(R,{id:"phone-number-input",size:"small",value:n.clinicphone,disabled:!0,fullWidth:!0,sx:{marginTop:0,"& .MuiInputBase-root":{backgroundColor:"#f5f5f5",borderRadius:"4px"},"& .MuiInputBase-input.Mui-disabled":{color:"rgba(0, 0, 0, 0.87)"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"#d1d5db"}}})]}),e.jsxs(ne,{children:[e.jsxs(V,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(ra,{fontSize:"small",sx:{color:s.palette.primary.main}}),e.jsx(W,{variant:"subtitle1",sx:{fontWeight:600,color:s.palette.primary.main},children:"Address"})]}),e.jsx(R,{id:"address-input",size:"small",value:n.clinicaddress,disabled:!0,fullWidth:!0,sx:{marginTop:0,"& .MuiInputBase-root":{backgroundColor:"#f5f5f5",borderRadius:"4px"},"& .MuiInputBase-input.Mui-disabled":{color:"rgba(0, 0, 0, 0.87)"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"#d1d5db"}}})]}),e.jsxs(ne,{children:[e.jsx(W,{variant:"subtitle1",sx:{fontWeight:600},children:"Registration Date"}),e.jsx(R,{id:"registration-date-input",size:"small",value:n.clinic_reg_date,disabled:!0,fullWidth:!0,sx:{marginTop:0,"& .MuiInputBase-root":{backgroundColor:"#f5f5f5",borderRadius:"4px"},"& .MuiInputBase-input.Mui-disabled":{color:"rgba(0, 0, 0, 0.87)"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"#d1d5db"}}})]})]})})]})]})},ol=({clinic:n})=>e.jsx(Ue,{id:"alert-dialog-description",children:e.jsx(rl,{clinic:n})});function il(){const n="https://dental-clinic-latest.onrender.com",[s,a]=t.useState([]),[l,o]=t.useState(!0),[r,S]=t.useState(null),[i,x]=t.useState(!1),[u,h]=t.useState(null),[v,D]=t.useState(""),c=_=>{h(_),x(!0)},Q=()=>{x(!1)},Y=_=>{D(_.target.value)},L=[{field:"id",headerName:"ID",width:50},{field:"clinicname",headerName:"Clinic Name",width:200},{field:"clinicaddress",headerName:"Clinic Address",width:250},{field:"clinicemail",headerName:"Clinic Email",width:200},{field:"clinicphone",headerName:"Phone",width:150},{field:"tax",headerName:"Tax",width:100},{field:"actions",headerName:"Action",width:100,renderCell:_=>e.jsx(On,{"aria-label":"angalia",color:"primary",onClick:()=>c(_.row),children:e.jsx(Fn,{})})}];t.useEffect(()=>{(async()=>{try{const P=await fetch(`${n}/clinics`);if(!P.ok)throw new Error(`HTTP error! status: ${P.status}`);const U=await P.json();a(U)}catch(P){S(P.message)}finally{o(!1)}})()},[]);const J=s.filter(_=>Object.values(_).some(P=>typeof P=="string"&&P.toLowerCase().includes(v.toLowerCase())));return l?e.jsx(ne,{children:"Loading clinics..."}):r?e.jsxs(ne,{color:"red",children:["Error: ",r]}):e.jsxs("div",{style:{height:400,width:"100%"},children:[e.jsx(R,{id:"search",type:"text",placeholder:"Search Clinics...",value:v,onChange:Y,InputProps:{startAdornment:e.jsx(Xr,{position:"start",children:e.jsx(eo,{})})},sx:{mb:2},size:"small"}),e.jsx(we,{rows:J,columns:L,getRowId:_=>_.id}),e.jsxs(Ce,{open:i,onClose:Q,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(Ne,{id:"alert-dialog-title",children:""}),e.jsx(ve,{children:u&&e.jsx(ol,{clinic:u})}),e.jsx(Ie,{children:e.jsx(G,{onClick:Q,color:"primary",children:"Close"})})]})]})}function ll(n){const{entityName:s,users:a}=n,[l,o]=t.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(In,{sx:{"& > *":{borderBottom:"unset"}},children:[e.jsx(_e,{children:e.jsx(On,{"aria-label":"expand row",size:"small",onClick:()=>o(!l),children:l?e.jsx(oo,{}):e.jsx(io,{})})}),e.jsx(_e,{component:"th",scope:"row",children:s}),e.jsx(_e,{align:"right",children:a.length}),e.jsx(_e,{align:"right",children:"User Titles"}),e.jsx(_e,{align:"right",children:"Registration Date"})]}),e.jsx(In,{children:e.jsx(_e,{style:{paddingBottom:0,paddingTop:0},colSpan:6,children:e.jsx(lo,{in:l,timeout:"auto",unmountOnExit:!0,children:e.jsx(ne,{sx:{margin:1},children:e.jsxs(Ea,{size:"small","aria-label":"users",children:[e.jsx(ka,{children:e.jsxs(In,{children:[e.jsx(_e,{children:"Full Name"}),e.jsx(_e,{children:"Address"}),e.jsx(_e,{children:"Phone Number"}),e.jsx(_e,{children:"Email"}),e.jsx(_e,{children:"Title"}),e.jsx(_e,{children:"Password"})]})}),e.jsx(Ta,{children:a.map(r=>e.jsxs(In,{children:[e.jsx(_e,{component:"th",scope:"row",children:r.fullName}),e.jsx(_e,{children:r.address}),e.jsx(_e,{children:r.phone_number}),e.jsx(_e,{children:r.email}),e.jsx(_e,{children:r.title}),e.jsx(_e,{children:r.password})]},r.id))})]})})})})})]})}function cl(){const n="https://dental-clinic-latest.onrender.com",[s,a]=t.useState({}),[l,o]=t.useState(!0);return t.useEffect(()=>{(async()=>{try{const S=await fetch(`${n}/users`);if(!S.ok)throw new Error(`HTTP error! status: ${S.status}`);const x=(await S.json()).reduce((u,h)=>{const v=h.entity_name;return u[v]||(u[v]=[]),u[v].push(h),u},{});a(x)}catch(S){console.error("Could not fetch the data: ",S)}finally{o(!1)}})()},[]),l?e.jsx(ne,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px"},children:e.jsx(ze,{})}):e.jsx(ao,{component:ro,children:e.jsxs(Ea,{"aria-label":"collapsible table",children:[e.jsx(ka,{children:e.jsxs(In,{children:[e.jsx(_e,{}),e.jsx(_e,{children:"Entity Name"}),e.jsx(_e,{align:"right",children:"User Count"}),e.jsx(_e,{align:"right",children:"Titles"}),e.jsx(_e,{align:"right",children:"Registration Dates"})]})}),e.jsx(Ta,{children:Object.entries(s).map(([r,S])=>e.jsx(ll,{entityName:r,users:S},r))})]})})}const ln=yt(n=>e.jsx(bt,{disableGutters:!0,elevation:0,square:!0,...n}))(({theme:n})=>({border:`1px solid ${n.palette.divider}`,"&:not(:last-child)":{borderBottom:0},"&::before":{display:"none"}})),cn=yt(n=>e.jsx(wt,{expandIcon:e.jsx(va,{sx:{fontSize:"0.9rem"}}),...n}))(({theme:n})=>({backgroundColor:"rgba(0, 0, 0, .03)",flexDirection:"row-reverse",[`& .${hn.expandIconWrapper}.${hn.expanded}`]:{transform:"rotate(90deg)"},[`& .${hn.content}`]:{marginLeft:n.spacing(1)},...n.applyStyles("dark",{backgroundColor:"rgba(255, 255, 255, .05)"})})),dn=yt(Ct)(({theme:n})=>({padding:n.spacing(2),borderTop:"1px solid rgba(0, 0, 0, .125)"}));function dl(){const[n,s]=t.useState(""),a=l=>(o,r)=>{s(r?l:!1)};return e.jsxs("div",{children:[e.jsxs(ln,{expanded:n==="panel1",onChange:a("panel1"),children:[e.jsx(cn,{"aria-controls":"panel1d-content",id:"panel1d-header",children:e.jsx(W,{component:"span",children:"Treatments"})}),e.jsx(dn,{children:e.jsxs(ne,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},children:[" ",e.jsx($a,{})]})})]}),e.jsxs(ln,{expanded:n==="panel2",onChange:a("panel2"),children:[e.jsx(cn,{"aria-controls":"panel2d-content",id:"panel2d-header",children:e.jsx(W,{component:"span",children:"Medication"})}),e.jsx(dn,{children:e.jsx(ne,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:e.jsx(za,{})})})]}),e.jsxs(ln,{expanded:n==="panel3",onChange:a("panel3"),children:[e.jsx(cn,{"aria-controls":"panel3d-content",id:"panel3d-header",children:e.jsx(W,{component:"span",children:"Diagnosis"})}),e.jsx(dn,{children:e.jsx(ne,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:e.jsx(Ma,{})})})]}),e.jsxs(ln,{expanded:n==="panel7",onChange:a("panel7"),children:[e.jsx(cn,{"aria-controls":"panel7d-content",id:"panel7d-header",children:e.jsx(W,{component:"span",children:"Examination"})}),e.jsx(dn,{children:e.jsx(ne,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:e.jsx(Fa,{})})})]}),e.jsxs(ln,{expanded:n==="panel4",onChange:a("panel4"),children:[e.jsx(cn,{"aria-controls":"panel4d-content",id:"panel4d-header",children:e.jsx(W,{component:"span",children:"Surface"})}),e.jsx(dn,{children:e.jsx(ne,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:e.jsx(Oa,{})})})]}),e.jsxs(ln,{expanded:n==="panel5",onChange:a("panel5"),children:[e.jsx(cn,{"aria-controls":"panel5d-content",id:"panel5d-header",children:e.jsx(W,{component:"span",children:"Tooth Conditions"})}),e.jsx(dn,{children:e.jsx(ne,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:e.jsx(Aa,{})})})]})," "]})}const ul=co([{path:"/",element:e.jsx(Co,{}),children:[{path:"/",element:e.jsx(vo,{}),children:[{path:"/",element:e.jsx(po,{})},{path:"/orders",element:e.jsx(go,{})},{path:"/systemusers",element:e.jsx(cl,{})},{path:"/add-doctor",element:e.jsx(xo,{})},{path:"/staff/staffregistration",element:e.jsx(ko,{})},{path:"/staff/staffview",element:e.jsx(oa,{})},{path:"/staff",element:e.jsx(oa,{})},{path:"/client/view-clients",element:e.jsx(To,{})},{path:"/client/add-client",element:e.jsx(jo,{})},{path:"/add-task",element:e.jsx(ia,{})},{path:"/cases/doctor-task",element:e.jsx(ia,{})},{path:"/cases/create-case",element:e.jsx(Uo,{})},{path:"/cases/view-cases",element:e.jsx(Zo,{})},{path:"/patients/view-patient",element:e.jsx(la,{})},{path:"/patients",element:e.jsx(la,{})},{path:"/patients/add-patient",element:e.jsx(Do,{})},{path:"/manage/view-product",element:e.jsx(Da,{})},{path:"/manage/add-product",element:e.jsx($a,{})},{path:"/manage/view-diagnosis",element:e.jsx(_a,{})},{path:"/manage/add-diagnosis",element:e.jsx(Ma,{})},{path:"/manage/add-examination",element:e.jsx(Fa,{})},{path:"/manage/view-examination",element:e.jsx(Ra,{})},{path:"/manage/add-surface",element:e.jsx(Oa,{})},{path:"/manage/view-surface",element:e.jsx(La,{})},{path:"/manage/view-conditions",element:e.jsx(Pa,{})},{path:"/manage/add-condition",element:e.jsx(Aa,{})},{path:"/manage/add-typecondition",element:e.jsx(Ro,{})},{path:"/manage/view-typecondition",element:e.jsx(Lo,{})},{path:"/manage/add-medication",element:e.jsx(za,{})},{path:"/manage/view-medication",element:e.jsx(Ni,{})},{path:"/manage/add-regfee",element:e.jsx(zo,{})},{path:"/manage/view-regfee",element:e.jsx(Bo,{})},{path:"/manage",element:e.jsx(yo,{})},{path:"/bills/dview-bills",element:e.jsx(ei,{})},{path:"/view-pendings",element:e.jsx(oi,{})},{path:"schedule-appointment",element:e.jsx(li,{})},{path:"/cases/viewappointment",element:e.jsx(fa,{})},{path:"/viewappointment",element:e.jsx(fa,{})},{path:"/paidbills",element:e.jsx($i,{})},{path:"/manage/add-services-and-products",element:e.jsx(el,{})},{path:"/manage/view-services-and-products",element:e.jsx(al,{})},{path:"/cliniclist",element:e.jsx(il,{})},{path:"/addservices",element:e.jsx(dl,{})}]},{path:"/sign-in",element:e.jsx(So,{})},{path:"/entity-registration",element:e.jsx(mo,{})}]}]);uo(document.getElementById("root")).render(e.jsxs(t.StrictMode,{children:[e.jsx(ho,{router:ul})," "]}));
